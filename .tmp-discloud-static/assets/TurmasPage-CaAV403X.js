const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CCr23udO.js","assets/index-CKFdKx3N.css"])))=>i.map(i=>d[i]);
import{g as be,u as xe,d as me,r as n,j as e,k as V,X as Z,I as ae,K as O,c as ee,C as re,U as Q,_ as ne,a8 as J,a5 as ue,B as Y,a9 as fe,aa as ve,ab as je,ac as Ne,ad as ye,L as ce,a as de,z as he,R as we,ae as _e,af as Se,ag as De,ah as Ce,v as Te}from"./index-CCr23udO.js";import{T as te}from"./trash-2-IEheby2Z.js";import{M as ke}from"./map-pin-UCgS3o9v.js";import{S as pe}from"./save-BDGo1Gz5.js";import{S as ge}from"./square-pen-CFWfA0Dv.js";import{G as Ae}from"./grid-3x3-BrVqK7_f.js";import{u as Ee}from"./useDataRefresh-Bc19hZJI.js";import{F as Me}from"./filter-ClytLayh.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=be("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function Pe({isOpen:_,onClose:D,turma:a,onSave:p}){const{user:f}=xe(),l=me(f,!0),[t,h]=n.useState({nome:"",serie:"",turno:"Manhã",ano_letivo:new Date().getFullYear().toString(),professor_id:"",capacidade:"",ativo:!0,observacoes:""}),[H,E]=n.useState([]),[F,d]=n.useState([]),[j,$]=n.useState([]),[T,L]=n.useState({}),[y,z]=n.useState(""),[x,M]=n.useState({}),[S,w]=n.useState(!1),[k,I]=n.useState(!1);n.useEffect(()=>{var c;(async()=>{try{const{getAllUsuarios:m,getAllDisciplinas:C}=await ne(async()=>{const{getAllUsuarios:i,getAllDisciplinas:N}=await import("./index-CCr23udO.js").then(v=>v.as);return{getAllUsuarios:i,getAllDisciplinas:N}},__vite__mapDeps([0,1])),[U,K]=await Promise.all([m(),C()]),W=U.filter(i=>i.tipo_usuario==="professor"&&i.ativo);E(W),d(K)}catch(m){console.error("Erro ao carregar professores:",m)}})(),h(a?{nome:a.nome,serie:a.serie||"",turno:a.turno||"Manhã",ano_letivo:a.ano_letivo,professor_id:a.professor_id||"",capacidade:((c=a.capacidade)==null?void 0:c.toString())||"",ativo:a.ativa??!0,observacoes:a.observacoes||""}:{nome:"",serie:"",turno:"Manhã",ano_letivo:new Date().getFullYear().toString(),professor_id:"",capacidade:"",ativo:!0,observacoes:""}),M({}),I(!1)},[a,_]);const R=()=>{const s={};if((!t.nome.trim()||t.nome.length<2)&&(s.nome="Nome da turma deve ter pelo menos 2 caracteres"),t.serie.trim()||(s.serie="Série é obrigatória"),!t.ano_letivo.trim())s.ano_letivo="Ano letivo é obrigatório";else{const c=parseInt(t.ano_letivo);(isNaN(c)||c<2020||c>2030)&&(s.ano_letivo="Ano letivo deve estar entre 2020 e 2030")}return t.turno||(s.turno="Turno é obrigatório"),t.capacidade&&(isNaN(parseInt(t.capacidade))||parseInt(t.capacidade)<1)&&(s.capacidade="Capacidade deve ser um número maior que 0"),M(s),Object.keys(s).length===0},A=()=>{y&&!j.includes(y)&&($(s=>[...s,y]),z(""))},B=s=>{$(c=>c.filter(m=>m!==s)),L(c=>{const m={...c};return delete m[s],m})},o=async s=>{if(s.preventDefault(),!!R()){w(!0);try{let c;if(a)await l.updateTurma(a.id,{nome:t.nome,serie:t.serie,turno:t.turno,ano_letivo:t.ano_letivo,professor_id:t.professor_id||void 0,capacidade:t.capacidade?parseInt(t.capacidade):void 0,ativa:t.ativo,observacoes:t.observacoes}),c=a.id,console.log("✅ Turma atualizada");else{const m=await l.createTurma({nome:t.nome,serie:t.serie,turno:t.turno,ano_letivo:t.ano_letivo,professor_id:t.professor_id||void 0,capacidade:t.capacidade?parseInt(t.capacidade):void 0,observacoes:t.observacoes,ativa:t.ativo});c=(m==null?void 0:m.id)||"",console.log("✅ Turma criada")}if(c&&j.length>0){const{updateDisciplina:m}=await ne(async()=>{const{updateDisciplina:C}=await import("./index-CCr23udO.js").then(U=>U.as);return{updateDisciplina:C}},__vite__mapDeps([0,1]));for(const C of j)await m(C,{turma_id:c,professor_id:T[C]||void 0});console.log("✅ Disciplinas da turma atualizadas")}I(!0),setTimeout(()=>{p(),D()},1500)}catch(c){console.error("Erro ao salvar turma:",c),M({submit:"Erro ao salvar turma"})}finally{w(!1)}}};return _?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(V,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Editar Turma":"Nova Turma"})]}),e.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Z,{className:"h-5 w-5 text-gray-500"})})]}),k&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a?"Turma atualizada com sucesso!":"Turma cadastrada com sucesso!"})]})}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Turma *"}),e.jsx("input",{type:"text",value:t.nome,onChange:s=>h({...t,nome:s.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.nome?"border-red-300":"border-gray-300"}`,placeholder:"Ex: 5º Ano A, 3º B"}),x.nome&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),x.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Série *"}),e.jsx("input",{type:"text",value:t.serie,onChange:s=>h({...t,serie:s.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.serie?"border-red-300":"border-gray-300"}`,placeholder:"Ex: 5º Ano, Ensino Médio - 1º"}),x.serie&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),x.serie]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Turno *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t.turno,onChange:s=>h({...t,turno:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.turno?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"Manhã",children:"Manhã"}),e.jsx("option",{value:"Tarde",children:"Tarde"}),e.jsx("option",{value:"Noite",children:"Noite"}),e.jsx("option",{value:"Integral",children:"Integral"})]})]}),x.turno&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),x.turno]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ano Letivo *"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",min:"2020",max:"2030",value:t.ano_letivo,onChange:s=>h({...t,ano_letivo:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.ano_letivo?"border-red-300":"border-gray-300"}`,placeholder:"2025"})]}),x.ano_letivo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),x.ano_letivo]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professor Responsável"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t.professor_id,onChange:s=>h({...t,professor_id:s.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um professor (opcional)"}),H.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pode ser atribuído posteriormente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capacidade de Alunos"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",min:"1",max:"50",value:t.capacidade,onChange:s=>h({...t,capacidade:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${x.capacidade?"border-red-300":"border-gray-300"}`,placeholder:"Ex: 30"})]}),x.capacidade&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),x.capacidade]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:t.ativo?"ativo":"inativo",onChange:s=>h({...t,ativo:s.target.value==="ativo"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Disciplinas da Turma"}),e.jsxs("div",{className:"space-y-3",children:[j.map(s=>{const c=F.find(m=>m.id===s);return c?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:c.cor||"#3B82F6"},children:c.codigo||c.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:c.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:c.codigo})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:T[s]||"",onChange:m=>L(C=>({...C,[s]:m.target.value})),className:"text-sm px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sem professor"}),H.map(m=>e.jsx("option",{value:m.id,children:m.nome},m.id))]}),e.jsx("button",{type:"button",onClick:()=>B(s),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50",children:e.jsx(Z,{className:"h-4 w-4"})})]})]},s):null}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:y,onChange:s=>z(s.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione uma disciplina para adicionar"}),F.filter(s=>!j.includes(s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.nome," (",s.codigo,")"]},s.id))]}),e.jsx("button",{type:"button",onClick:A,disabled:!y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Adicionar"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{value:t.observacoes,onChange:s=>h({...t,observacoes:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Comentários gerais sobre a turma..."})]}),e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Informações Importantes:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• O nome da turma deve ser único por ano letivo"}),e.jsx("li",{children:"• O professor responsável pode ser atribuído posteriormente"}),e.jsx("li",{children:"• A capacidade é opcional e serve como referência"}),e.jsx("li",{children:"• Turmas inativas não aparecem nas listas de seleção"})]})]}),x.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),x.submit]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:S||k,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Salvando...":a?"Salvar Alterações":"Cadastrar Turma"})]})]})]})}):null}function He({isOpen:_,onClose:D,turma:a,horario:p,onSave:f}){var I,R,A,B;const[l,t]=n.useState({disciplina_id:"",professor_id:"",dia_semana:1,hora_inicio:"07:00",hora_fim:"07:50",sala:"",observacoes:""}),[h,H]=n.useState([]),[E,F]=n.useState([]),[d,j]=n.useState({}),[$,T]=n.useState(!1),[L,y]=n.useState(!1);n.useEffect(()=>{_&&a&&z()},[_,a]),n.useEffect(()=>{t(p?{disciplina_id:p.disciplina_id,professor_id:p.professor_id||"",dia_semana:p.dia_semana,hora_inicio:p.hora_inicio,hora_fim:p.hora_fim,sala:p.sala||"",observacoes:p.observacoes||""}:{disciplina_id:"",professor_id:"",dia_semana:1,hora_inicio:"07:00",hora_fim:"07:50",sala:"",observacoes:""}),j({}),y(!1)},[p,_]);const z=async()=>{if(a)try{const[o,s]=await Promise.all([J(a.id),ue()]);H(o),F(s.filter(c=>c.tipo_usuario==="professor"))}catch(o){console.error("Erro ao carregar dados:",o)}},x=()=>{const o={};return l.disciplina_id||(o.disciplina_id="Disciplina é obrigatória"),l.hora_inicio||(o.hora_inicio="Hora de início é obrigatória"),l.hora_fim||(o.hora_fim="Hora de fim é obrigatória"),l.hora_inicio&&l.hora_fim&&l.hora_inicio>=l.hora_fim&&(o.hora_fim="Hora de fim deve ser posterior à hora de início"),j(o),Object.keys(o).length===0},M=async o=>{if(o.preventDefault(),!(!x()||!a)){T(!0);try{p?(await ve(p.id,{disciplina_id:l.disciplina_id,professor_id:l.professor_id||null,dia_semana:l.dia_semana,hora_inicio:l.hora_inicio,hora_fim:l.hora_fim,sala:l.sala||null,observacoes:l.observacoes||null}),console.log("✅ Horário atualizado")):(await je({turma_id:a.id,disciplina_id:l.disciplina_id,professor_id:l.professor_id||null,dia_semana:l.dia_semana,hora_inicio:l.hora_inicio,hora_fim:l.hora_fim,sala:l.sala||null,observacoes:l.observacoes||null,ativo:!0}),console.log("✅ Horário criado")),y(!0),setTimeout(()=>{f(),D(),w()},1500)}catch(s){console.error("Erro ao salvar horário:",s),j({submit:"Erro ao salvar horário"})}finally{T(!1)}}},S=async()=>{if(p&&confirm("Tem certeza que deseja excluir este horário?"))try{await fe(p.id),f(),D(),w()}catch(o){console.error("Erro ao excluir horário:",o),j({submit:"Erro ao excluir horário"})}},w=()=>{t({disciplina_id:"",professor_id:"",dia_semana:1,hora_inicio:"07:00",hora_fim:"07:50",sala:"",observacoes:""}),j({}),y(!1)},k=()=>[{value:1,label:"Segunda-feira"},{value:2,label:"Terça-feira"},{value:3,label:"Quarta-feira"},{value:4,label:"Quinta-feira"},{value:5,label:"Sexta-feira"},{value:6,label:"Sábado"},{value:7,label:"Domingo"}];return!_||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(ee,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p?"Editar Horário":"Novo Horário de Aula"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[p&&e.jsx("button",{onClick:S,className:"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{D(),w()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Z,{className:"h-5 w-5 text-gray-500"})})]})]}),L&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:p?"Horário atualizado com sucesso!":"Horário criado com sucesso!"})]})}),e.jsxs("form",{onSubmit:M,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:l.disciplina_id,onChange:o=>{t({...l,disciplina_id:o.target.value});const s=h.find(c=>c.disciplina_id===o.target.value);s!=null&&s.professor_id&&t(c=>({...c,professor_id:s.professor_id||""}))},className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.disciplina_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),h.map(o=>{var s;return e.jsx("option",{value:o.disciplina_id,children:(s=o.disciplina)==null?void 0:s.nome},o.id)})]})]}),d.disciplina_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),d.disciplina_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professor"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:l.professor_id,onChange:o=>t({...l,professor_id:o.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um professor (opcional)"}),E.map(o=>e.jsx("option",{value:o.id,children:o.nome},o.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dia da Semana *"}),e.jsx("select",{value:l.dia_semana,onChange:o=>t({...l,dia_semana:parseInt(o.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:k().map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hora de Início *"}),e.jsx("input",{type:"time",value:l.hora_inicio,onChange:o=>t({...l,hora_inicio:o.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.hora_inicio?"border-red-300":"border-gray-300"}`}),d.hora_inicio&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:d.hora_inicio})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hora de Fim *"}),e.jsx("input",{type:"time",value:l.hora_fim,onChange:o=>t({...l,hora_fim:o.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.hora_fim?"border-red-300":"border-gray-300"}`}),d.hora_fim&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:d.hora_fim})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sala/Local"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:l.sala,onChange:o=>t({...l,sala:o.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: Sala 101, Laboratório, Quadra"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{value:l.observacoes,onChange:o=>t({...l,observacoes:o.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Observações especiais sobre esta aula..."})]}),l.disciplina_id&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Preview do Horário:"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Disciplina:"})," ",(R=(I=h.find(o=>o.disciplina_id===l.disciplina_id))==null?void 0:I.disciplina)==null?void 0:R.nome]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Professor:"})," ",((A=E.find(o=>o.id===l.professor_id))==null?void 0:A.nome)||"Não atribuído"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dia:"})," ",(B=k().find(o=>o.value===l.dia_semana))==null?void 0:B.label]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Horário:"})," ",l.hora_inicio," às ",l.hora_fim]}),l.sala&&e.jsxs("p",{children:[e.jsx("strong",{children:"Local:"})," ",l.sala]})]})]}),h.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma disciplina na grade"}),e.jsx("p",{className:"text-gray-500",children:"Adicione disciplinas à grade da turma antes de criar horários."})]}),d.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),d.submit]})})]}),h.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{D(),w()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:M,disabled:$||L,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:$?"Salvando...":p?"Salvar Alterações":"Criar Horário"})]})]})]})})}function Le({isOpen:_,onClose:D,turma:a,onSave:p}){const[f,l]=n.useState(!1),[t,h]=n.useState("info"),[H,E]=n.useState(!1),[F,d]=n.useState(!1),[j,$]=n.useState([]),[T,L]=n.useState([]),[y,z]=n.useState([]),[x,M]=n.useState([]),[S,w]=n.useState([]),[k,I]=n.useState([]),[R,A]=n.useState(!1),[B,o]=n.useState(null),[s,c]=n.useState({nome:"",serie:"",turno:"Manhã",ano_letivo:"",capacidade:"",descricao:"",ativa:!0});n.useEffect(()=>{_&&m()},[_]),n.useEffect(()=>{var r;a&&c({nome:a.nome,serie:a.serie||"",turno:a.turno||"Manhã",ano_letivo:a.ano_letivo,capacidade:((r=a.capacidade)==null?void 0:r.toString())||"",descricao:a.descricao||"",ativa:a.ativa??!0})},[a]);const m=async()=>{if(a)try{const[r,u,b,P,G]=await Promise.all([Ne(),ue(),ye(),J(a.id),ce(a.id)]);L(r),z(u.filter(g=>g.tipo_usuario==="professor"));const X=b.filter(g=>g.turma_id===a.id);M(X),w(P),I(G)}catch(r){console.error("Erro ao carregar dados:",r)}},C=async()=>{if(a){E(!0);try{await Ce(a.id,{nome:s.nome,serie:s.serie,turno:s.turno,ano_letivo:s.ano_letivo,capacidade:s.capacidade?parseInt(s.capacidade):void 0,descricao:s.descricao,ativa:s.ativa}),d(!0),l(!1),setTimeout(()=>{d(!1),p()},1500)}catch(r){console.error("Erro ao salvar turma:",r)}finally{E(!1)}}},U=async(r,u)=>{if(a)try{await _e({turma_id:a.id,disciplina_id:r,professor_id:u||null,carga_horaria_semanal:2,ativa:!0});const b=await J(a.id);w(b)}catch(b){console.error("Erro ao adicionar disciplina:",b)}},K=async r=>{try{await De(r);const u=await J(a.id);w(u)}catch(u){console.error("Erro ao remover disciplina:",u)}},W=async(r,u)=>{try{await Se(r,u);const b=await J(a.id);w(b)}catch(b){console.error("Erro ao atualizar disciplina:",b)}},i=async()=>{const r=await ce(a.id);I(r)},N=()=>["Segunda","Terça","Quarta","Quinta","Sexta","Sábado","Domingo"],v=r=>k.filter(u=>u.dia_semana===r).sort((u,b)=>u.hora_inicio.localeCompare(b.hora_inicio)),q=()=>{if(x.length===0)return 0;const r=new Date,u=x.map(b=>{const P=new Date(b.data_nascimento||"2010-01-01");return r.getFullYear()-P.getFullYear()});return Math.round(u.reduce((b,P)=>b+P,0)/u.length)};return!_||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-blue-500 rounded-full text-white",children:e.jsx(V,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:f?"Editar Turma":"Detalhes da Turma"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Criada em ",new Date(a.criado_em).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!f&&e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),e.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Z,{className:"h-5 w-5 text-gray-500"})})]})]}),F&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Turma atualizada com sucesso!"})]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8 px-6",children:[e.jsx("button",{onClick:()=>h("info"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${t==="info"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Informações"})]})}),e.jsx("button",{onClick:()=>h("disciplinas"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${t==="disciplinas"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:"Grade de Disciplinas"})]})}),e.jsx("button",{onClick:()=>h("cronograma"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${t==="cronograma"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Cronograma"})]})})]})}),e.jsxs("div",{className:"p-6 space-y-8",children:[t==="info"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Informações Básicas"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome da Turma"}),f?e.jsx("input",{type:"text",value:s.nome,onChange:r=>c({...s,nome:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900 font-medium",children:a.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Série/Ano"}),f?e.jsx("input",{type:"text",value:s.serie,onChange:r=>c({...s,serie:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: 5º Ano, Ensino Médio - 1º"}):e.jsx("p",{className:"text-gray-900",children:a.serie||"Não definido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Turno"}),f?e.jsxs("select",{value:s.turno,onChange:r=>c({...s,turno:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"Manhã",children:"Manhã"}),e.jsx("option",{value:"Tarde",children:"Tarde"}),e.jsx("option",{value:"Noite",children:"Noite"}),e.jsx("option",{value:"Integral",children:"Integral"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900",children:a.turno||"Não definido"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ano Letivo"}),f?e.jsx("input",{type:"text",value:s.ano_letivo,onChange:r=>c({...s,ano_letivo:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900",children:a.ano_letivo})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Configurações"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Capacidade"}),f?e.jsx("input",{type:"number",value:s.capacidade,onChange:r=>c({...s,capacidade:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: 30"}):e.jsxs("p",{className:"text-gray-900",children:[a.capacidade||"Não definida"," alunos"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),f?e.jsxs("select",{value:s.ativa?"ativa":"inativa",onChange:r=>c({...s,ativa:r.target.value==="ativa"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ativa",children:"Ativa"}),e.jsx("option",{value:"inativa",children:"Inativa"})]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${a.ativa?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.ativa?"Ativa":"Inativa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Criação"}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-900",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:new Date(a.criado_em).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Alunos"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:x.length})]}),e.jsx(de,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Disciplinas"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:S.length})]}),e.jsx(Y,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Idade Média"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:q()})]}),e.jsx(Q,{className:"h-8 w-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Ocupação"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-900",children:[a.capacidade?Math.round(x.length/a.capacidade*100):0,"%"]})]}),e.jsx(V,{className:"h-8 w-8 text-yellow-600"})]})})]})]})]}),(f||a.descricao)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4",children:"Descrição"}),f?e.jsx("textarea",{value:s.descricao,onChange:r=>c({...s,descricao:r.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Descrição da turma, observações especiais..."}):e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.descricao||"Nenhuma descrição fornecida."})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4",children:["Alunos Matriculados (",x.length,")"]}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Nenhum aluno matriculado nesta turma"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(r=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold",children:r.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:r.nome}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Matrícula: ",r.matricula||"N/A"]})]})]})},r.id))})]})]}),t==="disciplinas"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Grade de Disciplinas (",S.length,")"]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{onChange:r=>{r.target.value&&(U(r.target.value),r.target.value="")},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Adicionar disciplina..."}),T.filter(r=>!S.some(u=>u.disciplina_id===r.id)).map(r=>e.jsx("option",{value:r.id,children:r.nome},r.id))]})})]}),S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Nenhuma disciplina vinculada a esta turma"}),e.jsx("p",{className:"text-sm mt-2",children:"Use o seletor acima para adicionar disciplinas"})]}):e.jsx("div",{className:"space-y-4",children:S.map(r=>{var u,b,P,G,X;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold",style:{backgroundColor:((u=r.disciplina)==null?void 0:u.cor)||"#3B82F6"},children:((b=r.disciplina)==null?void 0:b.codigo)||((P=r.disciplina)==null?void 0:P.nome.charAt(0))}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900",children:(G=r.disciplina)==null?void 0:G.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:(X=r.disciplina)==null?void 0:X.codigo})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Professor:"}),e.jsxs("select",{value:r.professor_id||"",onChange:g=>W(r.id,{professor_id:g.target.value||null}),className:"text-sm px-2 py-1 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Sem professor"}),y.map(g=>e.jsx("option",{value:g.id,children:g.nome},g.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Carga:"}),e.jsx("input",{type:"number",min:"1",max:"10",value:r.carga_horaria_semanal,onChange:g=>W(r.id,{carga_horaria_semanal:parseInt(g.target.value)}),className:"w-16 text-sm px-2 py-1 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("span",{className:"text-sm text-gray-500",children:"h/sem"})]}),e.jsx("button",{onClick:()=>K(r.id),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50",children:e.jsx(te,{className:"h-4 w-4"})})]})]})},r.id)})})]}),t==="cronograma"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Cronograma Semanal de Aulas"}),e.jsxs("button",{onClick:()=>A(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Horário"})]})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-8 gap-0",children:[e.jsx("div",{className:"bg-gray-50 p-3 border-b border-gray-200 font-medium text-gray-700 text-center",children:"Horário"}),N().map((r,u)=>e.jsx("div",{className:"bg-gray-50 p-3 border-b border-gray-200 font-medium text-gray-700 text-center",children:r},u)),Array.from({length:8},(r,u)=>{const b=7+u,P=`${b.toString().padStart(2,"0")}:00`;return e.jsxs(we.Fragment,{children:[e.jsx("div",{className:"p-3 border-b border-gray-200 text-center text-sm text-gray-600 bg-gray-50",children:P}),[1,2,3,4,5,6,7].map(G=>{const X=v(G).filter(g=>parseInt(g.hora_inicio.split(":")[0])===b);return e.jsx("div",{className:"p-2 border-b border-gray-200 min-h-[60px]",children:X.map(g=>{var se,ie,le,oe;return e.jsxs("div",{className:"p-2 rounded text-xs cursor-pointer hover:shadow-md transition-shadow",style:{backgroundColor:((se=g.disciplina)==null?void 0:se.cor)+"20",borderLeft:`3px solid ${(ie=g.disciplina)==null?void 0:ie.cor}`},onClick:()=>{o(g),A(!0)},children:[e.jsx("div",{className:"font-medium text-gray-900",children:(le=g.disciplina)==null?void 0:le.nome}),e.jsx("div",{className:"text-gray-600",children:(oe=g.professor)==null?void 0:oe.nome}),g.sala&&e.jsxs("div",{className:"text-gray-500",children:["Sala: ",g.sala]})]},g.id)})},G)})]},u)})]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"Resumo da Semana"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de aulas por semana:"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:k.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Disciplinas com horário:"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:new Set(k.map(r=>r.disciplina_id)).size})]})]})]})]})]}),f&&t==="info"&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{var r;l(!1),a&&c({nome:a.nome,serie:a.serie||"",turno:a.turno||"Manhã",ano_letivo:a.ano_letivo,capacidade:((r=a.capacidade)==null?void 0:r.toString())||"",descricao:a.descricao||"",ativa:a.ativa??!0})},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:C,disabled:H,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{children:H?"Salvando...":"Salvar Alterações"})]})]}),e.jsx(He,{isOpen:R,onClose:()=>{A(!1),o(null)},turma:a,horario:B,onSave:i})]})})}function Ge(){const{user:_,isSupabaseConnected:D}=xe(),a=me(_,D),{refreshKey:p,triggerRefresh:f}=Ee(),[l,t]=n.useState([]),[h,H]=n.useState([]),[E,F]=n.useState([]),[d,j]=n.useState({busca:"",anoLetivo:"",turno:"",status:""}),[$,T]=n.useState(!1),[L,y]=n.useState(null),[z,x]=n.useState(!1),[M,S]=n.useState(null),[w,k]=n.useState(!0);n.useEffect(()=>{I()},[p]);const I=async()=>{try{const[i,N,v]=await Promise.all([a.getTurmas(),a.getAlunos(),a.getDisciplinas()]);t(i),H(N),F(v)}catch(i){console.error("Erro ao carregar dados:",i)}finally{k(!1)}},R=i=>{const N=h.filter(q=>q.turma_id===i.id),v=E.filter(q=>q.turma_id===i.id);return{...i,totalAlunos:N.length,totalDisciplinas:v.length,professorNome:"Não atribuído"}},A=l.filter(i=>{const N=!d.busca||i.nome.toLowerCase().includes(d.busca.toLowerCase()),v=!d.anoLetivo||i.ano_letivo===d.anoLetivo,q=!d.turno||i.turno===d.turno,r=!d.status||d.status==="ativo"&&i.ativa||d.status==="inativo"&&!i.ativa;return N&&v&&q&&r}),B=[...new Set(l.map(i=>i.ano_letivo))].sort(),o=["Manhã","Tarde","Noite","Integral"],s=i=>{y(i),T(!0)},c=async i=>{const N=h.filter(v=>v.turma_id===i.id);if(N.length>0){alert(`Não é possível excluir a turma ${i.nome} pois há ${N.length} aluno(s) vinculado(s).`);return}if(confirm(`Tem certeza que deseja excluir a turma ${i.nome}?

Esta ação não pode ser desfeita.`))try{await a.deleteTurma(i.id),f()}catch(v){console.error("Erro ao excluir turma:",v),v instanceof Error&&v.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para excluir turmas. Verifique sua conexão."):alert("Erro ao excluir turma")}},m=i=>{S(i),x(!0)},C=()=>{T(!1),y(null)},U=()=>{f()},K=()=>{x(!1),S(null)},W=()=>{f(),K()};return w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-6"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:"Carregando turmas..."}),e.jsx("p",{className:"text-lg text-gray-500 mt-2",children:"Aguarde um momento"})]})}):e.jsxs("div",{className:"space-y-6 sm:space-y-8 lg:space-y-12",children:[e.jsx("div",{className:"bg-gradient-to-br from-white via-blue-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-xl border-2 border-blue-200 p-6 sm:p-8 lg:p-12 animate-slide-in-up hover:shadow-2xl transition-all duration-500",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-6 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 rounded-2xl sm:rounded-3xl shadow-2xl mx-auto sm:mx-0 animate-float",children:e.jsx(V,{className:"h-10 w-10 sm:h-12 sm:w-12 lg:h-16 lg:w-16 text-white"})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent animate-glow",children:"🏫 Gestão de Turmas"}),e.jsx("p",{className:"text-gray-700 mt-2 sm:mt-4 text-lg sm:text-xl lg:text-2xl font-bold",children:"🎯 Organize e gerencie todas as turmas da escola"})]})]}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>T(!0),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center space-x-2",children:[e.jsx(he,{className:"h-5 w-5"}),e.jsx("span",{children:"Nova Turma"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Me,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome da turma...",value:d.busca,onChange:i=>j({...d,busca:i.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:d.anoLetivo,onChange:i=>j({...d,anoLetivo:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os anos letivos"}),B.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("select",{value:d.turno,onChange:i=>j({...d,turno:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os turnos"}),o.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsxs("select",{value:d.status,onChange:i=>j({...d,status:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-blue-600 uppercase tracking-wide",children:"🏫 Total"}),e.jsx("p",{className:"text-3xl font-black text-blue-700",children:l.length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(V,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Alunos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(Q,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Disciplinas"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:E.length})]}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(Y,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Média por Turma"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:l.length>0?Math.round(h.length/l.length):0})]}),e.jsx("div",{className:"p-2 bg-yellow-50 rounded-full",children:e.jsx(Q,{className:"h-6 w-6 text-yellow-600"})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.length===0?e.jsxs("div",{className:"col-span-full bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma turma encontrada"}),e.jsx("p",{className:"text-gray-500",children:"Ajuste os filtros ou crie uma nova turma."})]}):A.map(i=>{const N=R(i);return e.jsx("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-2xl shadow-xl border-2 border-blue-200 hover:shadow-2xl hover:border-blue-400 hover:scale-110 hover:rotate-1 transition-all duration-300 cursor-pointer group",onClick:()=>m(i),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg",children:i.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-gray-900 group-hover:text-blue-700 transition-colors text-lg",children:i.nome}),e.jsxs("p",{className:"text-sm text-gray-600 font-bold",children:["📅 ",i.ano_letivo]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),s(i)},className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"Editar turma",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:v=>{v.stopPropagation(),c(i)},className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Excluir turma",children:e.jsx(te,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"👥 Alunos"})]}),e.jsxs("span",{className:"text-sm font-black text-gray-900",children:[N.totalAlunos,i.capacidade&&` / ${i.capacidade}`]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Disciplinas"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.totalDisciplinas})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Professor"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:N.professorNome})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Turno"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i.turno||"Não definido"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Status"})]}),e.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded-full text-xs ${i.ativa?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:i.ativa?"Ativo":"Inativo"})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Criada em"}),e.jsx("span",{children:new Date(i.criado_em).toLocaleDateString("pt-BR")})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 text-center",children:e.jsx("p",{className:"text-xs text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity font-black bg-blue-100 px-3 py-2 rounded-xl",children:"✨ Clique para ver detalhes completos"})})]})},i.id)})}),e.jsx(Pe,{isOpen:$,onClose:C,turma:L,onSave:U}),e.jsx(Le,{isOpen:z,onClose:K,turma:M,onSave:W})]})}export{Ge as TurmasPage};
