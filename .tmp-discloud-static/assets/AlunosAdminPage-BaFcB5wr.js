import{g as H,r as c,j as e,G as C,X as q,I as Q,K as _,C as G,a as O,U,P as V,b as K,a4 as Z,a5 as ee,a2 as se,a6 as ae,a7 as re,c as te,q as Y,F as le,S as oe,u as ne,d as ie,z as ce,v as de,E as me}from"./index-CCr23udO.js";import{U as xe}from"./upload-DIwgGHqY.js";import{M as ue}from"./map-pin-UCgS3o9v.js";import{u as pe}from"./useDataRefresh-Bc19hZJI.js";import{F as he}from"./filter-ClytLayh.js";import{U as I}from"./user-check-Gjly-lFN.js";import{S as ge}from"./square-pen-CFWfA0Dv.js";import{T as fe}from"./trash-2-IEheby2Z.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=H("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);function ve({isOpen:D,onClose:N,student:t,onSave:x}){const[s,i]=c.useState({nome:"",data_nascimento:"",matricula:"",turma_id:"",responsavel_id:"",responsavel:"",telefone_responsavel:"",email_responsavel:"",endereco:"",observacoes:"",foto_url:""}),[m,v]=c.useState([]),[T,S]=c.useState([]),[l,o]=c.useState({}),[u,h]=c.useState(!1),[g,y]=c.useState(!1);c.useEffect(()=>{let a=!0;return(async()=>{try{const[b,E]=await Promise.all([Z(),ee()]);if(a){v(b);const $=E.filter(w=>w.tipo_usuario==="pai"&&w.ativo);S($)}}catch(b){console.error("Erro ao carregar turmas:",b)}})(),i(t?{nome:t.nome,data_nascimento:t.data_nascimento||"",matricula:t.matricula||"",turma_id:t.turma_id,responsavel_id:t.responsavel_id||"",responsavel:t.responsavel||"",telefone_responsavel:t.telefone_responsavel||"",email_responsavel:t.email_responsavel||"",endereco:t.endereco||"",observacoes:t.observacoes||"",foto_url:t.foto_url||""}:{nome:"",data_nascimento:"",matricula:"",turma_id:"",responsavel_id:"",responsavel:"",telefone_responsavel:"",email_responsavel:"",endereco:"",observacoes:"",foto_url:""}),o({}),y(!1),()=>{a=!1}},[t,D]);const M=()=>{const a={};if((!s.nome.trim()||s.nome.length<3)&&(a.nome="Nome deve ter pelo menos 3 caracteres"),s.data_nascimento||(a.data_nascimento="Data de nascimento é obrigatória"),s.turma_id||(a.turma_id="Turma é obrigatória"),!s.responsavel_id){s.responsavel.trim()||(a.responsavel="Nome do responsável é obrigatório"),s.telefone_responsavel.trim()||(a.telefone_responsavel="Telefone do responsável é obrigatório");const d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;s.email_responsavel.trim()?d.test(s.email_responsavel)||(a.email_responsavel="Formato de e-mail inválido"):a.email_responsavel="E-mail do responsável é obrigatório",s.endereco.trim()||(a.endereco="Endereço é obrigatório")}return o(a),Object.keys(a).length===0},f=a=>{var b;const d=(b=a.target.files)==null?void 0:b[0];if(d){if(d.size>2*1024*1024){o({...l,foto_url:"Imagem deve ter no máximo 2MB"});return}const E=new FileReader;E.onload=$=>{var F;const w=(F=$.target)==null?void 0:F.result;i({...s,foto_url:w}),o({...l,foto_url:""})},E.readAsDataURL(d)}},k=async a=>{if(a.preventDefault(),!!M()){h(!0);try{let d=s.responsavel_id;if(!d&&s.responsavel.trim()){const b=await se({nome:s.responsavel,email:s.email_responsavel,senha:"123456",tipo_usuario:"pai",telefone:s.telefone_responsavel,ativo:!0});b&&(d=b.id)}t?(await ae(t.id,{nome:s.nome,turma_id:s.turma_id,data_nascimento:s.data_nascimento,responsavel_id:d}),console.log("✅ Aluno atualizado")):(await re({nome:s.nome,turma_id:s.turma_id,responsavel_id:d,data_nascimento:s.data_nascimento,matricula:s.matricula}),console.log("✅ Aluno criado")),y(!0),setTimeout(()=>{x(),N()},1500)}catch(d){console.error("Erro ao salvar aluno:",d),o({submit:"Erro ao salvar aluno"})}finally{h(!1)}}};return D?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t?"Editar Aluno":"Novo Aluno"})]}),e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(q,{className:"h-5 w-5 text-gray-500"})})]}),g&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:t?"Aluno atualizado com sucesso!":"Aluno cadastrado com sucesso!"})]})}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:s.foto_url?e.jsx("img",{src:s.foto_url,alt:"Foto do aluno",className:"w-full h-full object-cover"}):e.jsx(C,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:f,className:"hidden",id:"foto-upload"}),e.jsxs("label",{htmlFor:"foto-upload",className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Escolher Foto"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"JPG/PNG até 2MB (opcional)"}),l.foto_url&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:l.foto_url})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:s.nome,onChange:a=>i({...s,nome:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.nome?"border-red-300":"border-gray-300"}`,placeholder:"Nome completo do aluno"}),l.nome&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Nascimento *"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:s.data_nascimento,onChange:a=>i({...s,data_nascimento:a.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.data_nascimento?"border-red-300":"border-gray-300"}`})]}),l.data_nascimento&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.data_nascimento]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Matrícula"}),e.jsx("input",{type:"text",value:s.matricula,onChange:a=>i({...s,matricula:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Número da matrícula (opcional)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Turma *"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s.turma_id,onChange:a=>i({...s,turma_id:a.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.turma_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),m.map(a=>e.jsxs("option",{value:a.id,children:[a.nome," - ",a.ano_letivo]},a.id))]})]}),l.turma_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.turma_id]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Dados do Responsável"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Responsável Cadastrado"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s.responsavel_id,onChange:a=>i({...s,responsavel_id:a.target.value}),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um responsável cadastrado"}),T.map(a=>e.jsxs("option",{value:a.id,children:[a.nome," - ",a.email]},a.id))]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ou preencha os dados abaixo para criar um novo responsável"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nome do Responsável ",!s.responsavel_id&&"*"]}),e.jsx("input",{type:"text",value:s.responsavel,onChange:a=>i({...s,responsavel:a.target.value}),disabled:!!s.responsavel_id,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.responsavel?"border-red-300":"border-gray-300"} ${s.responsavel_id?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"Nome completo do responsável"}),l.responsavel&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.responsavel]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Telefone ",!s.responsavel_id&&"*"]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"tel",value:s.telefone_responsavel,onChange:a=>i({...s,telefone_responsavel:a.target.value}),disabled:!!s.responsavel_id,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.telefone_responsavel?"border-red-300":"border-gray-300"} ${s.responsavel_id?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"(11) 99999-9999"})]}),l.telefone_responsavel&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.telefone_responsavel]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["E-mail do Responsável ",!s.responsavel_id&&"*"]}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"email",value:s.email_responsavel,onChange:a=>i({...s,email_responsavel:a.target.value}),disabled:!!s.responsavel_id,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.email_responsavel?"border-red-300":"border-gray-300"} ${s.responsavel_id?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"responsavel@email.com"})]}),l.email_responsavel&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.email_responsavel]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endereço *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("textarea",{value:s.endereco,onChange:a=>i({...s,endereco:a.target.value}),rows:2,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.endereco?"border-red-300":"border-gray-300"}`,placeholder:"Rua, número, bairro, cidade"})]}),l.endereco&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),l.endereco]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{value:s.observacoes,onChange:a=>i({...s,observacoes:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Restrições alimentares, necessidades especiais, etc."})]}),l.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),l.submit]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:u||g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Salvando...":t?"Salvar Alterações":"Cadastrar Aluno"})]})]})]})}):null}const je=({isOpen:D,onClose:N,student:t,turma:x,responsavel:s})=>{if(!D||!t)return null;const m=(()=>{if(s)return{nome:s.nome,email:s.email,telefone:s.telefone};const o=t;return{nome:o.responsavel||"Não informado",email:o.email_responsavel||"Não informado",telefone:o.telefone_responsavel||"Não informado"}})(),v=(o,u)=>{if(!o)return"";const h=String(o).replace(/\D/g,""),g=h.startsWith("55")?h:`55${h}`,y=u?`?text=${encodeURIComponent(u)}`:"";return`https://wa.me/${g}${y}`},T=o=>{try{return new Date(o).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"Data inválida"}},S=o=>{try{return new Date(o).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Data inválida"}},l=()=>{if(!t.data_nascimento)return"Não informada";try{const o=new Date(t.data_nascimento),u=new Date,h=u.getFullYear()-o.getFullYear(),g=o.getMonth(),y=u.getMonth();return y<g||y===g&&u.getDate()<o.getDate()?`${h-1} anos`:`${h} anos`}catch{return"Não calculável"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white p-6 relative",children:[e.jsx("button",{onClick:N,className:"absolute top-4 right-4 p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-300",children:e.jsx(q,{className:"h-6 w-6"})}),e.jsx("div",{className:"pr-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center text-white font-black text-2xl",children:t.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black",children:t.nome}),e.jsxs("p",{className:"text-blue-100 flex items-center mt-1",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),(x==null?void 0:x.nome)||"Sem turma definida"]}),e.jsxs("p",{className:"text-blue-200 text-sm",children:["Matrícula: ",t.matricula||"Não informada"]})]})]})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2 text-blue-600"}),"👨‍🎓 Informações do Aluno"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nome Completo"}),e.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:t.nome})]}),t.data_nascimento&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Data de Nascimento"}),e.jsxs("p",{className:"text-gray-800 flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1 text-gray-500"}),T(t.data_nascimento)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Idade"}),e.jsx("p",{className:"text-gray-800 font-medium",children:l()})]})]}),t.cpf&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"CPF"}),e.jsx("p",{className:"text-gray-800 font-mono",children:t.cpf})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Matrícula"}),e.jsx("p",{className:"text-gray-800 font-mono bg-blue-100 px-2 py-1 rounded",children:t.matricula||"Não definida"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(C,{className:"h-5 w-5 mr-2 text-purple-600"}),"🏫 Informações Acadêmicas"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Turma"}),e.jsx("div",{className:"mt-1",children:x?e.jsxs("div",{className:"bg-purple-100 rounded-lg p-3",children:[e.jsx("p",{className:"text-gray-800 font-semibold",children:x.nome}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Ano Letivo: ",x.ano_letivo]}),x.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:x.descricao})]}):e.jsx("p",{className:"text-gray-500 italic",children:"Nenhuma turma definida"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Ativo"]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cadastrado em"}),e.jsxs("p",{className:"text-gray-800 flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-1 text-gray-500"}),S(t.criado_em)]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-2 border-green-100",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(O,{className:"h-5 w-5 mr-2 text-green-600"}),"👨‍👩‍👧‍👦 Responsável"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nome"}),e.jsxs("p",{className:"text-gray-800 font-semibold flex items-center",children:[e.jsx(U,{className:"h-4 w-4 mr-1 text-gray-500"}),m.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"E-mail"}),e.jsxs("p",{className:"text-gray-800 flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-1 text-gray-500"}),e.jsx("span",{className:"break-all",children:m.email})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Telefone"}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-800",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-1 text-gray-500"}),m.telefone]}),m.telefone&&m.telefone!=="Não informado"&&e.jsxs("a",{href:v(m.telefone,`Olá ${m.nome}!`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 text-xs rounded bg-green-100 text-green-800 hover:bg-green-200",title:"Abrir WhatsApp",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"})," WhatsApp"]})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-green-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 mb-2",children:"Ações Disponíveis:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.telefone!=="Não informado"&&e.jsx("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm",children:"📱 WhatsApp disponível"}),m.email!=="Não informado"&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:"📧 E-mail disponível"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-gray-600"}),"⚙️ Informações Técnicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"ID do Aluno"}),e.jsx("p",{className:"text-gray-800 font-mono text-sm bg-gray-200 px-2 py-1 rounded break-all",children:t.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"ID da Turma"}),e.jsx("p",{className:"text-gray-800 font-mono text-sm bg-gray-200 px-2 py-1 rounded break-all",children:t.turma_id||"Não definido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"ID do Responsável"}),e.jsx("p",{className:"text-gray-800 font-mono text-sm bg-gray-200 px-2 py-1 rounded break-all",children:t.responsavel_id||"Não definido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Data de Cadastro"}),e.jsx("p",{className:"text-gray-800 text-sm",children:new Date(t.criado_em).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-6 border-2 border-yellow-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2 text-yellow-600"}),"🎯 Ações Disponíveis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-700",children:"Gestão do Aluno:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Editar dados pessoais (✏️)"}),e.jsx("li",{children:"• Gerenciar matrícula"}),e.jsx("li",{children:"• Alterar turma"}),e.jsx("li",{children:"• Visualizar histórico acadêmico"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-700",children:"Comunicação:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"• Enviar WhatsApp ao responsável (💬)"}),e.jsx("li",{children:"• Enviar comunicados"}),e.jsx("li",{children:"• Agendar reuniões"}),e.jsx("li",{children:"• Relatórios personalizados"})]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:[e.jsx("button",{onClick:N,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Fechar"}),e.jsx("button",{onClick:()=>{N()},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Editar Aluno"})]})]})})};function ke(){const{user:D,isSupabaseConnected:N}=ne(),t=ie(D,N),{refreshKey:x,triggerRefresh:s}=pe(),[i,m]=c.useState([]),[v,T]=c.useState([]),[S,l]=c.useState([]),[o,u]=c.useState({busca:"",turma:"",status:""}),[h,g]=c.useState(!1),[y,M]=c.useState(!1),[f,k]=c.useState(null),[a,d]=c.useState(!0);c.useEffect(()=>{b()},[x]);const b=async()=>{try{const[r,n,p]=await Promise.all([t.getAlunos(),t.getTurmas(),t.getUsuarios()]),j=p.filter(R=>R.tipo_usuario==="pai");m(r),T(n),l(j)}catch(r){console.error("Erro ao carregar dados:",r)}finally{d(!1)}},E=(r,n)=>{if(!r)return"";const p=String(r).replace(/\D/g,""),j=p.startsWith("55")?p:`55${p}`,R=n?`?text=${encodeURIComponent(n)}`:"";return`https://wa.me/${j}${R}`},$=r=>{const n=v.find(j=>j.id===r.turma_id),p=S.find(j=>j.id===r.responsavel_id);return{...r,turma:n,responsavel:p}},w=i.filter(r=>{const n=!o.busca||r.nome.toLowerCase().includes(o.busca.toLowerCase()),p=!o.turma||r.turma_id===o.turma;return n&&p}),F=r=>{k(r),g(!0)},J=async r=>{if(confirm(`Tem certeza que deseja excluir o aluno ${r.nome}?`))try{await t.deleteAluno(r.id),s()}catch(n){console.error("Erro ao excluir aluno:",n),n instanceof Error&&n.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para excluir alunos. Verifique sua conexão."):alert("Erro ao excluir aluno")}},P=()=>{g(!1),k(null)},X=async()=>{try{s(),P()}catch(r){console.error("Erro ao salvar aluno:",r),r instanceof Error&&r.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para salvar alunos. Verifique sua conexão."):alert("Erro ao salvar aluno")}};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(C,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestão de Alunos"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Aluno"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(he,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome...",value:o.busca,onChange:r=>u({...o,busca:r.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:o.turma,onChange:r=>u({...o,turma:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as turmas"}),v.map(r=>e.jsx("option",{value:r.id,children:r.nome},r.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total de Alunos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length})]}),e.jsx(C,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Turmas Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(I,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Responsáveis"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:S.length})]}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(I,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Média por Turma"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:v.length>0?Math.round(i.length/v.length):0})]}),e.jsx("div",{className:"p-2 bg-yellow-50 rounded-full",children:e.jsx(C,{className:"h-6 w-6 text-yellow-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Alunos (",w.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aluno"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Turma"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Responsável"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Situação"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criado em"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"Nenhum aluno encontrado com os filtros aplicados"})}):w.map(r=>{var p,j,R,L,W,z,B;const n=$(r);return e.jsxs("tr",{className:"hover:bg-blue-50 hover:shadow-md transition-all cursor-pointer group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold mr-3",children:r.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors",children:r.nome}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",r.id.slice(0,8)]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((p=n.turma)==null?void 0:p.nome)||"Sem turma"}),e.jsx("div",{className:"text-sm text-gray-500",children:(j=n.turma)==null?void 0:j.ano_letivo})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.responsavel||((R=n.responsavel)==null?void 0:R.nome)||"Sem responsável"}),e.jsx("div",{className:"text-sm text-gray-500",children:r.email_responsavel||((L=n.responsavel)==null?void 0:L.email)})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"flex items-center space-x-1 px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:"Ativo"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.criado_em).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[(((W=n.responsavel)==null?void 0:W.telefone)||r.telefone_responsavel)&&e.jsx("a",{href:E(((z=n.responsavel)==null?void 0:z.telefone)||r.telefone_responsavel,`Olá ${((B=n.responsavel)==null?void 0:B.nome)||""}! Sobre o aluno ${r.nome}.`),target:"_blank",rel:"noopener noreferrer",onClick:A=>A.stopPropagation(),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50",title:"Abrir WhatsApp do responsável",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),F(r)},className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),k(r),M(!0)},className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50",title:"Ver detalhes do aluno",children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),J(r)},className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},r.id)})})]})})]}),e.jsx(ve,{isOpen:h,onClose:P,student:f,onSave:X},(f==null?void 0:f.id)||"new-student-modal"),e.jsx(je,{isOpen:y,onClose:()=>{M(!1),k(null)},student:f,turma:f?v.find(r=>r.id===f.turma_id):void 0,responsavel:f?S.find(r=>r.id===f.responsavel_id):void 0})]})}export{ke as AlunosAdminPage};
