import{u as L,d as H,r as i,j as e,M as $,X as te,I as ae,a as q,U as B,K as S,Q as re,z as oe,v as ie,k as le,C as ne,s as de,f as ce,N as ue,O as xe}from"./index-CCr23udO.js";import{I as me}from"./ItemDetailModal-Dr1W76Xe.js";import{G as O}from"./globe-C0WZKshV.js";import{u as pe}from"./useRealtimeRecados-C7jbUtA1.js";import{T as Q}from"./trash-2-IEheby2Z.js";import{F as he}from"./filter-ClytLayh.js";import{S as ge}from"./square-pen-CFWfA0Dv.js";import"./gradeConfig-C64ZX5y1.js";function be({isOpen:r,onClose:v,recado:l,onSave:h}){var z,V;const{user:m}=L(),{isSupabaseConnected:c}=L(),b=H(m,c),[k,C]=i.useState([]),[D,R]=i.useState([]),[t,p]=i.useState({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),[o,y]=i.useState({}),[A,M]=i.useState(!1),[F,w]=i.useState(!1);i.useEffect(()=>{r&&m&&_()},[r,m]),i.useEffect(()=>{p(l?{destinatario_tipo:l.destinatario_tipo,destinatario_id:l.destinatario_tipo==="aluno"?"":l.destinatario_id||"",aluno_id:l.destinatario_tipo==="aluno"&&l.destinatario_id||"",titulo:l.titulo,conteudo:l.conteudo}:{destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),y({}),w(!1)},[l,r]),i.useEffect(()=>{t.destinatario_tipo==="aluno"&&t.destinatario_id?P():t.destinatario_tipo!=="aluno"&&(R([]),p(a=>({...a,aluno_id:""})))},[t.destinatario_tipo,t.destinatario_id]);const _=async()=>{try{const a=await b.getTurmas();C(a)}catch(a){console.error("Erro ao carregar turmas:",a)}},P=async()=>{try{const f=(await b.getAlunos()).filter(G=>G.turma_id===t.destinatario_id);R(f)}catch(a){console.error("Erro ao carregar alunos:",a)}},E=()=>{const a={};return t.titulo.trim()||(a.titulo="Título é obrigatório"),t.conteudo.trim()||(a.conteudo="Mensagem é obrigatória"),t.destinatario_tipo!=="geral"&&!t.destinatario_id&&(a.destinatario="Selecione o destinatário"),t.destinatario_tipo==="aluno"&&!t.aluno_id&&(a.destinatario="Selecione o aluno"),y(a),Object.keys(a).length===0},T=async a=>{if(a.preventDefault(),!!E()){M(!0);try{const f={titulo:t.titulo,conteudo:t.conteudo,destinatario_tipo:t.destinatario_tipo,destinatario_id:t.destinatario_tipo==="geral"?void 0:t.destinatario_tipo==="aluno"?t.aluno_id:t.destinatario_id,enviado_por:m.id};l?(await b.updateRecado(l.id,f),console.log("✅ Recado atualizado")):(await b.createRecado(f),console.log("✅ Recado criado")),w(!0),setTimeout(()=>{h(),v(),u()},1500)}catch(f){console.error("Erro ao salvar recado:",f),y({submit:"Erro ao salvar recado"})}finally{M(!1)}}},u=()=>{p({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),y({}),w(!1)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx($,{className:"h-5 w-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Editar Recado":"Novo Recado"})]}),e.jsx("button",{onClick:()=>{v(),u()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(te,{className:"h-5 w-5 text-gray-500"})})]}),F&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:l?"Recado atualizado com sucesso!":"Recado enviado com sucesso!"})]})}),e.jsxs("form",{onSubmit:T,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Destinatário *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>p({...t,destinatario_tipo:"geral",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="geral"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(O,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Geral"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Todos os pais"})]}),e.jsxs("button",{type:"button",onClick:()=>p({...t,destinatario_tipo:"turma",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="turma"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(q,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Turma"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pais da turma"})]}),e.jsxs("button",{type:"button",onClick:()=>p({...t,destinatario_tipo:"aluno",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="aluno"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(B,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Aluno"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pai específico"})]})]})]}),t.destinatario_tipo==="turma"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:t.destinatario_id,onChange:a=>p({...t,destinatario_id:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${o.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),k.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),o.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),o.destinatario]})]}),t.destinatario_tipo==="aluno"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:t.destinatario_id,onChange:a=>p({...t,destinatario_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione uma turma primeiro"}),k.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),t.destinatario_id&&D.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Aluno *"}),e.jsxs("select",{value:t.aluno_id,onChange:a=>p({...t,aluno_id:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${o.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione um aluno"}),D.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),o.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),o.destinatario]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assunto *"}),e.jsx("input",{type:"text",value:t.titulo,onChange:a=>p({...t,titulo:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${o.titulo?"border-red-300":"border-gray-300"}`,placeholder:"Digite o assunto do recado"}),o.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),o.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem *"}),e.jsx("textarea",{value:t.conteudo,onChange:a=>p({...t,conteudo:a.target.value}),rows:6,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${o.conteudo?"border-red-300":"border-gray-300"}`,placeholder:"Digite a mensagem do recado..."}),o.conteudo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),o.conteudo]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.conteudo.length,"/1000 caracteres"]})]}),t.destinatario_tipo!=="geral"&&t.destinatario_id&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Destinatário:"}),e.jsx("div",{className:"flex items-center space-x-2",children:t.destinatario_tipo==="turma"?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Turma: ",(z=k.find(a=>a.id===t.destinatario_id))==null?void 0:z.nome]})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Aluno: ",(V=D.find(a=>a.id===t.aluno_id))==null?void 0:V.nome]})]})})]}),t.destinatario_tipo==="geral"&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Recado será enviado para todos os pais e responsáveis"})]})}),o.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),o.submit]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{v(),u()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:T,disabled:A||F,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:A?"Enviando...":l?"Salvar Alterações":"Enviar Recado"})]})]})]})}):null}function ke(){var I;const{user:r}=L(),{isSupabaseConnected:v}=L(),l=H(r,v),[h,m]=i.useState([]),[c,b]=i.useState({busca:"",tipo:"",periodo:"todos"}),[k,C]=i.useState(!1),[D,R]=i.useState(null),[t,p]=i.useState(!0),[o,y]=i.useState({}),[A,M]=i.useState({}),[F,w]=i.useState(!1),[_,P]=i.useState(null),[E,T]=i.useState(!1),u=v,{recados:z,loading:V}=pe({enabled:!!r&&u,initialFetch:!0});i.useEffect(()=>{r&&!u&&a()},[r,u]),i.useEffect(()=>{u&&m(z)},[z,u]);const a=async()=>{try{const s=await l.getRecados();m(s)}catch(s){console.error("Erro ao carregar recados:",s)}finally{p(!1)}},f=async s=>{try{const n=await ue("recado",s),x=await xe("recado",s);y(d=>({...d,[s]:{stats:n,detalhes:x}}))}catch(n){console.error("Erro ao buscar visualizações:",n)}},G=async s=>{o[s]||await f(s),M(n=>({...n,[s]:!n[s]}))},K=async s=>{if((r==null?void 0:r.tipo_usuario)==="pai")try{await ce("recado",s.id)}catch(n){console.error("Erro ao registrar visualização:",n)}P(s),w(!0)},U=h.filter(s=>{const n=!c.busca||s.titulo.toLowerCase().includes(c.busca.toLowerCase())||s.conteudo.toLowerCase().includes(c.busca.toLowerCase()),x=!c.tipo||s.destinatario_tipo===c.tipo;let d=!0;if(c.periodo!=="todos"){const g=new Date(s.data_envio),N=new Date;if(c.periodo==="hoje")d=g.toDateString()===N.toDateString();else if(c.periodo==="semana"){const j=new Date;j.setDate(N.getDate()-7),d=g>=j}else if(c.periodo==="mes"){const j=new Date;j.setMonth(N.getMonth()-1),d=g>=j}}return n&&x&&d}),X=s=>{R(s),C(!0)},J=async s=>{if(!confirm(`Tem certeza que deseja excluir o recado "${s.titulo}"?`))return;const n=u;let x=null;n&&(x=[...h],m(d=>d.filter(g=>g.id!==s.id)));try{!await l.deleteRecado(s.id)&&x&&m(x),n||a(),u&&setTimeout(()=>{l.getRecados().then(g=>{m(g)}).catch(()=>{})},800)}catch(d){console.error("Erro ao excluir recado:",d),x&&m(x),alert("Erro ao excluir recado")}},W=async()=>{if(!(r&&(r.tipo_usuario==="professor"||r.tipo_usuario==="admin"))||h.length===0||!confirm(`Excluir TODOS os ${h.length} recados? Esta ação é permanente.`))return;T(!0);const s=[...h];m([]);try{const n=s.map(d=>d.id),x=await l.bulkDeleteRecados(n);x.failedIds.length>0&&(alert(`Falha ao excluir ${x.failedIds.length} recados.`),u?setTimeout(()=>{l.getRecados().then(d=>m(d)).catch(()=>{})},500):m(s.filter(d=>x.failedIds.includes(d.id))))}catch(n){console.error("Erro ao excluir todos recados:",n),alert("Erro ao excluir recados."),m(s)}finally{T(!1)}},Y=()=>{C(!1),R(null)},Z=()=>{u||a()},ee=s=>{switch(s.destinatario_tipo){case"geral":return"Todos";case"turma":return"Turma específica";case"aluno":return"Aluno específico";default:return s.destinatario_tipo}},se=s=>{switch(s){case"geral":return"bg-blue-100 text-blue-800";case"turma":return"bg-green-100 text-green-800";case"aluno":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return t&&!u||u&&V?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl shadow-lg",children:e.jsx($,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:r.tipo_usuario==="pai"?"💌 Recados Recebidos":r.tipo_usuario==="professor"?"📢 Meus Recados":"📬 Central de Recados"}),u&&e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"Realtime"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:r.tipo_usuario==="pai"?"Comunicações importantes da escola":"Gerencie a comunicação com as famílias"})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Recado"})]}),h.length>0&&e.jsxs("button",{onClick:W,disabled:E,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${E?"bg-gray-400 cursor-not-allowed text-white":"bg-red-600 text-white hover:bg-red-700"}`,children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:E?"Excluindo...":"Excluir Todos"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(he,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por título ou conteúdo...",value:c.busca,onChange:s=>b({...c,busca:s.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:c.tipo,onChange:s=>b({...c,tipo:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"geral",children:"Geral"}),e.jsx("option",{value:"turma",children:"Turma"}),e.jsx("option",{value:"aluno",children:"Aluno"})]}),e.jsxs("select",{value:c.periodo,onChange:s=>b({...c,periodo:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"todos",children:"Todos os períodos"}),e.jsx("option",{value:"hoje",children:"Hoje"}),e.jsx("option",{value:"semana",children:"Esta semana"}),e.jsx("option",{value:"mes",children:"Este mês"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-purple-50 rounded-2xl shadow-xl border-2 border-purple-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-purple-600 uppercase tracking-wide",children:"💌 Total"}),e.jsx("p",{className:"text-3xl font-black text-purple-700",children:h.length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl shadow-lg",children:e.jsx($,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gerais"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.filter(s=>s.destinatario_tipo==="geral").length})]}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(q,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Para Turmas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.filter(s=>s.destinatario_tipo==="turma").length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(le,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Individuais"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:h.filter(s=>s.destinatario_tipo==="aluno").length})]}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(B,{className:"h-6 w-6 text-purple-600"})})]})})]}),e.jsx("div",{className:"space-y-4",children:U.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum recado encontrado"}),e.jsx("p",{className:"text-gray-500",children:r.tipo_usuario==="professor"?'Crie seu primeiro recado clicando em "Novo Recado".':"Ajuste os filtros ou aguarde novos recados."})]}):U.map(s=>{var n,x,d,g;return e.jsx("div",{className:"bg-gradient-to-br from-white via-purple-50 to-pink-50 rounded-2xl shadow-xl border-2 border-purple-200 hover:shadow-2xl hover:border-purple-400 hover:scale-105 hover:rotate-1 transition-all duration-300 cursor-pointer group",onClick:()=>K(s),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-black text-gray-900 group-hover:text-purple-700 transition-colors",children:s.titulo}),e.jsx("span",{className:`px-3 py-1 text-xs rounded-xl font-bold shadow-sm ${se(s.destinatario_tipo)}`,children:ee(s)})]}),e.jsx("p",{className:"text-gray-700 mb-3 font-medium leading-relaxed",children:s.conteudo}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(B,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:"font-bold text-gray-700",children:["👨‍🏫 Por: ",(n=s.autor)==null?void 0:n.nome]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"font-bold text-gray-700",children:["📅 ",new Date(s.data_envio).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",weekday:"short",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("p",{className:"text-xs text-purple-700 mt-3 opacity-0 group-hover:opacity-100 transition-opacity font-black bg-white px-3 py-2 rounded-xl",children:"✨ Clique para ler o recado completo"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>G(s.id),className:"p-2 text-gray-400 hover:text-green-600 transition-colors",title:"Ver quem visualizou",children:((d=(x=o[s.id])==null?void 0:x.stats)==null?void 0:d.usuariosUnicos)>0?e.jsx(de,{className:"h-4 w-4 text-green-600"}):e.jsx(S,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>X(s),className:"p-2 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>J(s),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Q,{className:"h-4 w-4"})})]})})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&o[s.id]&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsx("span",{children:"📊 Visualizações:"}),e.jsxs("span",{className:"font-medium",children:[o[s.id].stats.usuariosUnicos," usuários únicos"]})]}),o[s.id].stats.ultimaVisualizacao&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Última: ",new Date(o[s.id].stats.ultimaVisualizacao).toLocaleString("pt-BR")]})]}),A[s.id]&&((g=o[s.id])==null?void 0:g.detalhes)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Quem leu este recado:"}),e.jsxs("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:[o[s.id].detalhes.slice(0,5).map(N=>{var j;return e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:(j=N.usuario)==null?void 0:j.nome}),e.jsx("span",{className:"text-gray-500",children:new Date(N.visualizado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},N.id)}),o[s.id].detalhes.length>5&&e.jsxs("div",{className:"text-xs text-gray-400 text-center pt-1",children:["+",o[s.id].detalhes.length-5," mais..."]})]})]})]})},s.id)})}),e.jsx(be,{isOpen:k,onClose:Y,recado:D,onSave:Z}),e.jsx(me,{isOpen:F,onClose:()=>w(!1),item:_,type:"recado",autorName:(I=_==null?void 0:_.autor)==null?void 0:I.nome})]})}export{ke as RecadosPage};
