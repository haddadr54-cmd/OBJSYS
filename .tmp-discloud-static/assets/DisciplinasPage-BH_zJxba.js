import{r as i,a4 as R,a5 as L,j as e,B as C,X as z,I as $,K as k,a as P,U,c as q,n as Z,ai as O,aj as ee,ak as se,C as ae,u as re,d as te,z as le,v as oe,k as I}from"./index-CCr23udO.js";import{S as K}from"./square-pen-CFWfA0Dv.js";import{S as ie}from"./save-BDGo1Gz5.js";import{u as ce}from"./useDataRefresh-Bc19hZJI.js";import{F as ne}from"./filter-ClytLayh.js";import{T as de}from"./trash-2-IEheby2Z.js";function me({isOpen:h,onClose:v,disciplina:a,onSave:E}){const[m,f]=i.useState([]),[_,b]=i.useState([]),[t,n]=i.useState({nome:"",codigo:"",carga_horaria:"",professor_id:"",turma_id:"",cor:"#3B82F6",descricao:"",ativa:!0}),[c,d]=i.useState({}),[j,S]=i.useState(!1),[o,x]=i.useState(!1);i.useEffect(()=>{h&&N()},[h]),i.useEffect(()=>{var s;n(a?{nome:a.nome,codigo:a.codigo||"",carga_horaria:((s=a.carga_horaria)==null?void 0:s.toString())||"",professor_id:a.professor_id||"",turma_id:a.turma_id||"",cor:a.cor||"#3B82F6",descricao:a.descricao||"",ativa:a.ativa??!0}:{nome:"",codigo:"",carga_horaria:"",professor_id:"",turma_id:"",cor:"#3B82F6",descricao:"",ativa:!0}),d({}),x(!1)},[a,h]);const N=async()=>{try{const[s,u]=await Promise.all([R(),L()]);f(s),b(u.filter(T=>T.tipo_usuario==="professor"))}catch(s){console.error("Erro ao carregar dados:",s)}},F=()=>{const s={};return(!t.nome.trim()||t.nome.length<2)&&(s.nome="Nome da disciplina deve ter pelo menos 2 caracteres"),(!t.codigo.trim()||t.codigo.length<2)&&(s.codigo="Código deve ter pelo menos 2 caracteres"),t.turma_id||(s.turma_id="Turma é obrigatória"),t.carga_horaria&&(isNaN(parseInt(t.carga_horaria))||parseInt(t.carga_horaria)<1)&&(s.carga_horaria="Carga horária deve ser um número maior que 0"),d(s),Object.keys(s).length===0},y=async s=>{if(s.preventDefault(),!!F()){S(!0);try{const u={nome:t.nome,professor_id:t.professor_id||null,turma_id:t.turma_id};a?(await O(a.id,u),console.log("✅ Disciplina atualizada")):(await ee(u),console.log("✅ Disciplina criada")),x(!0),setTimeout(()=>{E(),v(),w()},1500)}catch(u){console.error("Erro ao salvar disciplina:",u),d({submit:"Erro ao salvar disciplina"})}finally{S(!1)}}},w=()=>{n({nome:"",codigo:"",carga_horaria:"",professor_id:"",turma_id:"",cor:"#3B82F6",descricao:"",ativa:!0}),d({}),x(!1)},l=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316","#EC4899","#6366F1"];return h?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(C,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Editar Disciplina":"Nova Disciplina"})]}),e.jsx("button",{onClick:()=>{v(),w()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(z,{className:"h-5 w-5 text-gray-500"})})]}),o&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a?"Disciplina atualizada com sucesso!":"Disciplina cadastrada com sucesso!"})]})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Disciplina *"}),e.jsx("input",{type:"text",value:t.nome,onChange:s=>n({...t,nome:s.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.nome?"border-red-300":"border-gray-300"}`,placeholder:"Ex: Matemática, Português"}),c.nome&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),c.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Código/Sigla *"}),e.jsx("input",{type:"text",value:t.codigo,onChange:s=>n({...t,codigo:s.target.value.toUpperCase()}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.codigo?"border-red-300":"border-gray-300"}`,placeholder:"Ex: MAT, POR, CIE",maxLength:5}),c.codigo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),c.codigo]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Turma *"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t.turma_id,onChange:s=>n({...t,turma_id:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.turma_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.nome," - ",s.ano_letivo]},s.id))]})]}),c.turma_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),c.turma_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Professor Responsável *"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t.professor_id,onChange:s=>n({...t,professor_id:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.professor_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione um professor"}),_.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),c.professor_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),c.professor_id]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Carga Horária Semanal"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",min:"1",max:"40",value:t.carga_horaria,onChange:s=>n({...t,carga_horaria:s.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.carga_horaria?"border-red-300":"border-gray-300"}`,placeholder:"Ex: 4 (horas por semana)"})]}),c.carga_horaria&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),c.carga_horaria]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de horas semanais da disciplina (opcional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cor da Disciplina"}),e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Escolha uma cor para identificar a disciplina"})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:l.map(s=>e.jsx("button",{type:"button",onClick:()=>n({...t,cor:s}),className:`w-12 h-12 rounded-lg border-2 transition-all ${t.cor===s?"border-gray-800 scale-110":"border-gray-300 hover:scale-105"}`,style:{backgroundColor:s},title:s},s))}),e.jsxs("div",{className:"mt-3 flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:t.cor,onChange:s=>n({...t,cor:s.target.value}),className:"w-12 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:t.cor,onChange:s=>n({...t,cor:s.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"#3B82F6"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("textarea",{value:t.descricao,onChange:s=>n({...t,descricao:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Objetivos da disciplina, conteúdo programático..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:t.ativa?"ativa":"inativa",onChange:s=>n({...t,ativa:s.target.value==="ativa"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ativa",children:"Ativa"}),e.jsx("option",{value:"inativa",children:"Inativa"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Informações Importantes:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• O código da disciplina deve ser único"}),e.jsx("li",{children:"• A cor ajuda na identificação visual nos relatórios"}),e.jsx("li",{children:"• Disciplinas inativas não aparecem nas listas de seleção"}),e.jsx("li",{children:"• A carga horária é usada para cálculos de relatórios"}),e.jsx("li",{children:"• Professor e turma podem ser atribuídos posteriormente"})]})]}),c.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),c.submit]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{v(),w()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:j||o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Salvando...":a?"Salvar Alterações":"Cadastrar Disciplina"})]})]})]})}):null}function xe({isOpen:h,onClose:v,disciplina:a,onSave:E}){const[m,f]=i.useState(!1),[_,b]=i.useState(!1),[t,n]=i.useState(!1),[c,d]=i.useState([]),[j,S]=i.useState([]),[o,x]=i.useState({nome:"",codigo:"",descricao:"",cor:"#3B82F6",professor_id:"",ativa:!0}),N=i.useMemo(()=>se(async()=>{try{const[l,s]=await Promise.all([R(),L()]);d(l);const u=s.filter(T=>T.tipo_usuario==="professor");S(u)}catch(l){console.error("Erro ao carregar dados:",l)}},500),[]);i.useEffect(()=>{h&&c.length===0&&N()},[h,N,c.length]),i.useEffect(()=>{a&&x({nome:a.nome,codigo:a.codigo||"",descricao:a.descricao||"",cor:a.cor||"#3B82F6",professor_id:a.professor_id||"",ativa:a.ativa??!0})},[a]);const F=async()=>{if(a){b(!0);try{await O(a.id,{nome:o.nome,codigo:o.codigo,descricao:o.descricao,cor:o.cor,professor_id:o.professor_id||void 0,ativa:o.ativa}),n(!0),f(!1),setTimeout(()=>{n(!1),E()},1500)}catch(l){console.error("Erro ao salvar disciplina:",l)}finally{b(!1)}}},y=l=>{const s=j.find(u=>u.id===l);return(s==null?void 0:s.nome)||"Não atribuído"},w=l=>{const s=c.find(u=>u.id===l);return(s==null?void 0:s.nome)||"Turma não encontrada"};return!h||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 rounded-full text-white",style:{backgroundColor:o.cor},children:e.jsx(C,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:m?"Editar Disciplina":"Detalhes da Disciplina"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Criada em ",new Date(a.criado_em).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!m&&e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:"Editar"})]}),e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(z,{className:"h-5 w-5 text-gray-500"})})]})]}),t&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Disciplina atualizada com sucesso!"})]})}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Informações Básicas"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome da Disciplina"}),m?e.jsx("input",{type:"text",value:o.nome,onChange:l=>x({...o,nome:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}):e.jsx("p",{className:"text-gray-900 font-medium",children:a.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Código/Sigla"}),m?e.jsx("input",{type:"text",value:o.codigo,onChange:l=>x({...o,codigo:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ex: MAT, POR, CIE"}):e.jsx("p",{className:"text-gray-900",children:a.codigo||"Não definido"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cor da Disciplina"}),m?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:o.cor,onChange:l=>x({...o,cor:l.target.value}),className:"w-12 h-10 border border-gray-300 rounded cursor-pointer"}),e.jsx("input",{type:"text",value:o.cor,onChange:l=>x({...o,cor:l.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded border border-gray-300",style:{backgroundColor:a.cor||"#3B82F6"}}),e.jsx("span",{className:"text-gray-900",children:a.cor||"#3B82F6"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),m?e.jsxs("select",{value:o.ativa?"ativa":"inativa",onChange:l=>x({...o,ativa:l.target.value==="ativa"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ativa",children:"Ativa"}),e.jsx("option",{value:"inativa",children:"Inativa"})]}):e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${a.ativa?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.ativa?"Ativa":"Inativa"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2",children:"Atribuições"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Professor Responsável"}),m?e.jsxs("select",{value:o.professor_id,onChange:l=>x({...o,professor_id:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione um professor"}),j.map(l=>e.jsx("option",{value:l.id,children:l.nome},l.id))]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-semibold",children:y(a.professor_id||"").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-gray-900",children:y(a.professor_id||"")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Turma Associada"}),e.jsx("div",{className:"text-gray-900",children:a.turma_id?w(a.turma_id):"Nenhuma turma associada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data de Criação"}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-900",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:new Date(a.criado_em).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4",children:"Descrição"}),m?e.jsx("textarea",{value:o.descricao,onChange:l=>x({...o,descricao:l.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Descrição da disciplina, objetivos, conteúdo programático..."}):e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.descricao||"Nenhuma descrição fornecida."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Turmas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"1"})]}),e.jsx(P,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Alunos"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:"0"})]}),e.jsx(U,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Notas"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"0"})]}),e.jsx(C,{className:"h-8 w-8 text-purple-600"})]})})]})]})]}),m&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{f(!1),a&&x({nome:a.nome,codigo:a.codigo||"",descricao:a.descricao||"",cor:a.cor||"#3B82F6",professor_id:a.professor_id||"",ativa:a.ativa??!0})},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:F,disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:_?"Salvando...":"Salvar Alterações"})]})]})]})})}function je(){const{user:h,isSupabaseConnected:v}=re(),a=te(h,v),{refreshKey:E,triggerRefresh:m}=ce(),[f,_]=i.useState([]),[b,t]=i.useState([]),[n,c]=i.useState([]),[d,j]=i.useState({busca:"",turma:"",professor:""}),[S,o]=i.useState(!1),[x,N]=i.useState(null),[F,y]=i.useState(!1),[w,l]=i.useState(null),[s,u]=i.useState(!0);i.useEffect(()=>{T()},[E]);const T=async()=>{try{const[r,g]=await Promise.all([a.getDisciplinas(),a.getTurmas()]);if(_(r),t(g),(h==null?void 0:h.tipo_usuario)==="admin"){const p=(await a.getUsuarios()).filter(B=>B.tipo_usuario==="professor");c(p)}}catch(r){console.error("Erro ao carregar dados:",r)}finally{u(!1)}},V=r=>{const g=b.find(p=>p.id===r.turma_id),D=n.find(p=>p.id===r.professor_id);return{...r,turma:g,professor:D}},A=f.filter(r=>{const g=!d.busca||r.nome.toLowerCase().includes(d.busca.toLowerCase()),D=!d.turma||r.turma_id===d.turma,p=!d.professor||r.professor_id===d.professor;return g&&D&&p}),G=r=>{N(r),o(!0)},H=r=>{confirm(`Tem certeza que deseja excluir a disciplina ${r.nome}?

Esta ação não pode ser desfeita.`)&&W(r.id)},W=async r=>{try{await a.deleteDisciplina(r),m()}catch(g){console.error("Erro ao excluir disciplina:",g),g instanceof Error&&g.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para excluir disciplinas. Verifique sua conexão."):alert("Erro ao excluir disciplina")}},X=()=>{o(!1),N(null)},J=()=>{m()},M=()=>{y(!1),l(null)},Q=()=>{m(),M()},Y=r=>{l(r),y(!0)};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-6"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:"Carregando disciplinas..."}),e.jsx("p",{className:"text-lg text-gray-500 mt-2",children:"Aguarde um momento"})]})}):e.jsxs("div",{className:"space-y-6 sm:space-y-8 lg:space-y-12",children:[e.jsx("div",{className:"bg-gradient-to-br from-white via-blue-50 to-indigo-50 rounded-2xl sm:rounded-3xl shadow-xl border-2 border-blue-200 p-6 sm:p-8 lg:p-12 hover:shadow-2xl transition-all duration-500",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-6 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 rounded-2xl sm:rounded-3xl shadow-2xl mx-auto sm:mx-0",children:e.jsx(C,{className:"h-10 w-10 sm:h-12 sm:w-12 lg:h-16 lg:w-16 text-white"})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"📚 Gestão de Disciplinas"}),e.jsx("p",{className:"text-gray-700 mt-2 sm:mt-4 text-lg sm:text-xl lg:text-2xl font-bold",children:"🎯 Organize e gerencie todas as matérias do currículo"})]})]}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>o(!0),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center space-x-2",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:"Nova Disciplina"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ne,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome da disciplina...",value:d.busca,onChange:r=>j({...d,busca:r.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:d.turma,onChange:r=>j({...d,turma:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as turmas"}),b.map(r=>e.jsx("option",{value:r.id,children:r.nome},r.id))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:e.jsxs("select",{value:d.professor,onChange:r=>j({...d,professor:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os professores"}),n.map(r=>e.jsx("option",{value:r.id,children:r.nome},r.id))]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-blue-600 uppercase tracking-wide",children:"📚 Total"}),e.jsx("p",{className:"text-3xl font-black text-blue-700",children:f.length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(C,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Professores"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Turmas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.length})]}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(I,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Média por Turma"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:b.length>0?Math.round(f.length/b.length):0})]}),e.jsx("div",{className:"p-2 bg-yellow-50 rounded-full",children:e.jsx(C,{className:"h-6 w-6 text-yellow-600"})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:A.length===0?e.jsxs("div",{className:"col-span-full bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma disciplina encontrada"}),e.jsx("p",{className:"text-gray-500",children:"Ajuste os filtros ou crie uma nova disciplina."})]}):A.map(r=>{var D,p;const g=V(r);return e.jsx("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-2xl shadow-xl border-2 border-blue-200 hover:shadow-2xl hover:border-blue-400 hover:scale-110 hover:rotate-1 transition-all duration-300 cursor-pointer group",onClick:()=>Y(r),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg",children:r.codigo||r.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-gray-900 group-hover:text-blue-700 transition-colors text-lg",children:r.nome}),e.jsx("p",{className:"text-sm text-gray-600 font-bold",children:r.codigo||"Sem código"})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:B=>{B.stopPropagation(),G(r)},className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"Editar disciplina",children:e.jsx(K,{className:"h-4 w-4"})}),e.jsx("button",{onClick:B=>{B.stopPropagation(),H(r)},className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Excluir disciplina",children:e.jsx(de,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"🏫 Turma"})]}),e.jsx("span",{className:"text-sm font-black text-gray-900 truncate max-w-40",children:((D=g.turma)==null?void 0:D.nome)||"Não atribuída"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"👨‍🏫 Professor"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate max-w-40",children:((p=g.professor)==null?void 0:p.nome)||"Não atribuído"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm text-gray-700 font-bold",children:"⏰ Carga"})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[r.carga_horaria||0,"h"]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"Criada em"}),e.jsx("span",{children:new Date(r.criado_em).toLocaleDateString("pt-BR")})]})})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 text-center",children:e.jsx("p",{className:"text-xs text-blue-700 opacity-0 group-hover:opacity-100 transition-opacity font-black bg-blue-100 px-3 py-2 rounded-xl",children:"✨ Clique para ver detalhes completos"})})]})},r.id)})}),e.jsx(me,{isOpen:S,onClose:X,disciplina:x,onSave:J}),e.jsx(xe,{isOpen:F,onClose:M,disciplina:w,onSave:Q})]})}export{je as DisciplinasPage};
