import{g as re,r as i,j as e,U as B,X as F,I as M,K as S,b as q,W as le,Y as V,E as I,l as L,a1 as G,a2 as oe,a3 as R,Q as ie,P as ne,q as O,C as ce,c as de,u as xe,d as me,a as $,z as ue,v as he}from"./index-CCr23udO.js";import{u as pe}from"./useDataRefresh-Bc19hZJI.js";import{R as ge}from"./refresh-cw-DeA23GkC.js";import{U as A}from"./user-check-Gjly-lFN.js";import{U as K}from"./user-x-Dbdoo9ik.js";import{F as fe}from"./filter-ClytLayh.js";import{S as be}from"./square-pen-CFWfA0Dv.js";import{T as je}from"./trash-2-IEheby2Z.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=re("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function Ne({isOpen:g,onClose:u,user:a,onSave:v}){const[t,c]=i.useState({nome:"",email:"",senha:"",tipo_usuario:"pai",telefone:"",ativo:!0}),[h,n]=i.useState(!1),[r,x]=i.useState({}),[d,p]=i.useState(!1),[f,N]=i.useState(!1);i.useEffect(()=>{c(a?{nome:a.nome,email:a.email,senha:"",tipo_usuario:a.tipo_usuario,telefone:a.telefone||"",ativo:a.ativo}:{nome:"",email:"",senha:"",tipo_usuario:"pai",telefone:"",ativo:!0}),x({}),N(!1)},[a,g]);const y=()=>{const l={};(!t.nome.trim()||t.nome.length<3)&&(l.nome="Nome deve ter pelo menos 3 caracteres");const m=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.email.trim()?m.test(t.email)||(l.email="Formato de e-mail inválido"):l.email="E-mail é obrigatório",(!a&&(!t.senha||t.senha.length<6)||a&&t.senha&&t.senha.length<6)&&(l.senha="Senha deve ter pelo menos 6 caracteres"),x(l),Object.keys(l).length===0},b=async l=>{if(l.preventDefault(),!!y()){p(!0);try{if(a){const m={nome:t.nome,tipo_usuario:t.tipo_usuario,telefone:t.telefone,ativo:t.ativo};t.senha&&(m.senha=t.senha),await G(a.id,m),console.log("✅ Usuário atualizado")}else await oe({nome:t.nome,email:t.email,senha:t.senha,tipo_usuario:t.tipo_usuario,telefone:t.telefone,ativo:t.ativo}),console.log("✅ Usuário criado");N(!0),setTimeout(()=>{v(),u()},1500)}catch(m){console.error("Erro ao salvar usuário:",m),m instanceof Error&&m.message.includes("Supabase")?x({submit:"Erro: Sistema requer conexão com Supabase para salvar usuários. Verifique sua conexão."}):x({submit:"Erro ao salvar usuário"})}finally{p(!1)}}};return g?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(B,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a?"Editar Usuário":"Novo Usuário"})]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(F,{className:"h-5 w-5 text-gray-500"})})]}),f&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:a?"Usuário atualizado com sucesso!":"Usuário cadastrado com sucesso!"})]})}),e.jsxs("form",{onSubmit:b,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:t.nome,onChange:l=>c({...t,nome:l.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.nome?"border-red-300":"border-gray-300"}`,placeholder:"Digite o nome completo"}),r.nome&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),r.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E-mail *"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"email",value:t.email,onChange:l=>c({...t,email:l.target.value}),disabled:!!a,className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.email?"border-red-300":"border-gray-300"} ${a?"bg-gray-50 cursor-not-allowed":""}`,placeholder:"usuario@escola.com"})]}),r.email&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),r.email]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Senha ",!a&&"*",a&&e.jsx("span",{className:"text-gray-500 text-xs",children:"(deixe em branco para não alterar)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:h?"text":"password",value:t.senha,onChange:l=>c({...t,senha:l.target.value}),className:`w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.senha?"border-red-300":"border-gray-300"}`,placeholder:a?"Nova senha (opcional)":"Digite a senha"}),e.jsx("button",{type:"button",onClick:()=>n(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:h?e.jsx(V,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"})})]}),r.senha&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),r.senha]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Usuário *"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:t.tipo_usuario,onChange:l=>c({...t,tipo_usuario:l.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.tipo_usuario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"pai",children:"Pai/Responsável"}),e.jsx("option",{value:"professor",children:"Professor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),r.tipo_usuario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),r.tipo_usuario]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),e.jsx("input",{type:"tel",value:t.telefone,onChange:l=>c({...t,telefone:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"(11) 99999-9999"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:t.ativo?"ativo":"inativo",onChange:l=>c({...t,ativo:l.target.value==="ativo"}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Permissões por tipo:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Admin:"})," Acesso total ao sistema"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Professor:"})," Painel docente (turmas, notas, presença)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Pai:"})," Acesso limitado (notas e presença dos filhos)"]})]})]}),r.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),r.submit]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:d||f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Salvando...":a?"Salvar Alterações":"Cadastrar Usuário"})]})]})]})}):null}function ye({isOpen:g,onClose:u,user:a,onSave:v}){const[t,c]=i.useState("auto"),[h,n]=i.useState(""),[r,x]=i.useState(!1),[d,p]=i.useState(!1),[f,N]=i.useState(!1),[y,b]=i.useState(""),[l,m]=i.useState(!1);i.useEffect(()=>{g&&(t==="manual"&&C(),N(!1),b(""),m(!1))},[g,t]);const C=()=>{const j="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";let E="";for(let w=0;w<8;w++)E+=j.charAt(Math.floor(Math.random()*j.length));n(E)},_=async()=>{if(a){p(!0),b("");try{await new Promise(j=>setTimeout(j,2e3)),m(!0),N(!0),setTimeout(()=>{v(),u()},3e3)}catch{b("Erro ao enviar e-mail de redefinição")}finally{p(!1)}}},U=async()=>{if(!(!a||!h)){p(!0),b("");try{await G(a.id,{senha:h}),N(!0),setTimeout(()=>{v(),u()},3e3)}catch{b("Erro ao redefinir senha")}finally{p(!1)}}},D=()=>{navigator.clipboard.writeText(h),alert("Senha copiada para a área de transferência!")},k=()=>{c("auto"),n(""),x(!1),p(!1),N(!1),b(""),m(!1)};return!g||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-orange-50 rounded-full",children:e.jsx(R,{className:"h-5 w-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Redefinir Senha"})]}),e.jsx("button",{onClick:()=>{u(),k()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(F,{className:"h-5 w-5 text-gray-500"})})]}),f&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:t==="auto"?"E-mail de redefinição enviado com sucesso!":"Senha redefinida com sucesso!"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:a.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.tipo_usuario==="admin"?"bg-purple-100 text-purple-800":a.tipo_usuario==="professor"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:a.tipo_usuario==="admin"?"Administrador":a.tipo_usuario==="professor"?"Professor":"Pai/Responsável"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Método de Redefinição"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>c("auto"),className:`p-4 border rounded-lg text-center transition-colors ${t==="auto"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(q,{className:"h-5 w-5 mx-auto mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Automático"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por e-mail"})]}),e.jsxs("button",{onClick:()=>c("manual"),className:`p-4 border rounded-lg text-center transition-colors ${t==="manual"?"border-orange-500 bg-orange-50 text-orange-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(R,{className:"h-5 w-5 mx-auto mb-2"}),e.jsx("span",{className:"text-sm font-medium",children:"Manual"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nova senha"})]})]})]}),t==="auto"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"📧 Redefinição Automática"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• E-mail será enviado para: ",e.jsx("strong",{children:a.email})]}),e.jsx("li",{children:"• Link válido por 24 horas"}),e.jsx("li",{children:"• Usuário define nova senha"}),e.jsx("li",{children:"• Processo seguro e automático"})]})]}),l?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(M,{className:"h-8 w-8 text-green-600"})}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"E-mail Enviado!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"O usuário receberá as instruções em breve."})]}):e.jsxs("button",{onClick:_,disabled:d,className:"w-full flex items-center justify-center space-x-2 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{children:d?"Enviando...":"Enviar E-mail de Redefinição"})]})]}),t==="manual"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"🔧 Redefinição Manual"}),e.jsxs("ul",{className:"text-sm text-orange-700 space-y-1",children:[e.jsx("li",{children:"• Nova senha gerada automaticamente"}),e.jsx("li",{children:"• Usuário deve alterar no primeiro login"}),e.jsx("li",{children:"• Senha temporária válida por 7 dias"}),e.jsx("li",{children:"• Notificação por e-mail opcional"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nova Senha Temporária"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:r?"text":"password",value:h,onChange:j=>n(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Nova senha"}),e.jsx("button",{type:"button",onClick:()=>x(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:r?e.jsx(V,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:C,className:"p-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",title:"Gerar nova senha",children:e.jsx(ge,{className:"h-4 w-4 text-gray-600"})}),e.jsx("button",{onClick:D,className:"p-2 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors",title:"Copiar senha",children:e.jsx(ve,{className:"h-4 w-4 text-blue-600"})})]})]}),e.jsxs("button",{onClick:U,disabled:d||!h,className:"w-full flex items-center justify-center space-x-2 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:d?"Redefinindo...":"Redefinir Senha"})]})]}),y&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:y})]})})]}),!f&&e.jsx("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{u(),k()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"})})]})})}const we=({isOpen:g,onClose:u,user:a})=>{if(!g||!a)return null;const v=r=>{switch(r){case"admin":return"Administrador";case"professor":return"Professor";case"pai":return"Pai/Responsável";default:return r}},t=r=>{switch(r){case"admin":return"bg-purple-100 text-purple-800";case"professor":return"bg-green-100 text-green-800";case"pai":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},c=r=>{switch(r){case"admin":return"👑";case"professor":return"🎓";case"pai":return"👨‍👩‍👧‍👦";default:return"👤"}},h=r=>{switch(r){case"admin":return["Acesso total ao sistema","Gerenciar usuários e permissões","Configurações do sistema","Relatórios e estatísticas","Backup e manutenção"];case"professor":return["Painel do professor","Gerenciar turmas e disciplinas","Lançar notas e presença","Criar materiais didáticos","Enviar recados aos pais"];case"pai":return["Visualizar notas dos filhos","Acompanhar frequência","Receber comunicados","Agenda de provas e tarefas","Baixar materiais didáticos"];default:return["Permissões não definidas"]}},n=(r,x)=>{if(!r)return"";const d=String(r).replace(/\D/g,""),p=d.startsWith("55")?d:`55${d}`,f=x?`?text=${encodeURIComponent(x)}`:"";return`https://wa.me/${p}${f}`};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 relative",children:[e.jsx("button",{onClick:u,className:"absolute top-4 right-4 p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-all duration-300",children:e.jsx(F,{className:"h-6 w-6"})}),e.jsx("div",{className:"pr-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center text-white font-black text-2xl",children:a.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black",children:a.nome}),e.jsxs("p",{className:"text-blue-100 flex items-center mt-1",children:[e.jsx("span",{className:"mr-2",children:c(a.tipo_usuario)}),v(a.tipo_usuario)]})]})]})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2 text-blue-600"}),"Informações Pessoais"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Nome Completo"}),e.jsx("p",{className:"text-gray-800 font-medium",children:a.nome})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"E-mail"}),e.jsxs("p",{className:"text-gray-800 flex items-center",children:[e.jsx(q,{className:"h-4 w-4 mr-2 text-gray-500"}),a.email]})]}),a.telefone&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Telefone"}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-800",children:[e.jsxs("p",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-gray-500"}),a.telefone]}),e.jsxs("a",{href:n(a.telefone,`Olá ${a.nome}!`),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-2 py-1 text-xs rounded bg-green-100 text-green-800 hover:bg-green-200",title:"Abrir WhatsApp",children:[e.jsx(O,{className:"h-3 w-3 mr-1"})," WhatsApp"]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2 text-purple-600"}),"Status e Tipo"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo de Usuário"}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:`px-3 py-2 text-sm rounded-full font-medium ${t(a.tipo_usuario)}`,children:[c(a.tipo_usuario)," ",v(a.tipo_usuario)]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Status"}),e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:`flex items-center space-x-2 px-3 py-2 text-sm rounded-full font-medium ${a.ativo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[a.ativo?e.jsx(A,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{children:a.ativo?"Ativo":"Inativo"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Cadastrado em"}),e.jsxs("p",{className:"text-gray-800 flex items-center mt-1",children:[e.jsx(ce,{className:"h-4 w-4 mr-2 text-gray-500"}),new Date(a.criado_em).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2 text-blue-600"}),"Permissões e Acessos"]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:h(a.tipo_usuario).map((r,x)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-xl",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700 font-medium",children:r})]},x))})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx(de,{className:"h-5 w-5 mr-2 text-gray-600"}),"Informações Técnicas"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"ID do Usuário"}),e.jsx("p",{className:"text-gray-800 font-mono text-sm bg-gray-200 px-2 py-1 rounded mt-1",children:a.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Data de Criação"}),e.jsx("p",{className:"text-gray-800 text-sm mt-1",children:new Date(a.criado_em).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Ações Disponíveis"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsx("p",{children:"• Para editar este usuário, feche este modal e clique no botão de edição (✏️)"}),e.jsx("p",{children:"• Para redefinir a senha, use o botão de chave (🔑)"}),e.jsx("p",{children:"• Para enviar mensagem WhatsApp, use o botão de mensagem (💬)"}),e.jsx("p",{children:"• O status pode ser alterado clicando no badge de status na tabela"})]})]})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 flex justify-end",children:e.jsx("button",{onClick:u,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:"Fechar"})})]})})};function _e(){const{user:g,isSupabaseConnected:u}=xe(),a=me(g,u),{refreshKey:v,triggerRefresh:t}=pe(),[c,h]=i.useState([]),[n,r]=i.useState({busca:"",tipo:"",status:""}),[x,d]=i.useState(!1),[p,f]=i.useState(null),[N,y]=i.useState(!0),[b,l]=i.useState(!1),[m,C]=i.useState(null),[_,U]=i.useState(!1),[D,k]=i.useState(null);i.useEffect(()=>{j()},[v]);const j=async()=>{try{const s=await a.getUsuarios();h(s)}catch(s){console.error("Erro ao carregar usuários:",s)}finally{y(!1)}},E=(s,o)=>{if(!s)return"";const P=String(s).replace(/\D/g,""),T=P.startsWith("55")?P:`55${P}`,te=o?`?text=${encodeURIComponent(o)}`:"";return`https://wa.me/${T}${te}`},w=c.filter(s=>{const o=!n.busca||s.nome.toLowerCase().includes(n.busca.toLowerCase())||s.email.toLowerCase().includes(n.busca.toLowerCase()),P=!n.tipo||s.tipo_usuario===n.tipo,T=!n.status||n.status==="ativo"&&s.ativo||n.status==="inativo"&&!s.ativo;return o&&P&&T}),X=s=>{f(s),d(!0)},Q=s=>{confirm(`Tem certeza que deseja excluir o usuário ${s.nome}?`)&&Y(s.id)},Y=async s=>{try{await a.deleteUsuario(s),t()}catch(o){console.error("Erro ao excluir usuário:",o),o instanceof Error&&o.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para excluir usuários. Verifique sua conexão."):alert("Erro ao excluir usuário")}},H=async s=>{try{await a.updateUsuario(s.id,{ativo:!s.ativo}),t()}catch(o){console.error("Erro ao alterar status:",o),o instanceof Error&&o.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para alterar status. Verifique sua conexão."):alert("Erro ao alterar status do usuário")}},J=async()=>{try{t(),z()}catch(s){console.error("Erro ao salvar usuário:",s),s instanceof Error&&s.message.includes("Supabase")?alert("❌ Erro: Sistema requer conexão com Supabase para salvar usuários. Verifique sua conexão."):alert("Erro ao excluir usuário")}},z=()=>{d(!1),f(null)},Z=s=>{C(s),l(!0)},W=()=>{l(!1),C(null)},ee=()=>{t(),W()},se=s=>{switch(s){case"admin":return"Administrador";case"professor":return"Professor";case"pai":return"Pai/Responsável";default:return s}},ae=s=>{switch(s){case"admin":return"bg-purple-100 text-purple-800";case"professor":return"bg-green-100 text-green-800";case"pai":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return N?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-6"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:"Carregando usuários..."}),e.jsx("p",{className:"text-lg text-gray-500 mt-2",children:"Aguarde um momento"})]})}):e.jsxs("div",{className:"space-y-6 sm:space-y-8 lg:space-y-12",children:[e.jsx("div",{className:"bg-gradient-to-br from-white via-green-50 to-emerald-50 rounded-2xl sm:rounded-3xl shadow-xl border-2 border-green-200 p-6 sm:p-8 lg:p-12 animate-slide-in-up hover:shadow-2xl transition-all duration-500",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-6 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-br from-green-500 via-emerald-500 to-teal-600 rounded-2xl sm:rounded-3xl shadow-2xl mx-auto sm:mx-0 animate-float",children:e.jsx($,{className:"h-10 w-10 sm:h-12 sm:w-12 lg:h-16 lg:w-16 text-white"})}),e.jsxs("div",{className:"text-center sm:text-left",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 bg-clip-text text-transparent animate-glow",children:"👥 Gestão de Usuários"}),e.jsx("p",{className:"text-gray-700 mt-2 sm:mt-4 text-lg sm:text-xl lg:text-2xl font-bold",children:"🎯 Gerencie professores, alunos e administradores"})]})]}),e.jsx("div",{className:"flex items-center justify-center sm:justify-end",children:e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center space-x-3 px-6 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-2xl hover:from-green-700 hover:to-emerald-700 transition-all duration-300 shadow-xl hover:shadow-2xl hover:scale-105 font-black text-lg",children:[e.jsx(ue,{className:"h-5 w-5 sm:h-6 sm:w-6"}),e.jsx("span",{children:"Novo Usuário"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(fe,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou email...",value:n.busca,onChange:s=>r({...n,busca:s.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:n.tipo,onChange:s=>r({...n,tipo:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"professor",children:"Professor"}),e.jsx("option",{value:"pai",children:"Pai/Responsável"})]}),e.jsxs("select",{value:n.status,onChange:s=>r({...n,status:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"ativo",children:"Ativo"}),e.jsx("option",{value:"inativo",children:"Inativo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.length})]}),e.jsx($,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Administradores"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.filter(s=>s.tipo_usuario==="admin").length})]}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(A,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Professores"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.tipo_usuario==="professor").length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(A,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pais"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(s=>s.tipo_usuario==="pai").length})]}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx($,{className:"h-6 w-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Usuários (",w.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Criado em"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"Nenhum usuário encontrado com os filtros aplicados"})}):w.map(s=>e.jsxs("tr",{className:"hover:bg-blue-50 hover:shadow-md transition-all cursor-pointer group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold mr-3",children:s.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 group-hover:text-blue-700 transition-colors",children:s.nome}),s.telefone&&e.jsx("div",{className:"text-sm text-gray-500",children:s.telefone})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${ae(s.tipo_usuario)}`,children:se(s.tipo_usuario)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("button",{onClick:o=>{o.stopPropagation(),H(s)},className:`flex items-center space-x-1 px-2 py-1 text-xs rounded-full ${s.ativo?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"} transition-colors`,children:[s.ativo?e.jsx(A,{className:"h-3 w-3"}):e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{children:s.ativo?"Ativo":"Inativo"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.criado_em).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[s.telefone&&e.jsx("a",{href:E(s.telefone,`Olá ${s.nome}!`),target:"_blank",rel:"noopener noreferrer",onClick:o=>o.stopPropagation(),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50",title:"Abrir WhatsApp",children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),Z(s)},className:"text-orange-600 hover:text-orange-900 p-1 rounded hover:bg-orange-50",title:"Redefinir senha",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),X(s)},className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),k(s),U(!0)},className:"text-gray-600 hover:text-gray-900 p-1 rounded hover:bg-gray-50",title:"Ver detalhes",children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),Q(s)},className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",children:e.jsx(je,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsx(Ne,{isOpen:x,onClose:z,user:p,onSave:J}),e.jsx(ye,{isOpen:b,onClose:W,user:m,onSave:ee}),e.jsx(we,{isOpen:_,onClose:()=>{U(!1),k(null)},user:D})]})}export{_e as UsuariosPage};
