import{g as le,u as U,d as ie,r as l,j as e,B as Z,X as oe,I as ce,K as d,a as q,C as ne,Z as de}from"./index-CCr23udO.js";import{getNotaBorderBgClasses as me,getNotaBgColor as xe,formatarNota as x,getNotaTextColor as ue,MEDIA_MINIMA_APROVACAO as g,MEDIA_MINIMA_RECUPERACAO as f}from"./gradeConfig-C64ZX5y1.js";import{S as he}from"./save-BDGo1Gz5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=le("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function je({isOpen:j,onClose:N,onSave:K}){const{user:v}=U(),{isSupabaseConnected:Q}=U(),u=ie(v,Q),[h,X]=l.useState([]),[A,G]=l.useState([]),[y,H]=l.useState([]),[i,w]=l.useState(""),[c,p]=l.useState(""),[S,M]=l.useState("1"),[I,_]=l.useState(""),[$,R]=l.useState(""),[o,b]=l.useState([]),[L,P]=l.useState(!1),[B,V]=l.useState(!1),[r,C]=l.useState({}),[m,z]=l.useState("");l.useEffect(()=>{j&&v&&J()},[j,v]),l.useEffect(()=>{i&&(Y(),W())},[i]),l.useEffect(()=>{c&&ee()},[c,y]);const J=async()=>{try{const s=await u.getTurmas();X(s),s.length===1&&w(s[0].id)}catch(s){console.error("Erro ao carregar turmas:",s)}},W=async()=>{try{const a=(await u.getDisciplinas()).filter(t=>t.turma_id===i);G(a),a.length===1&&p(a[0].id)}catch(s){console.error("Erro ao carregar disciplinas:",s)}},Y=async()=>{try{const s=await u.getAlunos();H(s)}catch(s){console.error("Erro ao carregar alunos:",s)}},ee=()=>{const a=y.filter(t=>t.turma_id===i).map(t=>({alunoId:t.id,nota:"",comentario:""}));b(a)},se=()=>{m&&!isNaN(parseFloat(m))&&(b(s=>s.map(a=>({...a,nota:m}))),z(""))},ae=()=>{const s=o.filter(a=>a.nota&&!isNaN(parseFloat(a.nota)));return s.length===0?0:s.reduce((a,t)=>a+parseFloat(t.nota),0)/s.length},O=(s,a,t)=>{b(n=>n.map(F=>F.alunoId===s?{...F,[a]:t}:F))},te=()=>{const s={};return i||(s.turma="Selecione uma turma"),c||(s.disciplina="Selecione uma disciplina"),I||(s.tipo="Selecione o tipo de avaliação"),$.trim()||(s.descricao="Descrição da avaliação é obrigatória"),o.filter(t=>!!(t.nota&&(isNaN(parseFloat(t.nota))||parseFloat(t.nota)<0||parseFloat(t.nota)>10))).length>0&&(s.notas="Algumas notas são inválidas (devem estar entre 0 e 10)"),C(s),Object.keys(s).length===0},re=async()=>{if(te()){P(!0);try{const s=o.filter(a=>a.nota.trim()!=="");for(const a of s)await u.createNota({aluno_id:a.alunoId,disciplina_id:c,trimestre:parseInt(S),nota:parseFloat(a.nota),comentario:a.comentario?a.comentario:void 0});V(!0),setTimeout(()=>{K(),N(),k()},1500)}catch(s){console.error("Erro ao salvar notas:",s),C({submit:"Erro ao salvar notas"})}finally{P(!1)}}},k=()=>{w(""),p(""),M("1"),_(""),R(""),b([]),C({}),V(!1)};if(!j)return null;const T=h.find(s=>s.id===i),D=A.find(s=>s.id===c),E=y.filter(s=>s.turma_id===i);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(Z,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lançamento Rápido de Notas"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sistema otimizado para agilidade"})]})]}),e.jsx("button",{onClick:()=>{N(),k()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(oe,{className:"h-5 w-5 text-gray-500"})})]}),B&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Notas lançadas com sucesso!"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Turma *"}),e.jsxs("select",{value:i,onChange:s=>{w(s.target.value),p("")},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.turma?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),h.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]}),r.turma&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(d,{className:"h-3 w-3 mr-1"}),r.turma]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("select",{value:c,onChange:s=>p(s.target.value),disabled:!i,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${r.disciplina?"border-red-300":"border-gray-300"} ${i?"":"bg-gray-50 cursor-not-allowed"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),A.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]}),r.disciplina&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(d,{className:"h-3 w-3 mr-1"}),r.disciplina]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trimestre *"}),e.jsxs("select",{value:S,onChange:s=>M(s.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"1",children:"1º Trimestre"}),e.jsx("option",{value:"2",children:"2º Trimestre"}),e.jsx("option",{value:"3",children:"3º Trimestre"}),e.jsx("option",{value:"4",children:"4º Trimestre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Avaliação *"}),e.jsxs("select",{value:I,onChange:s=>_(s.target.value),className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${r.tipo?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"participacao",children:"Participação"}),e.jsx("option",{value:"recuperacao",children:"Recuperação"})]}),r.tipo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(d,{className:"h-3 w-3 mr-1"}),r.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição *"}),e.jsx("input",{type:"text",value:$,onChange:s=>R(s.target.value),className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${r.descricao?"border-red-300":"border-gray-300"}`,placeholder:"Ex: Prova de Frações"}),r.descricao&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(d,{className:"h-3 w-3 mr-1"}),r.descricao]})]})]}),i&&c&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:T==null?void 0:T.nome})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:D==null?void 0:D.nome})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[S,"º Trimestre"]})]})]})}),c&&E.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Lançar Notas (",E.length," alunos)"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"0",max:"10",step:"0.1",value:m,onChange:s=>z(s.target.value),placeholder:"Nota",className:"w-20 px-2 py-1 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{onClick:se,disabled:!m,className:"flex items-center space-x-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors disabled:opacity-50",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"Aplicar a Todos"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-gray-100 rounded-lg",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Média: ",ae().toFixed(1)]})]})]})]}),r.notas&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),r.notas]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:E.map(s=>{const a=o.find(n=>n.alunoId===s.id),t=parseFloat((a==null?void 0:a.nota)||"0");return e.jsxs("div",{className:`flex items-center space-x-4 p-4 border-2 rounded-lg transition-all ${t>0?me(t):"border-gray-200 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ${t>0?xe(t):"bg-blue-500"}`,children:s.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 text-lg",children:s.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:t>0?e.jsxs("span",{className:`font-medium ${ue(t)}`,children:["Nota atual: ",x(t)]}):"Aguardando nota"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nota (0-10)"}),e.jsx("input",{type:"number",min:"0",max:"10",step:"0.1",value:(a==null?void 0:a.nota)||"",onChange:n=>O(s.id,"nota",n.target.value),className:"w-24 px-3 py-2 border-2 border-gray-300 rounded-lg text-center text-lg font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0.0"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comentário (opcional)"}),e.jsx("input",{type:"text",value:(a==null?void 0:a.comentario)||"",onChange:n=>O(s.id,"comentario",n.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Observações..."})]})]})]},s.id)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.filter(s=>s.nota.trim()!=="").length}),e.jsx("div",{className:"text-sm text-blue-800",children:"Notas Lançadas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.filter(s=>parseFloat(s.nota)>=g).length}),e.jsxs("div",{className:"text-sm text-green-800",children:["Aprovados (≥",x(g),")"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.filter(s=>parseFloat(s.nota)>=f&&parseFloat(s.nota)<g).length}),e.jsxs("div",{className:"text-sm text-yellow-800",children:["Recuperação (",x(f),"-",x(g-.1),")"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:o.filter(s=>parseFloat(s.nota)>0&&parseFloat(s.nota)<f).length}),e.jsxs("div",{className:"text-sm text-red-800",children:["Reprovados (<",x(f),")"]})]})]})})]}),h.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma turma atribuída"}),e.jsx("p",{className:"text-gray-500",children:"Você ainda não possui turmas atribuídas. Entre em contato com o administrador."})]}),r.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),r.submit]})})]}),h.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{N(),k()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:re,disabled:L||B||!c||o.filter(s=>s.nota.trim()!=="").length===0,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:L?"Salvando...":`Salvar ${o.filter(s=>s.nota.trim()!=="").length} Notas`})]})]})]})})}export{je as L};
