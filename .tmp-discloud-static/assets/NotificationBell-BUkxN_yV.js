import{$ as F,r as a,j as t,a0 as R,w as h,X as T,M as q,C as P,F as U}from"./index-CCr23udO.js";function O({onNavigateToNotifications:b,className:L="",buttonSize:D="md"}){const{notifications:c,unreadCount:o,markAllAsRead:C,markAsRead:A}=F(),[n,i]=a.useState(!1),[g,B]=a.useState({top:0,left:0,width:340,direction:"down"}),[S,k]=a.useState(!1),E=a.useRef(o),f=a.useRef(o),u=a.useRef(null),d=a.useRef(null),[$,w]=a.useState(!1),v=a.useRef(null);a.useEffect(()=>{if(o>f.current){w(!0);const e=setTimeout(()=>w(!1),900);return f.current=o,()=>clearTimeout(e)}o<f.current&&(f.current=o,w(!1))},[o]);const x=n?E.current:o,m=a.useCallback(()=>{if(!u.current)return;const e=u.current.getBoundingClientRect(),s=Math.min(384,Math.max(300,e.width*14)),r=window.innerHeight,l=380,p=r-e.bottom<l+24&&e.top>l?"up":"down",z=p==="down"?e.bottom+8:e.top-l-16;let N=e.right-s;N<8&&(N=8),B({top:Math.max(8,z),left:N,width:s,direction:p})},[]);a.useLayoutEffect(()=>{n&&(m(),requestAnimationFrame(m))},[n,m]),a.useEffect(()=>{if(!n)return;const e=()=>m();return window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}},[n,m]),a.useEffect(()=>{if(!n)return;const e=r=>{!d.current||!u.current||d.current.contains(r.target)||u.current.contains(r.target)||i(!1)},s=r=>{r.key==="Escape"&&i(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",s)}},[n]),a.useEffect(()=>{n?(E.current=o,k(!0)):k(!1)},[n,o]);const M=()=>i(e=>!e);a.useEffect(()=>{n?(v.current=document.activeElement,setTimeout(()=>{var s;const e=(s=d.current)==null?void 0:s.querySelector("button");e==null||e.focus()},30)):v.current&&v.current.focus()},[n]),a.useEffect(()=>{if(!n)return;const e=s=>{if(s.key!=="Tab"||!d.current)return;const r=Array.from(d.current.querySelectorAll('button, [href], [tabindex]:not([tabindex="-1"])')).filter(p=>!p.hasAttribute("disabled"));if(r.length===0)return;const l=r[0],j=r[r.length-1];s.shiftKey?document.activeElement===l&&(s.preventDefault(),j.focus()):document.activeElement===j&&(s.preventDefault(),l.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[n]);const H=a.useMemo(()=>{const e={};return c.forEach(s=>{const r=new Date(s.timestamp).toLocaleDateString("pt-BR");e[r]=e[r]||[],e[r].push(s)}),Object.entries(e).sort((s,r)=>new Date(r[0].split("/").reverse().join("-")).getTime()-new Date(s[0].split("/").reverse().join("-")).getTime())},[c]),y=c.filter(e=>!e.read).length;return t.jsxs("div",{className:`relative inline-block ${L}`,children:[t.jsxs("button",{ref:u,"aria-haspopup":"dialog","aria-expanded":n,"aria-label":y>0?`Notificações: ${y} não lidas`:"Notificações",onClick:M,onKeyDown:e=>{e.key==="ArrowDown"&&!n&&(e.preventDefault(),i(!0))},className:`relative rounded-xl sm:rounded-2xl transition-all duration-300 bg-white/20 border border-white/30 backdrop-blur-sm hover:bg-white/30 hover:border-white/40 hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-white/50 focus:shadow-lg active:scale-95 ${D==="sm"?"p-1.5 sm:p-2":"p-2 sm:p-3"} group`,children:[t.jsx(h,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 drop-shadow-lg group-hover:text-purple-600 transition-all duration-300"}),t.jsxs("span",{className:"sr-only","aria-live":"polite",children:[x," notificações não lidas"]}),x>0&&t.jsx("span",{"aria-hidden":"true",className:`absolute -top-1 -right-1 min-w-[20px] h-5 sm:h-6 sm:min-w-[24px] px-1.5 flex items-center justify-center bg-gradient-to-br from-red-500 via-rose-500 to-pink-600 rounded-full text-white text-[10px] sm:text-xs font-black shadow-lg shadow-red-500/30 border border-red-400/50 transition-all duration-300 ${$?"scale-110 ring-2 ring-red-300 ring-offset-2 ring-offset-white animate-pulse":"scale-100"} hover:shadow-xl hover:shadow-red-500/40`,children:x>99?"99+":x})]}),n&&R.createPortal(t.jsx("div",{className:"fixed inset-0 z-[1400]","aria-hidden":"true"}),document.body),n&&R.createPortal(t.jsxs("div",{ref:d,role:"dialog","aria-label":"Notificações",className:`fixed z-[1500] glass-card rounded-2xl sm:rounded-3xl border-2 border-blue-200 shadow-2xl backdrop-blur-md flex flex-col ${S?"opacity-100 translate-y-0":"opacity-0 translate-y-1"} transition-all duration-150`,style:{top:g.top,left:g.left,width:g.width,maxHeight:"26rem"},children:[t.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-blue-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-2xl sm:rounded-t-3xl",children:[t.jsxs("h3",{className:"text-sm sm:text-base font-black text-gray-900 flex items-center gap-2",children:[t.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 sm:w-7 sm:h-7 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 shadow-md",children:t.jsx(h,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-white"})}),"Notificações"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[y>0&&t.jsx("button",{onClick:C,className:"text-[10px] sm:text-xs font-bold text-blue-600 hover:text-blue-800 px-2 py-1 rounded-full hover:bg-blue-100 transition",children:"Marcar todas"}),t.jsx("button",{onClick:()=>i(!1),"aria-label":"Fechar",className:"p-1.5 sm:p-2 rounded-full hover:bg-white hover:bg-opacity-50 transition",children:t.jsx(T,{className:"h-4 w-4 text-gray-600"})})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[c.length===0&&t.jsxs("div",{className:"p-8 text-center",children:[t.jsx("div",{className:"w-14 h-14 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:t.jsx(h,{className:"h-6 w-6 text-gray-400"})}),t.jsx("p",{className:"text-sm text-gray-500 font-medium",children:"Nenhuma notificação"})]}),c.length>0&&t.jsx("div",{className:"divide-y divide-gray-50",children:H.map(([e,s])=>t.jsxs("div",{className:"py-2 first:pt-0 last:pb-0",children:[t.jsx("div",{className:"px-4 pt-2 pb-1 text-[11px] uppercase tracking-wide font-bold text-blue-600/70",children:e}),s.map(r=>{const l=r.type==="recado"?q:r.type==="prova_tarefa"?P:r.type==="material"?U:h;return t.jsxs("button",{onClick:()=>A(r.id),className:`w-full text-left px-4 py-3 flex items-start gap-3 hover:bg-blue-50 transition group ${r.read?"":"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500"}`,children:[t.jsx("span",{className:`p-2 rounded-xl shadow-sm flex items-center justify-center bg-white group-hover:scale-110 transition ${r.type==="recado"?"text-purple-600":r.type==="prova_tarefa"?"text-blue-600":r.type==="material"?"text-green-600":"text-gray-500"}`,children:t.jsx(l,{className:"h-4 w-4"})}),t.jsxs("span",{className:"flex-1 min-w-0",children:[t.jsx("span",{className:`block text-xs sm:text-sm font-bold leading-snug ${r.read?"text-gray-700":"text-gray-900"} line-clamp-2`,children:r.title}),t.jsx("span",{className:"block text-[11px] sm:text-xs text-gray-500 font-medium line-clamp-2 mt-0.5",children:r.message}),t.jsx("span",{className:"block text-[10px] text-gray-400 mt-1 font-semibold",children:new Date(r.timestamp).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})]}),!r.read&&t.jsx("span",{className:"w-2 h-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 shadow animate-pulse mt-1"})]},r.id)})]},e))})]}),t.jsx("div",{className:"p-4 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-blue-50 rounded-b-2xl sm:rounded-b-3xl",children:t.jsx("button",{onClick:()=>{i(!1),b==null||b()},className:"w-full text-center text-[11px] sm:text-xs text-blue-600 hover:text-blue-800 font-bold py-2 rounded-xl hover:bg-blue-100 transition shadow-sm hover:shadow",children:"Ver todas as notificações"})})]}),document.body)]})}export{O as NotificationBell,O as default};
