import{u as W,d as re,r as x,j as e,C as L,X as je,I as Ne,F as ve,B as Y,K as V,a as ye,c as ie,L as we,N as Se,z as De,s as ke,k as _e,R as Te,f as Ce,O as Pe}from"./index-CCr23udO.js";import{I as $e}from"./ItemDetailModal-Dr1W76Xe.js";import{S as Ee}from"./save-BDGo1Gz5.js";import{G as te}from"./grid-3x3-BrVqK7_f.js";import{F as Ae}from"./filter-ClytLayh.js";import{S as ze}from"./square-pen-CFWfA0Dv.js";import{T as Fe}from"./trash-2-IEheby2Z.js";import"./gradeConfig-C64ZX5y1.js";function Ve({isOpen:d,onClose:O,provaTarefa:u,onSave:S}){const{user:H}=W(),{isSupabaseConnected:v}=W(),z=re(H,v),[U,G]=x.useState([]),[D,J]=x.useState([]),[i,g]=x.useState({disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),[c,A]=x.useState({}),[I,M]=x.useState(!1),[m,k]=x.useState(!1);x.useEffect(()=>{d&&H&&K()},[d,H]),x.useEffect(()=>{g(u?{disciplina_id:u.disciplina_id,titulo:u.titulo,tipo:u.tipo,data:u.data,descricao:u.descricao||""}:{disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),A({}),k(!1)},[u,d]);const K=async()=>{try{const[o,y]=await Promise.all([z.getTurmas(),z.getDisciplinas()]);G(o),J(y),y.length===1&&g(j=>({...j,disciplina_id:y[0].id}))}catch(o){console.error("Erro ao carregar dados:",o)}},B=()=>{const o={};if(i.disciplina_id||(o.disciplina_id="Disciplina √© obrigat√≥ria"),(!i.titulo.trim()||i.titulo.length<3)&&(o.titulo="T√≠tulo deve ter pelo menos 3 caracteres"),!i.data)o.data="Data √© obrigat√≥ria";else{const y=new Date(i.data),j=new Date;j.setHours(0,0,0,0),y<j&&(o.data="Data n√£o pode ser no passado")}return i.tipo||(o.tipo="Tipo √© obrigat√≥rio"),A(o),Object.keys(o).length===0},R=async o=>{if(o.preventDefault(),!!B()){M(!0);try{u?(await z.updateProvaTarefa(u.id,i),console.log("‚úÖ Prova/Tarefa atualizada")):(await z.createProvaTarefa(i),console.log("‚úÖ Prova/Tarefa criada")),k(!0),setTimeout(()=>{S(),O(),F()},1500)}catch(y){console.error("Erro ao salvar prova/tarefa:",y),A({submit:"Erro ao salvar prova/tarefa"})}finally{M(!1)}}},F=()=>{g({disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),A({}),k(!1)};if(!d)return null;const _=D.find(o=>o.id===i.disciplina_id),Q=U.find(o=>o.id===(_==null?void 0:_.turma_id));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(L,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:u?"Editar Prova/Tarefa":"Nova Prova/Tarefa"})]}),e.jsx("button",{onClick:()=>{O(),F()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(je,{className:"h-5 w-5 text-gray-500"})})]}),m&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:u?"Prova/Tarefa atualizada com sucesso!":"Prova/Tarefa criada com sucesso!"})]})}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tipo de Atividade *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>g({...i,tipo:"prova"}),className:`p-4 border rounded-lg text-center transition-colors ${i.tipo==="prova"?"border-red-500 bg-red-50 text-red-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(ve,{className:"h-5 w-5 text-red-600"})}),e.jsx("span",{className:"text-sm font-medium",children:"Prova"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Avalia√ß√£o formal"})]}),e.jsxs("button",{type:"button",onClick:()=>g({...i,tipo:"tarefa"}),className:`p-4 border rounded-lg text-center transition-colors ${i.tipo==="tarefa"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(Y,{className:"h-5 w-5 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium",children:"Tarefa"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Trabalho/Exerc√≠cio"})]})]}),c.tipo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),c.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:i.disciplina_id,onChange:o=>g({...i,disciplina_id:o.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.disciplina_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),D.map(o=>e.jsx("option",{value:o.id,children:o.nome},o.id))]})]}),c.disciplina_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),c.disciplina_id]})]}),i.disciplina_id&&_&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:_.cor||"#3B82F6"}}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:_.nome})]}),Q&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:Q.nome})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T√≠tulo *"}),e.jsx("input",{type:"text",value:i.titulo,onChange:o=>g({...i,titulo:o.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.titulo?"border-red-300":"border-gray-300"}`,placeholder:`Ex: ${i.tipo==="prova"?"Prova de Matem√°tica - Fra√ß√µes":"Exerc√≠cios sobre Sistema Solar"}`}),c.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),c.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Entrega/Aplica√ß√£o *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:i.data,onChange:o=>g({...i,data:o.target.value}),min:new Date().toISOString().split("T")[0],className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.data?"border-red-300":"border-gray-300"}`})]}),c.data&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),c.data]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Data m√≠nima: ",new Date().toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o/Instru√ß√µes"}),e.jsx("textarea",{value:i.descricao,onChange:o=>g({...i,descricao:o.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:`Descreva ${i.tipo==="prova"?"o conte√∫do da prova, materiais permitidos...":"as instru√ß√µes da tarefa, crit√©rios de avalia√ß√£o..."}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i.descricao.length,"/500 caracteres"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:i.tipo==="prova"?"üìù Dicas para Provas:":"üìö Dicas para Tarefas:"}),e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:i.tipo==="prova"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"‚Ä¢ Defina claramente o conte√∫do que ser√° cobrado"}),e.jsx("li",{children:"‚Ä¢ Informe materiais permitidos (calculadora, consulta, etc.)"}),e.jsx("li",{children:"‚Ä¢ Especifique dura√ß√£o e formato da prova"}),e.jsx("li",{children:"‚Ä¢ Comunique crit√©rios de avalia√ß√£o"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"‚Ä¢ Explique claramente o que deve ser entregue"}),e.jsx("li",{children:"‚Ä¢ Defina formato de entrega (f√≠sico, digital, etc.)"}),e.jsx("li",{children:"‚Ä¢ Especifique crit√©rios de avalia√ß√£o"}),e.jsx("li",{children:"‚Ä¢ Informe se √© individual ou em grupo"})]})})]}),D.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma disciplina atribu√≠da"}),e.jsx("p",{className:"text-gray-500",children:"Voc√™ ainda n√£o possui disciplinas atribu√≠das. Entre em contato com o administrador."})]}),c.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),c.submit]})})]}),D.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{O(),F()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:R,disabled:I||m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{children:I?"Salvando...":u?"Salvar Altera√ß√µes":"Criar Atividade"})]})]})]})})}function Qe(){var ee,se;const{user:d,isSupabaseConnected:O}=W(),u=re(d,O),[S,H]=x.useState([]),[v,z]=x.useState([]),[U,G]=x.useState([]),[D,J]=x.useState([]),[i,g]=x.useState("agenda"),[c,A]=x.useState({}),[I,M]=x.useState({}),[m,k]=x.useState({turma:"",disciplina:"",tipo:"",periodo:"proximas"}),[K,B]=x.useState(!1),[R,F]=x.useState(null),[_,Q]=x.useState(!0),[o,y]=x.useState(!1),[j,le]=x.useState(null);x.useEffect(()=>{d&&X()},[d]),x.useEffect(()=>{(d==null?void 0:d.tipo_usuario)==="pai"&&v.length>0&&oe()},[d,v]);const X=async()=>{try{const[s,t,a]=await Promise.all([u.getProvasTarefas(),u.getTurmas(),u.getDisciplinas()]);H(s),z(t),G(a),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&await me()}catch(s){console.error("Erro ao carregar agenda:",s)}finally{Q(!1)}},oe=async()=>{try{const s=[];for(const t of v){const a=await we(t.id);s.push(...a.map(r=>({...r,turma:t})))}J(s)}catch(s){console.error("Erro ao carregar hor√°rios:",s)}},de=S.filter(s=>{var h;const t=new Date().toISOString().split("T")[0],a=s.data;let r=!0;if(m.periodo==="proximas")r=a>=t;else if(m.periodo==="passadas")r=a<t;else if(m.periodo==="hoje")r=a===t;else if(m.periodo==="semana"){const p=new Date;p.setDate(p.getDate()+7),r=a>=t&&a<=p.toISOString().split("T")[0]}return r&&(!m.turma||((h=s.disciplina)==null?void 0:h.turma_id)===m.turma)&&(!m.disciplina||s.disciplina_id===m.disciplina)&&(!m.tipo||s.tipo===m.tipo)}),ne=s=>{const t={};return s.forEach(a=>{const r=a.data;t[r]||(t[r]=[]),t[r].push(a)}),t},ce=()=>["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"],xe=()=>D.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum hor√°rio encontrado"}),e.jsx("p",{className:"text-gray-500",children:"Os hor√°rios das aulas dos seus filhos aparecer√£o aqui quando forem configurados."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(s=>{const t=D.filter(r=>r.turma_id===s.id),a=new Set(t.map(r=>r.disciplina_id)).size;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:s.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:s.nome}),e.jsx("p",{className:"text-xs text-gray-500",children:s.ano_letivo})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Aulas/semana:"}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Disciplinas:"}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:a})]})]})]},s.id)})}),v.map(s=>{const t=D.filter(a=>a.turma_id===s.id);return t.length===0?null:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:s.nome}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:s.ano_letivo})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5,6,7].map(a=>{const r=t.filter(n=>n.dia_semana===a);if(r.length===0)return null;const h=["Segunda","Ter√ßa","Quarta","Quinta","Sexta","S√°bado","Domingo"],p=["üìö","üìñ","‚úèÔ∏è","üìù","üéØ","üåü","üé®"],f=["blue","green","purple","amber","red","indigo","pink"];return e.jsxs("div",{className:`bg-gradient-to-r from-${f[a-1]}-50 to-${f[a-1]}-100 rounded-2xl p-4 border-2 border-${f[a-1]}-200 shadow-lg`,children:[e.jsxs("h4",{className:`font-black text-${f[a-1]}-800 mb-4 text-center text-lg flex items-center justify-center space-x-2`,children:[e.jsx("span",{className:"text-2xl",children:p[a-1]}),e.jsx("span",{children:h[a-1]})]}),e.jsx("div",{className:"space-y-3",children:r.sort((n,l)=>n.hora_inicio.localeCompare(l.hora_inicio)).map(n=>{var l,w,T,C,P,$,E,b;return e.jsxs("div",{className:"p-4 rounded-xl text-sm shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105 bg-white border-l-4",style:{borderLeftColor:(l=n.disciplina)==null?void 0:l.cor,background:`linear-gradient(135deg, ${(w=n.disciplina)==null?void 0:w.cor}10, ${(T=n.disciplina)==null?void 0:T.cor}20)`},onClick:()=>{var N,q;alert(`üìö ${(N=n.disciplina)==null?void 0:N.nome}

üë®‚Äçüè´ Professor: ${((q=n.professor)==null?void 0:q.nome)||"N√£o atribu√≠do"}

üïê Hor√°rio: ${n.hora_inicio} - ${n.hora_fim}

üè´ Local: ${n.sala||"N√£o informada"}

üìù Observa√ß√µes: ${n.observacoes||"Sem observa√ß√µes especiais"}`)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:(C=n.disciplina)==null?void 0:C.cor}}),e.jsx("div",{className:"font-black text-gray-900 text-base",title:(P=n.disciplina)==null?void 0:P.nome,children:($=n.disciplina)==null?void 0:$.nome})]}),e.jsxs("div",{className:`px-3 py-1 bg-${f[a-1]}-100 text-${f[a-1]}-800 rounded-full text-xs font-bold`,children:[n.hora_inicio," - ",n.hora_fim]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-gray-700 text-sm font-semibold flex items-center space-x-1",title:(E=n.professor)==null?void 0:E.nome,children:[e.jsx("span",{children:"üë®‚Äçüè´"}),e.jsx("span",{children:((b=n.professor)==null?void 0:b.nome)||"Professor TBD"})]}),n.sala&&e.jsxs("div",{className:"text-gray-600 text-xs font-medium flex items-center space-x-1 bg-white px-2 py-1 rounded-full",title:`Sala: ${n.sala}`,children:[e.jsx("span",{children:"üìç"}),e.jsx("span",{children:n.sala})]})]})]},n.id)})})]},a)})})}),e.jsxs("div",{className:"hidden md:block overflow-x-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-8 gap-0 min-w-[700px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 p-3 border border-gray-300 font-black text-gray-800 text-center text-sm",children:"‚è∞ Hor√°rio"}),ce().map((a,r)=>{const h=["üìö","üìñ","‚úèÔ∏è","üìù","üéØ","üåü","üé®"],p=["blue","green","purple","amber","red","indigo","pink"];return e.jsx("div",{className:`bg-gradient-to-b from-${p[r]}-100 to-${p[r]}-200 p-3 border border-gray-300 font-black text-${p[r]}-800 text-center text-sm`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"text-lg",children:h[r]}),e.jsx("span",{children:a})]})},r)}),Array.from({length:8},(a,r)=>{const h=7+r,p=`${h.toString().padStart(2,"0")}:00`;return e.jsxs(Te.Fragment,{children:[e.jsx("div",{className:"p-3 border border-gray-300 text-center text-sm text-gray-700 bg-gradient-to-r from-gray-50 to-gray-100 font-bold",children:p}),[1,2,3,4,5,6,7].map(f=>{const n=t.filter(l=>{const w=parseInt(l.hora_inicio.split(":")[0]);return l.dia_semana===f&&w===h});return e.jsx("div",{className:"p-2 border border-gray-300 min-h-[70px] bg-white hover:bg-gray-50 transition-colors",children:n.map(l=>{var w,T,C,P,$,E,b,N;return e.jsxs("div",{className:"p-2 rounded-lg text-xs mb-1 shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:scale-105 border-l-4",style:{backgroundColor:((w=l.disciplina)==null?void 0:w.cor)+"25",borderLeftColor:(T=l.disciplina)==null?void 0:T.cor,background:`linear-gradient(135deg, ${(C=l.disciplina)==null?void 0:C.cor}20, ${(P=l.disciplina)==null?void 0:P.cor}35)`},onClick:()=>{var q,ae;alert(`üìö ${(q=l.disciplina)==null?void 0:q.nome}

üë®‚Äçüè´ Professor: ${((ae=l.professor)==null?void 0:ae.nome)||"N√£o atribu√≠do"}

üïê Hor√°rio: ${l.hora_inicio} - ${l.hora_fim}

üè´ Local: ${l.sala||"N√£o informada"}

üìù Observa√ß√µes: ${l.observacoes||"Sem observa√ß√µes especiais"}`)},children:[e.jsx("div",{className:"font-black text-gray-900 truncate text-sm mb-1",title:($=l.disciplina)==null?void 0:$.nome,children:(E=l.disciplina)==null?void 0:E.nome}),e.jsxs("div",{className:"text-gray-700 truncate text-xs font-semibold",title:(b=l.professor)==null?void 0:b.nome,children:["üë®‚Äçüè´ ",((N=l.professor)==null?void 0:N.nome)||"Professor TBD"]}),l.sala&&e.jsxs("div",{className:"text-gray-600 truncate text-xs font-medium",title:`Sala: ${l.sala}`,children:["üìç ",l.sala]}),e.jsxs("div",{className:"text-gray-500 text-xs font-bold mt-1",children:["üïê ",l.hora_inicio," - ",l.hora_fim]})]},l.id)})},f)})]},r)})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-black text-gray-900 mb-3 flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:"üé®"}),"Disciplinas da Turma:"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:[...new Set(t.map(a=>a.disciplina_id))].map(a=>{var h;const r=(h=t.find(p=>p.disciplina_id===a))==null?void 0:h.disciplina;return r?e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:r.cor}}),e.jsx("span",{className:"text-sm font-semibold text-gray-800 truncate",children:r.nome})]},a):null})})]})]})]})]},s.id)})]}),me=async()=>{try{const s={};for(const t of S){const a=await Se("prova_tarefa",t.id);s[t.id]={stats:a}}A(s)}catch(s){console.error("Erro ao buscar visualiza√ß√µes:",s)}},ue=async s=>{if(!I[s])try{const t=await Pe("prova_tarefa",s);A(a=>({...a,[s]:{...a[s],detalhes:t}}))}catch(t){console.error("Erro ao buscar detalhes de visualiza√ß√£o:",t)}M(t=>({...t,[s]:!t[s]}))},he=async s=>{if(d.tipo_usuario==="pai")try{await Ce("prova_tarefa",s.id)}catch(t){console.error("Erro ao registrar visualiza√ß√£o:",t)}le(s),y(!0)},pe=s=>{F(s),B(!0)},be=async s=>{if(confirm(`Tem certeza que deseja excluir "${s.titulo}"?`))try{await u.deleteProvaTarefa(s.id),X()}catch(t){console.error("Erro ao excluir prova/tarefa:",t),alert("Erro ao excluir prova/tarefa")}},ge=()=>{B(!1),F(null)},fe=()=>{X()},Z=ne(de);return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(L,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:d.tipo_usuario==="pai"?"üìÖ Agenda dos Filhos":d.tipo_usuario==="professor"?"Minhas Provas & Tarefas":"Agenda Escolar"}),d.tipo_usuario==="pai"&&e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"Acompanhe todas as atividades escolares"})]})]}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&e.jsxs("button",{onClick:()=>B(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{children:"Nova Prova/Tarefa"})]})]}),d.tipo_usuario==="pai"&&e.jsx("div",{className:"bg-gradient-to-r from-white to-blue-50 rounded-2xl shadow-lg border-2 border-blue-200",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-2 sm:space-x-8 px-4 sm:px-6",children:[e.jsx("button",{onClick:()=>g("agenda"),className:`py-4 px-3 sm:px-1 border-b-4 font-bold text-sm sm:text-base transition-all duration-300 ${i==="agenda"?"border-blue-500 text-blue-600 bg-blue-50 rounded-t-lg":"border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300 hover:bg-blue-50 rounded-t-lg"}`,children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${i==="agenda"?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(L,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("span",{className:"hidden sm:inline",children:"Provas & Tarefas"}),e.jsx("span",{className:"sm:hidden",children:"Agenda"})]})}),e.jsx("button",{onClick:()=>g("cronograma"),className:`py-4 px-3 sm:px-1 border-b-4 font-bold text-sm sm:text-base transition-all duration-300 ${i==="cronograma"?"border-purple-500 text-purple-600 bg-purple-50 rounded-t-lg":"border-transparent text-gray-500 hover:text-purple-600 hover:border-purple-300 hover:bg-purple-50 rounded-t-lg"}`,children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${i==="cronograma"?"bg-purple-100":"bg-gray-100"}`,children:e.jsx(te,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("span",{className:"hidden sm:inline",children:"Cronograma de Aulas"}),e.jsx("span",{className:"sm:hidden",children:"Hor√°rios"})]})})]})})}),d.tipo_usuario==="pai"&&i==="cronograma"?xe():e.jsxs(e.Fragment,{children:[(d.tipo_usuario!=="pai"||i==="agenda")&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-lg border-2 border-blue-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-blue-600 uppercase tracking-wide",children:"Hoje"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-blue-700",children:S.filter(s=>s.data===new Date().toISOString().split("T")[0]).length}),e.jsx("p",{className:"text-xs text-blue-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(ie,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-yellow-50 rounded-2xl shadow-lg border-2 border-yellow-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-yellow-600 uppercase tracking-wide",children:"Esta Semana"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-yellow-700",children:(()=>{const s=new Date().toISOString().split("T")[0],t=new Date;return t.setDate(t.getDate()+7),S.filter(a=>{const r=a.data;return r>=s&&r<=t.toISOString().split("T")[0]}).length})()}),e.jsx("p",{className:"text-xs text-yellow-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-xl",children:e.jsx(L,{className:"h-6 w-6 sm:h-8 sm:w-8 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-red-50 rounded-2xl shadow-lg border-2 border-red-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-red-600 uppercase tracking-wide",children:"Provas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-red-700",children:S.filter(s=>s.tipo==="prova").length}),e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"avalia√ß√µes"})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-xl",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-red-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs sm:text-sm",children:"P"})})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-lg border-2 border-green-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-green-600 uppercase tracking-wide",children:"Trabalhos"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-green-700",children:S.filter(s=>["tarefa","trabalho","projeto"].includes(s.tipo)).length}),e.jsx("p",{className:"text-xs text-green-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-green-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs sm:text-sm",children:"T"})})})]})})]}),(d.tipo_usuario!=="pai"||i==="agenda")&&e.jsxs("div",{className:"bg-gradient-to-r from-white to-gray-50 rounded-2xl shadow-lg border-2 border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ae,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"})}),e.jsx("h3",{className:"font-black text-gray-900 text-base sm:text-lg",children:"üîç Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"üìÖ Per√≠odo"}),e.jsxs("select",{value:m.periodo,onChange:s=>k({...m,periodo:s.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"proximas",children:"Pr√≥ximas"}),e.jsx("option",{value:"hoje",children:"Hoje"}),e.jsx("option",{value:"semana",children:"Esta semana"}),e.jsx("option",{value:"passadas",children:"Passadas"}),e.jsx("option",{value:"todas",children:"Todas"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"üè´ Turma"}),e.jsxs("select",{value:m.turma,onChange:s=>k({...m,turma:s.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todas as turmas"}),v.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"üìö Disciplina"}),e.jsxs("select",{value:m.disciplina,onChange:s=>k({...m,disciplina:s.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todas as disciplinas"}),U.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"üìù Tipo"}),e.jsxs("select",{value:m.tipo,onChange:s=>k({...m,tipo:s.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"tarefa",children:"Tarefa"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"projeto",children:"Projeto"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(Z).length===0?e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg border-2 border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"p-6 bg-gray-100 rounded-full w-fit mx-auto mb-6",children:e.jsx(L,{className:"h-16 w-16 text-gray-400"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"üìÖ Nenhuma atividade encontrada"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Ajuste os filtros ou aguarde novas atividades."})]}):Object.entries(Z).map(([s,t])=>e.jsxs("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-black",children:["üìÖ ",new Date(s+"T00:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"})]}),e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:new Date(s+"T00:00:00").getFullYear()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm rounded-xl",children:[e.jsx("div",{className:"text-2xl font-black",children:t.length}),e.jsx("div",{className:"text-xs font-bold",children:t.length===1?"atividade":"atividades"})]})})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"space-y-4 sm:space-y-6",children:t.map(a=>{var w,T,C,P,$,E;const r=new Date().toISOString().split("T")[0],h=a.data,p=h<r,f=h===r,n=new Date(h).getTime()-new Date(r).getTime(),l=Math.ceil(n/(1e3*60*60*24));return e.jsxs("div",{className:`p-4 sm:p-6 rounded-2xl transition-all cursor-pointer hover:shadow-2xl hover:scale-105 group border-2 ${p?"border-red-300 bg-gradient-to-br from-red-50 to-red-100":f?"border-yellow-300 bg-gradient-to-br from-yellow-50 to-yellow-100 animate-pulse":l<=3?"border-orange-300 bg-gradient-to-br from-orange-50 to-orange-100":"border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100"}`,onClick:()=>he(a),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:`px-3 py-2 text-sm font-black rounded-xl shadow-md ${a.tipo==="prova"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:a.tipo==="prova"?"üìù PROVA":"üìö TAREFA"}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:((w=a.disciplina)==null?void 0:w.cor)||"#3B82F6"}}),e.jsx("span",{className:"text-sm font-bold text-gray-800",children:(T=a.disciplina)==null?void 0:T.nome})]})]}),e.jsx("h3",{className:"text-xl sm:text-2xl font-black text-gray-900 group-hover:text-blue-700 transition-colors mb-2 leading-tight",children:a.titulo}),a.descricao&&e.jsx("p",{className:"text-sm sm:text-base text-gray-700 mb-3 font-medium leading-relaxed",children:a.descricao}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("span",{children:"üè´"}),e.jsx("span",{className:"font-bold text-gray-700",children:(C=v.find(b=>{var N;return b.id===((N=a.disciplina)==null?void 0:N.turma_id)}))==null?void 0:C.nome})]}),e.jsxs("div",{className:"flex items-center space-x-1 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("span",{children:"üìÖ"}),e.jsx("span",{className:"font-bold text-gray-700",children:new Date(h).toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit"})})]})]}),e.jsx("p",{className:"text-sm font-bold text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity bg-blue-100 px-3 py-2 rounded-xl",children:"üëÜ Toque para ver detalhes completos e dicas de prepara√ß√£o"})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-3",children:[e.jsx("div",{className:`px-4 py-3 rounded-2xl font-black text-sm shadow-lg ${p?"bg-red-500 text-white":f?"bg-yellow-500 text-white animate-bounce":l<=3?"bg-orange-500 text-white":"bg-green-500 text-white"}`,children:p?"‚ùå VENCIDA":f?"üîî HOJE!":l<=3?`‚ö†Ô∏è ${l} DIAS`:`‚úÖ ${l} DIAS`}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),ue(a.id)},className:"p-2 text-gray-400 hover:text-green-600 transition-colors",title:"Ver quem visualizou",children:(($=(P=c[a.id])==null?void 0:P.stats)==null?void 0:$.usuariosUnicos)>0?e.jsx(ke,{className:"h-4 w-4 text-green-600"}):e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),pe(a)},className:"p-2 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),be(a)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Fe,{className:"h-4 w-4"})})]})]})]}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&c[a.id]&&e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsx("span",{className:"font-bold",children:"üìä Visualiza√ß√µes:"}),e.jsxs("span",{className:"font-black text-green-600",children:[c[a.id].stats.usuariosUnicos," usu√°rios √∫nicos"]})]}),c[a.id].stats.ultimaVisualizacao&&e.jsxs("div",{className:"text-xs text-gray-500",children:["√öltima: ",new Date(c[a.id].stats.ultimaVisualizacao).toLocaleString("pt-BR")]})]}),I[a.id]&&((E=c[a.id])==null?void 0:E.detalhes)&&e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-gray-200",children:[e.jsx("h5",{className:"text-sm font-black text-gray-900 mb-3",children:"üìà Hist√≥rico de Visualiza√ß√µes:"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[c[a.id].detalhes.slice(0,5).map(b=>{var N;return e.jsxs("div",{className:"flex items-center justify-between text-xs bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("span",{className:"font-bold text-gray-700",children:(N=b.usuario)==null?void 0:N.nome}),e.jsx("span",{className:"font-medium text-gray-600",children:new Date(b.visualizado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},b.id)}),c[a.id].detalhes.length>5&&e.jsxs("div",{className:"text-xs font-bold text-blue-600 text-center pt-2 bg-blue-50 rounded-lg p-2",children:["+",c[a.id].detalhes.length-5," mais..."]})]})]})]},a.id)})})})]},s))})]}),e.jsx(Ve,{isOpen:K,onClose:ge,provaTarefa:R,onSave:fe}),e.jsx($e,{isOpen:o,onClose:()=>y(!1),item:j,type:"prova_tarefa",turmaName:j?(ee=v.find(s=>{var t;return s.id===((t=j.disciplina)==null?void 0:t.turma_id)}))==null?void 0:ee.nome:"",disciplinaName:(se=j==null?void 0:j.disciplina)==null?void 0:se.nome})]})}export{Qe as AgendaPage};
