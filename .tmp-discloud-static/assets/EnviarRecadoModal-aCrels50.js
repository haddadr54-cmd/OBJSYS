import{u as F,d as M,r as o,j as e,M as _,X as U,I as q,a as d,U as w,K as n,Q as z}from"./index-CCr23udO.js";function I({isOpen:c,onClose:u,onSave:S}){var v,y;const{user:l,isSupabaseConnected:E}=F(),m=M(l,E),[i,k]=o.useState([]),[x,h]=o.useState([]),[t,r]=o.useState({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),[p,j]=o.useState(!1),[f,N]=o.useState(!1),[s,b]=o.useState({});o.useEffect(()=>{c&&l&&C()},[c,l]),o.useEffect(()=>{t.destinatario_tipo==="aluno"&&t.destinatario_id?A():t.destinatario_tipo!=="aluno"&&(h([]),r(a=>({...a,aluno_id:""})))},[t.destinatario_tipo,t.destinatario_id]);const C=async()=>{try{const a=await m.getTurmas();k(a)}catch(a){console.error("Erro ao carregar turmas:",a)}},A=async()=>{try{const R=(await m.getAlunos()).filter($=>$.turma_id===t.destinatario_id);h(R)}catch(a){console.error("Erro ao carregar alunos:",a)}},D=()=>{const a={};return t.titulo.trim()||(a.titulo="Título é obrigatório"),t.conteudo.trim()||(a.conteudo="Mensagem é obrigatória"),t.destinatario_tipo!=="geral"&&!t.destinatario_id&&(a.destinatario="Selecione o destinatário"),t.destinatario_tipo==="aluno"&&!t.aluno_id&&(a.destinatario="Selecione o aluno"),b(a),Object.keys(a).length===0},T=async()=>{if(D()){j(!0);try{await m.createRecado({titulo:t.titulo,conteudo:t.conteudo,destinatario_tipo:t.destinatario_tipo,destinatario_id:t.destinatario_tipo==="geral"?void 0:t.destinatario_tipo==="aluno"?t.aluno_id:t.destinatario_id,enviado_por:l.id}),N(!0),setTimeout(()=>{S(),u(),g()},1500)}catch(a){console.error("Erro ao enviar recado:",a),b({submit:"Erro ao enviar recado"})}finally{j(!1)}}},g=()=>{r({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),b({}),N(!1)};return c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(_,{className:"h-5 w-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Enviar Recado"})]}),e.jsx("button",{onClick:()=>{u(),g()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(U,{className:"h-5 w-5 text-gray-500"})})]}),f&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Recado enviado com sucesso!"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Destinatário *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>r({...t,destinatario_tipo:"geral",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="geral"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(d,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Geral"})]}),e.jsxs("button",{type:"button",onClick:()=>r({...t,destinatario_tipo:"turma",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="turma"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(d,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Turma"})]}),e.jsxs("button",{type:"button",onClick:()=>r({...t,destinatario_tipo:"aluno",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${t.destinatario_tipo==="aluno"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(w,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Aluno"})]})]})]}),t.destinatario_tipo==="turma"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:t.destinatario_id,onChange:a=>r({...t,destinatario_id:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),i.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),s.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),s.destinatario]})]}),t.destinatario_tipo==="aluno"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:t.destinatario_id,onChange:a=>r({...t,destinatario_id:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione uma turma primeiro"}),i.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),t.destinatario_id&&x.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Aluno *"}),e.jsxs("select",{value:t.aluno_id,onChange:a=>r({...t,aluno_id:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione um aluno"}),x.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),s.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),s.destinatario]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assunto *"}),e.jsx("input",{type:"text",value:t.titulo,onChange:a=>r({...t,titulo:a.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s.titulo?"border-red-300":"border-gray-300"}`,placeholder:"Digite o assunto do recado"}),s.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),s.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem *"}),e.jsx("textarea",{value:t.conteudo,onChange:a=>r({...t,conteudo:a.target.value}),rows:6,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${s.conteudo?"border-red-300":"border-gray-300"}`,placeholder:"Digite a mensagem do recado..."}),s.conteudo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),s.conteudo]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t.conteudo.length,"/500 caracteres"]})]}),t.destinatario_tipo!=="geral"&&t.destinatario_id&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Destinatário:"}),e.jsx("div",{className:"flex items-center space-x-2",children:t.destinatario_tipo==="turma"?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Turma: ",(v=i.find(a=>a.id===t.destinatario_id))==null?void 0:v.nome]})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Aluno: ",(y=x.find(a=>a.id===t.aluno_id))==null?void 0:y.nome]})]})})]}),t.destinatario_tipo==="geral"&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(d,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Recado será enviado para todos os pais e responsáveis"})]})}),i.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma turma atribuída"}),e.jsx("p",{className:"text-gray-500",children:"Você ainda não possui turmas atribuídas. Entre em contato com o administrador."})]}),s.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(n,{className:"h-4 w-4 mr-2"}),s.submit]})})]}),i.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{u(),g()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:T,disabled:p||f,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:p?"Enviando...":"Enviar Recado"})]})]})]})}):null}export{I as E};
