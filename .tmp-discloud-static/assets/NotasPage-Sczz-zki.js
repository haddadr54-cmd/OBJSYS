import{r as i,x as Be,y as Oe,u as Ve,d as Ue,j as e,B as I,z as qe,a as ze,T as pe,E as Ge,I as Xe,X as Je,M as ue,C as he,J as ge}from"./index-CCr23udO.js";import{u as Qe}from"./useRealtimeRecados-C7jbUtA1.js";import{formatarNota as H,getMediaTextColorClasses as We,getMediaGradientClasses as fe,getNotaTextColor as M,getSituacaoAcademica as He}from"./gradeConfig-C64ZX5y1.js";import{I as be}from"./ItemDetailModal-Dr1W76Xe.js";import{L as Ke}from"./LancarNotasModal-Cr1cCl9s.js";import{D as Ye}from"./download-B2qXGiUz.js";import{T as je}from"./trash-2-IEheby2Z.js";import{F as Ze}from"./filter-ClytLayh.js";import{X as es}from"./x-circle-CouFZ83r.js";import{S as ss}from"./square-pen-CFWfA0Dv.js";import"./save-BDGo1Gz5.js";function ts(d={}){const{enabled:g=!0,initialFetch:f=!0}=d,[w,b]=i.useState([]),[P,$]=i.useState(!!f),[E,z]=i.useState(null),C=i.useRef(new Map),S=i.useRef(!1),k=i.useRef([]),T=i.useCallback(o=>{C.current.clear(),o.forEach(p=>C.current.set(p.id,p)),b(Array.from(C.current.values()).sort((p,y)=>y.criado_em.localeCompare(p.criado_em)))},[]),L=i.useCallback(()=>{var p,y;if(k.current.length===0)return;const o=C.current;for(const x of k.current)if(x.action==="INSERT"&&x.newRecord)o.set(x.newRecord.id,x.newRecord);else if(x.action==="UPDATE"&&x.newRecord)o.set(x.newRecord.id,x.newRecord);else if(x.action==="DELETE"){const j=((p=x.oldRecord)==null?void 0:p.id)||((y=x.newRecord)==null?void 0:y.id);j&&o.delete(j)}k.current=[],b(Array.from(o.values()).sort((x,j)=>j.criado_em.localeCompare(x.criado_em)))},[]),n=i.useCallback(async()=>{try{$(!0);const{data:o,error:p}=await Be.from("notas").select("*, aluno:alunos(*), disciplina:disciplinas(*)").order("criado_em",{ascending:!1});if(p)throw p;T(o||[]),S.current=!0,L()}catch(o){z(o.message||"Erro ao carregar notas")}finally{$(!1)}},[T,L]);return Oe("notas",o=>{var y,x;if(!g)return;if(!S.current){k.current.push(o);return}const p=C.current;if(o.action==="INSERT"&&o.newRecord)p.set(o.newRecord.id,o.newRecord);else if(o.action==="UPDATE"&&o.newRecord)p.set(o.newRecord.id,o.newRecord);else if(o.action==="DELETE"){const j=((y=o.oldRecord)==null?void 0:y.id)||((x=o.newRecord)==null?void 0:x.id);j&&p.delete(j)}b(Array.from(p.values()).sort((j,D)=>D.criado_em.localeCompare(j.criado_em)))}),i.useEffect(()=>{g&&f&&n()},[g,f,n]),{notas:w,loading:P,error:E,refetch:n}}function gs(){var le,ie,oe,ne,ce,de,me,xe;const{user:d,isSupabaseConnected:g}=Ve(),f=Ue(d,g),[w,b]=i.useState([]),[P,$]=i.useState([]),[E,z]=i.useState([]),[C]=i.useState([]),[S,k]=i.useState([]),[T,L]=i.useState([]),[n,o]=i.useState(null),[p,y]=i.useState(!1),[x,j]=i.useState(!1),[D,Ne]=i.useState(null),[G,ye]=i.useState("prova_tarefa"),[ve,X]=i.useState(!1),[B,we]=i.useState(!1),[Se,ke]=i.useState(""),[_e,Ce]=i.useState(""),[De,K]=i.useState(!1),[_,Y]=i.useState(null),[u,O]=i.useState({aluno:"",disciplina:"",bimestre:"",tipo:""}),[Re,Ee]=i.useState(!0),[J,Z]=i.useState(!1),[V,ee]=i.useState(null),[N,A]=i.useState({}),se=((d==null?void 0:d.tipo_usuario)||"").toLowerCase(),U=d&&(se==="admin"||se==="professor"),{notas:Q,loading:Te}=ts({enabled:!!g&&!!d,initialFetch:!0}),{recados:te}=Qe({enabled:!!g&&!!d,initialFetch:!0}),h=g;i.useEffect(()=>{d&&!h&&F()},[d,h]),i.useEffect(()=>{h&&k(te)},[h,te]);const F=async()=>{try{const[s,t,a,r,c]=await Promise.all([f.getNotas(),f.getAlunos(),f.getDisciplinas(),f.getRecados(),f.getProvasTarefas()]),m=s.sort((l,v)=>{const Le=l.criado_em;return v.criado_em.localeCompare(Le)});b(m),$(t),z(a),k(r),L(c)}catch(s){console.error("Erro ao carregar notas:",s)}finally{Ee(!1)}},q=s=>{if(g)return s;{const t=ge.getDisciplinas(),a=ge.getAlunos(),r=t.find(m=>m.id===s.disciplina_id),c=a.find(m=>m.id===s.aluno_id);return{...s,disciplina:r,aluno:c}}},R=(s,t)=>f.calcularMediaAluno(s,w,t),Ae=s=>{o(s),y(!0)},ae=(s,t)=>{Ne(s),ye(t),j(!0)},Fe=s=>{Y(s),K(!0)},Ie=s=>{console.log("[NotasPage] startEditNota clicado",{notaId:s.id,nota:s}),ee(s.id),A({nota:(s.nota??s.valor??"").toString(),comentario:s.comentario??s.descricao??"",trimestre:(s.trimestre??s.bimestre??"").toString()}),setTimeout(()=>{console.log("[NotasPage] Estado ap√≥s startEditNota",{editingNotaId:s.id,editValues:N})},0)},re=()=>{ee(null),A({})},Me=async s=>{if(!U)return;console.log("[NotasPage] Salvando nota",{notaId:s.id,editValues:N});const t=N.nota?parseFloat(N.nota):void 0;if(t!==void 0&&(isNaN(t)||t<0||t>10)){alert("Nota inv√°lida. Informe um n√∫mero entre 0 e 10.");return}const a=N.trimestre?parseInt(N.trimestre):void 0;if(a!==void 0&&(a<1||a>4)){alert("Trimestre inv√°lido (1 a 4).");return}const r=h;let c=null;if(r){c=[...h?Q:w];const m=l=>l.id===s.id?{...l,nota:t!==void 0?t:l.nota,comentario:N.comentario!==void 0?N.comentario:l.comentario,trimestre:a!==void 0?a:l.trimestre}:l;b(h?l=>l.map(m):l=>l.map(m))}try{const m=await f.updateNota(s.id,{nota:t,comentario:N.comentario,trimestre:a});if(console.log("[NotasPage] Resultado updateNota",m),!m){c&&b(c),alert("Falha ao atualizar nota (permiss√£o ou erro).");return}r||await F(),re()}catch(m){console.error("Erro ao salvar edi√ß√£o da nota:",m),c&&b(c),alert("Erro ao salvar. Veja o console.")}},Pe=async()=>{if(!U||S.length===0||!confirm(`Tem certeza que deseja excluir TODOS os ${S.length} recados? Esta a√ß√£o n√£o pode ser desfeita.`))return;Z(!0);const s=S.map(a=>a.id),t=[...S];k([]);try{const a=await f.bulkDeleteRecados(s);a.failedIds.length>0&&(alert(`Alguns recados n√£o puderam ser exclu√≠dos: ${a.failedIds.length}`),h?F():k(t.filter(r=>!a.successIds.includes(r.id))))}catch(a){console.error("Erro ao excluir todos recados:",a),alert("Erro ao excluir recados."),k(t)}finally{Z(!1)}},$e=async s=>{if(!U||!confirm("Tem certeza que deseja excluir esta nota?"))return;const t=h;let a=null;t&&(a=[...h?Q:w],b(r=>r.filter(c=>c.id!==s.id)));try{if(!await f.deleteNota(s.id)){a&&b(a),alert("N√£o foi poss√≠vel excluir a nota (permiss√£o ou erro).");return}t||await F()}catch(r){console.error("Erro ao excluir nota:",r),a&&b(a),alert("Erro ao excluir. Veja o console.")}},W=(h?Q:w).filter(s=>{var t;return(!u.aluno||s.aluno_id===u.aluno)&&(!u.disciplina||s.disciplina_id===u.disciplina)&&(!u.bimestre||((t=s.trimestre||s.bimestre)==null?void 0:t.toString())===u.bimestre)&&(!u.tipo||!0)});return Re&&!h||h&&Te?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(I,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:d.tipo_usuario==="pai"?"üìä Boletim dos Filhos":d.tipo_usuario==="professor"?"üìù Notas Lan√ßadas":"üéØ Gest√£o de Notas"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:d.tipo_usuario==="pai"?"Acompanhe o desempenho acad√™mico":"Sistema de lan√ßamento de notas"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&S.length>0&&e.jsxs("button",{onClick:Pe,disabled:J,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${J?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{children:J?"Excluindo...":"Excluir Todas Notifica√ß√µes"})]}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&e.jsxs("button",{onClick:()=>X(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Lan√ßar Notas"})]})]})]}),(d.tipo_usuario==="professor"||d.tipo_usuario==="admin")&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2 text-blue-600"}),"Lan√ßamento R√°pido de Notas"]}),e.jsx("button",{onClick:()=>we(!B),className:`px-4 py-2 rounded-lg transition-colors ${B?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:B?"Cancelar":"Ativar Modo R√°pido"})]}),B&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("select",{value:Se,onChange:s=>ke(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:e.jsx("option",{value:"",children:"Selecione uma turma"})}),e.jsx("select",{value:_e,onChange:s=>Ce(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:e.jsx("option",{value:"",children:"Selecione uma disciplina"})})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["üí° ",e.jsx("strong",{children:"Modo R√°pido:"})," Selecione turma e disciplina para lan√ßar notas de forma √°gil"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ze,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Aluno"}),e.jsxs("select",{value:u.aluno,onChange:s=>O({...u,aluno:s.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os alunos"}),P.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Disciplina"}),e.jsxs("select",{value:u.disciplina,onChange:s=>O({...u,disciplina:s.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as disciplinas"}),E.map(s=>e.jsx("option",{value:s.id,children:s.nome},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Trimestre"}),e.jsxs("select",{value:u.bimestre,onChange:s=>O({...u,bimestre:s.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os trimestres"}),e.jsx("option",{value:"1",children:"1¬∫ Trimestre"}),e.jsx("option",{value:"2",children:"2¬∫ Trimestre"}),e.jsx("option",{value:"3",children:"3¬∫ Trimestre"}),e.jsx("option",{value:"4",children:"4¬∫ Trimestre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:u.tipo,onChange:s=>O({...u,tipo:s.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),!g&&e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"participacao",children:"Participa√ß√£o"}),e.jsx("option",{value:"recuperacao",children:"Recupera√ß√£o"})]})]})]})]}),d.tipo_usuario==="pai"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg mr-3",children:e.jsx(ze,{className:"h-6 w-6 text-white"})}),"üåü Boletim dos Filhos"]}),P.map(s=>{var t,a;return e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-2xl shadow-xl border-2 border-blue-200 mb-6",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b-2 border-blue-200 bg-gradient-to-r from-blue-100 via-purple-100 to-indigo-100 cursor-pointer hover:from-blue-200 hover:to-indigo-200 transition-all group rounded-t-2xl",onClick:()=>Ae(s),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-blue-500 via-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl sm:text-2xl shadow-2xl",children:s.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-black text-gray-900 group-hover:text-blue-700 transition-colors",children:s.nome}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-700 font-bold",children:["üè´ ",(t=s.turma)==null?void 0:t.nome," ‚Ä¢ üìÖ ",(a=s.turma)==null?void 0:a.ano_letivo]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mt-2 space-y-1 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(I,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-xs sm:text-sm text-blue-600 font-bold",children:["üìù ",w.filter(r=>r.aluno_id===s.id).length," notas"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(pe,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:`text-xs sm:text-sm font-black ${We(R(s.id))}`,children:["üìä M√©dia: ",H(R(s.id))]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`inline-flex items-center px-4 sm:px-6 py-2 sm:py-3 rounded-2xl text-lg sm:text-xl font-black shadow-xl ${fe(R(s.id))}`,children:H(R(s.id))}),e.jsx("p",{className:"text-xs text-blue-700 mt-2 opacity-0 group-hover:opacity-100 transition-opacity hidden sm:block font-black bg-white px-3 py-1 rounded-xl",children:"‚ú® Clique para ver detalhes completos"})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 bg-gradient-to-br from-gray-50 to-blue-50 rounded-b-2xl",children:[e.jsxs("h4",{className:"text-lg sm:text-xl font-black text-gray-900 mb-4 sm:mb-6 flex items-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg mr-3",children:e.jsx(I,{className:"h-5 w-5 text-white"})}),"üìö Notas por Disciplina"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:E.map(r=>{const c=w.filter(l=>l.aluno_id===s.id&&l.disciplina_id===r.id);if(c.length===0)return null;const m=c.reduce((l,v)=>l+(v.nota||0),0)/c.length;return e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-4 sm:p-5 hover:border-blue-400 hover:shadow-xl transition-all duration-300 hover:scale-105 bg-gradient-to-br from-white to-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center text-white font-black text-base sm:text-lg shadow-lg",style:{backgroundColor:r.cor||"#3B82F6"},children:r.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-black text-gray-900 text-sm sm:text-base",children:r.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 font-bold",children:["üìù ",c.length," nota(s)"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`px-3 sm:px-4 py-2 rounded-2xl text-sm sm:text-base font-black shadow-lg ${fe(m)}`,children:m.toFixed(1)})})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:c.sort((l,v)=>(v.trimestre||0)-(l.trimestre||0)).map(l=>e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gradient-to-r from-white to-gray-50 rounded-xl border border-gray-200 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-3 space-y-1 sm:space-y-0",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-black text-gray-800",children:["üìÖ ",l.trimestre,"¬∫ Trimestre"]}),e.jsx("span",{className:"text-xs text-gray-600 font-semibold",children:new Date(l.criado_em).toLocaleDateString("pt-BR")})]}),l.comentario&&e.jsxs("p",{className:"text-xs sm:text-sm text-gray-700 mt-1 italic line-clamp-2 font-medium",children:['üí¨ "',l.comentario,'"']})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-shrink-0 ml-2",children:[e.jsx("span",{className:`text-lg sm:text-xl font-black ${M(l.nota||0)}`,children:(l.nota||0).toFixed(1)}),e.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 rounded-full shadow-sm ${He(l.nota||0).bgColor}`})]})]},l.id))})]},r.id)})})]})]},s.id)})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:e.jsxs("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:["Notas Detalhadas (",W.length,") ",h&&e.jsx("span",{className:"text-xs text-blue-500 ml-2",children:"Realtime"})]})}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aluno"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disciplina"}),!g&&e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Tipo"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nota"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Trimestre"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Coment√°rio"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A√ß√µes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:g?6:7,className:"px-3 sm:px-6 py-6 sm:py-8 text-center text-gray-500 text-sm",children:"Nenhuma nota encontrada com os filtros aplicados"})}):W.map(s=>{var t,a,r,c,m;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs sm:text-sm font-semibold mr-2 sm:mr-3 flex-shrink-0",children:(a=(t=q(s).aluno)==null?void 0:t.nome)==null?void 0:a.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 truncate",children:((r=q(s).aluno)==null?void 0:r.nome)||"Aluno n√£o encontrado"})]})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full mr-1 sm:mr-2 flex-shrink-0",style:{backgroundColor:((c=q(s).disciplina)==null?void 0:c.cor)||"#3B82F6"}}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-900 truncate",children:((m=q(s).disciplina)==null?void 0:m.nome)||"Disciplina n√£o encontrada"})]})}),!g&&e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap hidden sm:table-cell",children:e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full ${s.tipo==="prova"?"bg-red-100 text-red-800":s.tipo==="trabalho"?"bg-blue-100 text-blue-800":s.tipo==="participacao"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.tipo})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:V===s.id?e.jsx("input",{value:N.nota||"",onChange:l=>A(v=>({...v,nota:l.target.value})),className:"w-16 border rounded px-1 py-0.5 text-sm focus:ring-2 focus:ring-blue-500",type:"number",step:"0.1",min:0,max:10}):e.jsx("span",{className:`text-base sm:text-lg font-bold ${M(s.nota||s.valor||0)}`,children:(s.nota||s.valor||0).toFixed(1)})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900 hidden sm:table-cell",children:V===s.id?e.jsx("input",{value:N.trimestre||"",onChange:l=>A(v=>({...v,trimestre:l.target.value})),className:"w-14 border rounded px-1 py-0.5 text-sm focus:ring-2 focus:ring-blue-500",type:"number",min:1,max:4}):e.jsxs(e.Fragment,{children:[s.trimestre||s.bimestre,"¬∫"]})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden lg:table-cell",children:V===s.id?e.jsx("input",{value:N.comentario||"",onChange:l=>A(v=>({...v,comentario:l.target.value})),className:"w-full border rounded px-2 py-1 text-xs focus:ring-2 focus:ring-blue-500",placeholder:"Coment√°rio"}):s.comentario||"-"}),e.jsxs("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm font-medium flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>Fe(s),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Ver detalhes da nota",children:e.jsx(Ge,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),U&&(V===s.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Me(s),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-50",title:"Salvar",children:e.jsx(Xe,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx("button",{onClick:re,className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50",title:"Cancelar",children:e.jsx(es,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>Ie(s),className:"text-indigo-600 hover:text-indigo-900 p-1 rounded hover:bg-indigo-50",title:"Editar nota",children:e.jsx(ss,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx("button",{type:"button",onClick:()=>$e(s),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Excluir nota",children:e.jsx(je,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]}))]})]},s.id)})})]})})]}),p&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm sm:max-w-2xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg sm:text-xl",children:n.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:n.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[(le=n.turma)==null?void 0:le.nome," ‚Ä¢ ",(ie=n.turma)==null?void 0:ie.ano_letivo]})]})]}),e.jsx("button",{onClick:()=>y(!1),className:"p-1.5 sm:p-2 hover:bg-white hover:bg-opacity-50 rounded-full transition-colors",children:e.jsx(Je,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Desempenho Acad√™mico"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-blue-600",children:"M√©dia Geral"}),e.jsx("p",{className:`text-xl sm:text-2xl font-bold ${M(R(n.id))}`,children:H(R(n.id))})]}),e.jsx(pe,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-green-600",children:"Total Notas"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-green-900",children:w.filter(s=>s.aluno_id===n.id).length})]}),e.jsx(I,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-purple-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-purple-600",children:"Recados"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-purple-900",children:S.filter(s=>s.destinatario_tipo==="geral"||s.destinatario_tipo==="turma"&&s.destinatario_id===n.turma_id||s.destinatario_tipo==="aluno"&&s.destinatario_id===n.id).length})]}),e.jsx(ue,{className:"h-6 w-6 sm:h-8 sm:w-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-yellow-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-yellow-600",children:"Pr√≥ximas Provas"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-yellow-900",children:T.filter(s=>{var a;const t=new Date().toISOString().split("T")[0];return((a=s.disciplina)==null?void 0:a.turma_id)===n.turma_id&&s.data>=t}).length})]}),e.jsx(he,{className:"h-6 w-6 sm:h-8 sm:w-8 text-yellow-600"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Notas por Disciplina"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:E.map(s=>{const t=w.filter(r=>r.aluno_id===n.id&&r.disciplina_id===s.id);if(t.length===0)return null;const a=t.reduce((r,c)=>r+(c.nota||0),0)/t.length;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full flex-shrink-0",style:{backgroundColor:s.cor||"#3B82F6"}}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base",children:s.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:[t.length," nota(s)"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("span",{className:`text-base sm:text-lg font-bold ${M(a)}`,children:a.toFixed(1)})})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:t.map(r=>e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"text-gray-600 truncate flex-1 mr-2",children:[r.trimestre,"¬∫ Trimestre",r.comentario&&` ‚Ä¢ ${r.comentario}`]}),e.jsx("span",{className:`font-medium flex-shrink-0 ${M(r.nota||0)}`,children:(r.nota||0).toFixed(1)})]},r.id))})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Pr√≥ximas Avalia√ß√µes"}),(()=>{const s=T.filter(t=>{var r;const a=new Date().toISOString().split("T")[0];return((r=t.disciplina)==null?void 0:r.turma_id)===n.turma_id&&t.data>=a}).sort((t,a)=>t.data.localeCompare(a.data));return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-3 sm:py-4 text-sm",children:"Nenhuma avalia√ß√£o pr√≥xima"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:s.slice(0,5).map(t=>{var a;return e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 p-2 sm:p-3 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all cursor-pointer",onClick:()=>ae(t,"prova_tarefa"),children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-yellow-50 rounded-full flex-shrink-0",children:e.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:t.titulo}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:(a=t.disciplina)==null?void 0:a.nome})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-900",children:new Date(t.data).toLocaleDateString("pt-BR")}),e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full ${t.tipo==="prova"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:t.tipo})]})]},t.id)})})})()]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Recados Recentes"}),(()=>{const s=S.filter(t=>t.destinatario_tipo==="geral"||t.destinatario_tipo==="turma"&&t.destinatario_id===n.turma_id||t.destinatario_tipo==="aluno"&&t.destinatario_id===n.id).slice(0,5);return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-3 sm:py-4 text-sm",children:"Nenhum recado recente"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:s.map(t=>{var a;return e.jsxs("div",{className:"flex items-start space-x-3 sm:space-x-4 p-2 sm:p-3 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-purple-50 transition-all cursor-pointer",onClick:()=>ae(t,"recado"),children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-purple-50 rounded-full flex-shrink-0",children:e.jsx(ue,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:t.titulo}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 line-clamp-2",children:t.conteudo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Por: ",(a=t.autor)==null?void 0:a.nome," ‚Ä¢ ",new Date(t.data_envio).toLocaleDateString("pt-BR")]})]}),e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full flex-shrink-0 ${t.destinatario_tipo==="geral"?"bg-blue-100 text-blue-800":t.destinatario_tipo==="turma"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:t.destinatario_tipo})]},t.id)})})})()]})]}),e.jsx("div",{className:"flex justify-end p-4 sm:p-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>y(!1),className:"px-4 sm:px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Fechar"})})]})}),e.jsx(be,{isOpen:x,onClose:()=>j(!1),item:D,type:G,turmaName:(oe=n==null?void 0:n.turma)==null?void 0:oe.nome,disciplinaName:G==="prova_tarefa"&&D?(ne=D.disciplina)==null?void 0:ne.nome:void 0,autorName:G==="recado"&&D?(ce=D.autor)==null?void 0:ce.nome:void 0}),e.jsx(Ke,{isOpen:ve,onClose:()=>X(!1),onSave:()=>{X(!1),F()}}),e.jsx(be,{isOpen:De,onClose:()=>{K(!1),Y(null)},item:_,type:"nota",turmaName:_?(de=C.find(s=>{var t;return s.id===((t=_.aluno)==null?void 0:t.turma_id)}))==null?void 0:de.nome:"",disciplinaName:(me=_==null?void 0:_.disciplina)==null?void 0:me.nome,autorName:(xe=_==null?void 0:_.aluno)==null?void 0:xe.nome})]})}export{gs as NotasPage};
