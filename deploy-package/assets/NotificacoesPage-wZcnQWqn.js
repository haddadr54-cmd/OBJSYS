import{g as ge,u as be,R as Ne,j as e,X as Re,F as ue,B as pe,M as ve,C as he,c as Pe,ac as Le,a as je,U as Ce,ai as gs,a8 as Ns,q as Oe,aj as Me,r as t,ak as Je,al as We,am as vs,d as Te,h as le,A as te,a5 as ys,o as He,T as Ze,i as qe,an as cs,O as ws,ao as Ke,y as bs,ap as es,f as ss,n as ks,b as Ss,P as xs,k as _s,L as Be,E as Xe,G as Ds,S as ms,a3 as Cs}from"./index-DZv84JbG.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=ge("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=ge("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=ge("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=ge("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ge("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=ge("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=ge("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=ge("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ge("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=ge("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ge("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ge("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=ge("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ge("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=ge("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function ze({isOpen:r,onClose:C,item:o,type:k,turmaName:_,disciplinaName:A,autorName:$}){const{user:J}=be(),[F,u]=Ne.useState(null);if(Ne.useEffect(()=>{const c=localStorage.getItem("helpConfig");if(c)try{const R=JSON.parse(c);u(R)}catch(R){console.error("Erro ao carregar configurações de ajuda:",R)}else u({showHelpSections:!0,helpSteps:["Leia o recado com atenção","Anote informações importantes","Entre em contato se tiver dúvidas","Acompanhe as próximas comunicações"],contactInfo:{secretaria:{nome:"Secretaria",telefone:"(11) 1234-5678"},coordenacao:{nome:"Coordenação",email:"coord@escola.com"},horario:{funcionamento:"7h às 17h"}},customSections:[]})},[]),!r||!o)return null;const L=()=>{switch(k){case"prova_tarefa":return e.jsx(he,{className:"h-6 w-6 text-blue-600"});case"recado":return e.jsx(ve,{className:"h-6 w-6 text-purple-600"});case"material":switch(o.tipo){case"pdf":return e.jsx(ue,{className:"h-6 w-6 text-red-600"});case"video":return e.jsx($e,{className:"h-6 w-6 text-purple-600"});case"link":return e.jsx(Ee,{className:"h-6 w-6 text-blue-600"});default:return e.jsx(ue,{className:"h-6 w-6 text-gray-600"})}case"nota":return e.jsx(pe,{className:"h-6 w-6 text-green-600"});default:return e.jsx(ue,{className:"h-6 w-6 text-gray-600"})}},s=()=>{var c,R;switch(k){case"prova_tarefa":const z=o;return`${z.tipo==="prova"?"Prova":"Tarefa"}: ${z.titulo}`;case"recado":return`Recado: ${o.titulo}`;case"material":return`Material: ${o.titulo}`;case"nota":const D=o;return`Nota: ${((c=D.disciplina)==null?void 0:c.nome)||"Disciplina"} - ${((R=D.aluno)==null?void 0:R.nome)||$}`;default:const j=o;return"titulo"in j?j.titulo:"Item"}},v=()=>{switch(k){case"prova_tarefa":return o.tipo==="prova"?"bg-red-50 border-red-200":"bg-blue-50 border-blue-200";case"recado":return"bg-purple-50 border-purple-200";case"material":switch(o.tipo){case"pdf":return"bg-red-50 border-red-200";case"video":return"bg-purple-50 border-purple-200";case"link":return"bg-blue-50 border-blue-200";default:return"bg-gray-50 border-gray-200"}case"nota":const h=o.nota||0;return h>=7?"bg-green-50 border-green-200":h>=5?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},d=()=>{if(k==="prova_tarefa"){const c=o,R=new Date().toISOString().split("T")[0];return c.data<R}return!1},y=()=>{if(k==="prova_tarefa"){const c=o,R=new Date().toISOString().split("T")[0];return c.data===R}return!1},m=()=>{if(k==="prova_tarefa"){const c=o,R=new Date,h=new Date(c.data).getTime()-R.getTime();return Math.ceil(h/(1e3*60*60*24))}return 0},g=()=>{const c=o,R=m();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-center space-x-4 p-4 bg-gray-50 rounded-lg",children:d()?e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx(Ue,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Vencida"})]}):y()?e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-600",children:[e.jsx(Pe,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Hoje"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(Le,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:R===1?"Amanhã":`${R} dias restantes`})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Tipo"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${c.tipo==="prova"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:c.tipo==="prova"?"Prova":"Tarefa"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Data"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:new Date(c.data).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Disciplina"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:A})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Turma"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:_})]})]})]})]}),c.descricao&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Descrição/Instruções"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:c.descricao})})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:c.tipo==="prova"?"📚 Dicas para a Prova:":"📝 Dicas para a Tarefa:"}),e.jsx("ul",{className:"text-sm text-blue-700 space-y-1",children:c.tipo==="prova"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Revise todo o conteúdo estudado"}),e.jsx("li",{children:"• Organize seus materiais de estudo"}),e.jsx("li",{children:"• Descanse bem na véspera"}),e.jsx("li",{children:"• Chegue com antecedência"}),e.jsx("li",{children:"• Leia todas as questões com atenção"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Leia as instruções com atenção"}),e.jsx("li",{children:"• Organize seu tempo para fazer a tarefa"}),e.jsx("li",{children:"• Pesquise fontes confiáveis se necessário"}),e.jsx("li",{children:"• Revise antes de entregar"}),e.jsx("li",{children:"• Entregue dentro do prazo"})]})})]})]})},p=()=>{var R,z,h,X,D,j,V,G;const c=o;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"p-6 bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("div",{className:"p-4 bg-purple-100 rounded-full",children:e.jsx(ve,{className:"h-10 w-10 text-purple-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-2xl font-bold text-purple-800",children:"📢 Recado Importante"}),e.jsx("p",{className:"text-purple-600",children:"Comunicação da escola para você"})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"text-lg font-bold text-gray-900 border-b border-gray-200 pb-2",children:"Informações do Remetente"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Enviado por"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:$==null?void 0:$.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:$}),e.jsx("p",{className:"text-sm text-gray-500",children:"Professor/Administrador"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Data de Envio"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(he,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:new Date(c.data_envio).toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["às ",new Date(c.data_envio).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"text-lg font-bold text-gray-900 border-b border-gray-200 pb-2",children:"Destinatário"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Enviado para"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${c.destinatario_tipo==="geral"?"bg-blue-100":c.destinatario_tipo==="turma"?"bg-green-100":"bg-purple-100"}`,children:c.destinatario_tipo==="geral"?e.jsx(je,{className:"h-5 w-5 text-blue-600"}):c.destinatario_tipo==="turma"?e.jsx(je,{className:"h-5 w-5 text-green-600"}):e.jsx(Ce,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c.destinatario_tipo==="geral"?"🌍 Todos os pais":c.destinatario_tipo==="turma"?`👥 Turma: ${_}`:"👤 Aluno específico"}),e.jsx("p",{className:"text-sm text-gray-500",children:c.destinatario_tipo==="geral"?"Comunicação geral":c.destinatario_tipo==="turma"?"Comunicação da turma":"Comunicação individual"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Prioridade"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Ue,{className:"h-5 w-5 text-yellow-600"})}),e.jsx("span",{className:"px-4 py-2 bg-yellow-100 text-yellow-800 text-lg font-bold rounded-xl",children:"📌 Normal"})]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h5",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-purple-600"}),"Mensagem Completa"]}),e.jsx("div",{className:"p-6 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border-2 border-gray-200",children:e.jsx("div",{className:"prose prose-lg max-w-none",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-lg font-medium",children:c.conteudo})})})]}),(J==null?void 0:J.tipo_usuario)==="pai"&&e.jsxs(e.Fragment,{children:[(F==null?void 0:F.showHelpSections)&&F.helpSteps&&e.jsxs("div",{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl",children:[e.jsx("h4",{className:"text-lg font-bold text-green-800 mb-4 flex items-center",children:"✅ O que fazer agora?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:F.helpSteps.map((T,B)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-bold",children:B+1})}),e.jsx("p",{className:"text-sm text-green-700 font-medium",children:T})]},B))})]}),(F==null?void 0:F.showHelpSections)&&F.contactInfo&&e.jsxs("div",{className:"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl",children:[e.jsx("h4",{className:"text-lg font-bold text-blue-800 mb-4 flex items-center",children:"📞 Precisa de Ajuda?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(ve,{className:"h-6 w-6 text-blue-600"})}),e.jsx("p",{className:"text-sm font-medium text-blue-800",children:((R=F.contactInfo.secretaria)==null?void 0:R.nome)||"Secretaria"}),e.jsx("p",{className:"text-xs text-blue-600",children:((z=F.contactInfo.secretaria)==null?void 0:z.telefone)||"(11) 1234-5678"}),((h=F.contactInfo.secretaria)==null?void 0:h.email)&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:F.contactInfo.secretaria.email})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(Ce,{className:"h-6 w-6 text-green-600"})}),e.jsx("p",{className:"text-sm font-medium text-green-800",children:((X=F.contactInfo.coordenacao)==null?void 0:X.nome)||"Coordenação"}),e.jsx("p",{className:"text-xs text-green-600",children:((D=F.contactInfo.coordenacao)==null?void 0:D.email)||"coord@escola.com"}),((j=F.contactInfo.coordenacao)==null?void 0:j.telefone)&&e.jsx("p",{className:"text-xs text-green-600 mt-1",children:F.contactInfo.coordenacao.telefone})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(Pe,{className:"h-6 w-6 text-purple-600"})}),e.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Horário"}),e.jsx("p",{className:"text-xs text-purple-600",children:((V=F.contactInfo.horario)==null?void 0:V.funcionamento)||"7h às 17h"}),((G=F.contactInfo.horario)==null?void 0:G.atendimento)&&e.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["Atendimento: ",F.contactInfo.horario.atendimento]})]})]})]}),(F==null?void 0:F.showHelpSections)&&F.customSections&&F.customSections.length>0&&e.jsx(e.Fragment,{children:F.customSections.map(T=>{const B={blue:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200",green:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200",purple:"bg-gradient-to-br from-purple-50 to-violet-50 border-2 border-purple-200",yellow:"bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-200",red:"bg-gradient-to-br from-red-50 to-rose-50 border-2 border-red-200",gray:"bg-gradient-to-br from-gray-50 to-slate-50 border-2 border-gray-200"},ee={blue:"text-blue-800",green:"text-green-800",purple:"text-purple-800",yellow:"text-yellow-800",red:"text-red-800",gray:"text-gray-800"};return e.jsxs("div",{className:`p-6 rounded-xl ${B[T.color]||B.gray}`,children:[e.jsxs("h4",{className:`text-lg font-bold mb-4 flex items-center ${ee[T.color]||ee.gray}`,children:[e.jsx("span",{className:"text-xl mr-2",children:T.icon}),T.title]}),e.jsx("p",{className:`text-sm opacity-90 ${ee[T.color]||ee.gray}`,children:T.content})]},T.id)})})]})]})},N=()=>{const c=o;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Tipo de Material"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c.tipo==="pdf"&&e.jsx(ue,{className:"h-4 w-4 text-red-600"}),c.tipo==="video"&&e.jsx($e,{className:"h-4 w-4 text-purple-600"}),c.tipo==="link"&&e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${c.tipo==="pdf"?"bg-red-100 text-red-800":c.tipo==="video"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:c.tipo==="pdf"?"PDF":c.tipo==="video"?"Vídeo":"Link"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Disciplina"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:A})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Turma"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:_})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Adicionado em"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:new Date(c.criado_em).toLocaleDateString("pt-BR")})]})]})]})]}),c.descricao&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Descrição"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap leading-relaxed",children:c.descricao})})]}),c.arquivo_url&&e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>window.open(c.arquivo_url,"_blank"),className:`w-full flex items-center justify-center space-x-3 p-4 rounded-lg text-white font-medium transition-colors ${c.tipo==="pdf"?"bg-red-600 hover:bg-red-700":c.tipo==="video"?"bg-purple-600 hover:bg-purple-700":"bg-blue-600 hover:bg-blue-700"}`,children:[c.tipo==="pdf"&&e.jsx(ue,{className:"h-5 w-5"}),c.tipo==="video"&&e.jsx($e,{className:"h-5 w-5"}),c.tipo==="link"&&e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{children:c.tipo==="pdf"?"Abrir PDF":c.tipo==="video"?"Assistir Vídeo":"Acessar Link"})]})}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:c.tipo==="pdf"?"📄 Como usar este PDF:":c.tipo==="video"?"🎥 Como assistir este vídeo:":"🔗 Como usar este link:"}),e.jsx("ul",{className:"text-sm text-green-700 space-y-1",children:c.tipo==="pdf"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Baixe o arquivo para seu dispositivo"}),e.jsx("li",{children:"• Use um leitor de PDF para visualizar"}),e.jsx("li",{children:"• Faça anotações importantes"}),e.jsx("li",{children:"• Imprima se necessário para estudar"})]}):c.tipo==="video"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Assista em um ambiente tranquilo"}),e.jsx("li",{children:"• Faça pausas para anotar pontos importantes"}),e.jsx("li",{children:"• Assista quantas vezes precisar"}),e.jsx("li",{children:"• Ative legendas se disponível"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Explore o conteúdo do site educativo"}),e.jsx("li",{children:"• Faça anotações dos pontos principais"}),e.jsx("li",{children:"• Teste atividades interativas se houver"}),e.jsx("li",{children:"• Compartilhe dúvidas com o professor"})]})})]})]})},w=()=>{var X;const c=o,R=c.nota||0,h=R>=7?{status:"Aprovado",color:"green",icon:"✅"}:R>=5?{status:"Recuperação",color:"yellow",icon:"⚠️"}:{status:"Reprovado",color:"red",icon:"❌"};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:`flex items-center justify-center space-x-4 p-4 rounded-lg ${h.color==="green"?"bg-green-50 border border-green-200":h.color==="yellow"?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:`flex items-center space-x-2 ${h.color==="green"?"text-green-600":h.color==="yellow"?"text-yellow-600":"text-red-600"}`,children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsx("span",{className:"font-bold text-lg",children:h.status})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Aluno"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:((X=c.aluno)==null?void 0:X.nome)||$})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Disciplina"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:A})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Trimestre"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[c.trimestre,"º Trimestre"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Data de Lançamento"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-900 font-medium",children:new Date(c.criado_em).toLocaleDateString("pt-BR")})]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:`text-center p-6 rounded-xl ${h.color==="green"?"bg-green-100 border-2 border-green-300":h.color==="yellow"?"bg-yellow-100 border-2 border-yellow-300":"bg-red-100 border-2 border-red-300"}`,children:[e.jsx("h4",{className:`text-sm font-medium mb-2 ${h.color==="green"?"text-green-700":h.color==="yellow"?"text-yellow-700":"text-red-700"}`,children:"Nota Final"}),e.jsx("div",{className:`text-6xl font-bold ${h.color==="green"?"text-green-600":h.color==="yellow"?"text-yellow-600":"text-red-600"}`,children:R.toFixed(1)}),e.jsx("p",{className:`text-sm mt-2 ${h.color==="green"?"text-green-600":h.color==="yellow"?"text-yellow-600":"text-red-600"}`,children:"de 10,0 pontos"})]})}),c.comentario&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Comentário do Professor"}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-blue-800 italic",children:['"',c.comentario,'"']})})]}),e.jsxs("div",{className:`p-4 rounded-lg border ${h.color==="green"?"bg-green-50 border-green-200":h.color==="yellow"?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[e.jsx("h4",{className:`font-medium mb-2 ${h.color==="green"?"text-green-800":h.color==="yellow"?"text-yellow-800":"text-red-800"}`,children:h.color==="green"?"🎉 Parabéns pelo desempenho!":h.color==="yellow"?"📚 Dicas para melhorar:":"🚨 Atenção - Ações necessárias:"}),e.jsx("ul",{className:`text-sm space-y-1 ${h.color==="green"?"text-green-700":h.color==="yellow"?"text-yellow-700":"text-red-700"}`,children:h.color==="green"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Continue com o excelente trabalho!"}),e.jsx("li",{children:"• Mantenha a rotina de estudos"}),e.jsx("li",{children:"• Ajude colegas com dificuldades"}),e.jsx("li",{children:"• Explore conteúdos complementares"})]}):h.color==="yellow"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Revise os conteúdos com mais atenção"}),e.jsx("li",{children:"• Participe mais das aulas"}),e.jsx("li",{children:"• Tire dúvidas com o professor"}),e.jsx("li",{children:"• Organize melhor o tempo de estudos"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Procure ajuda do professor imediatamente"}),e.jsx("li",{children:"• Participe das aulas de recuperação"}),e.jsx("li",{children:"• Dedique mais tempo aos estudos"}),e.jsx("li",{children:"• Considere aulas de reforço"})]})})]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm sm:max-w-2xl lg:max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:`p-4 sm:p-6 border-b ${v()}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-white rounded-full shadow-sm",children:L()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 line-clamp-2",children:s()}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:[k==="prova_tarefa"&&`Data: ${new Date(o.data).toLocaleDateString("pt-BR")}`,k==="recado"&&`Enviado em: ${new Date(o.data_envio).toLocaleDateString("pt-BR")}`,k==="material"&&`Adicionado em: ${new Date(o.criado_em).toLocaleDateString("pt-BR")}`]})]})]}),e.jsx("button",{onClick:C,className:"p-1.5 sm:p-2 hover:bg-white hover:bg-opacity-50 rounded-full transition-colors flex-shrink-0",children:e.jsx(Re,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-4 sm:p-6",children:[k==="prova_tarefa"&&g(),k==="recado"&&p(),k==="material"&&N(),k==="nota"&&w()]}),e.jsx("div",{className:"flex justify-end p-4 sm:p-6 border-t border-gray-200",children:e.jsx("button",{onClick:C,className:"px-4 sm:px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Fechar"})})]})})}function Os({onMenuToggle:r,title:C,showSearch:o=!1,onSearch:k}){const[_,A]=Ne.useState(!1),[$,J]=Ne.useState(""),{notifications:F,unreadCount:u,markAllAsRead:L,markAsRead:s}=gs(),v=()=>{console.log("🔔 [Header] Sino clicado!",{showNotifications:_,unreadCount:u,timestamp:new Date().toISOString()}),A(!_)};return e.jsxs("header",{className:"mobile-header header-modern relative border-b-2 border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between h-full",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:r,className:"lg:hidden p-2 sm:p-3 rounded-xl sm:rounded-2xl hover:bg-blue-50 hover:scale-110 transition-all duration-300 flex-shrink-0 micro-bounce mobile-button",children:e.jsx(Ns,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"})}),e.jsxs("div",{className:"flex items-center space-x-3 lg:hidden flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl sm:rounded-2xl flex items-center justify-center flex-shrink-0 shadow-modern-colored animate-float",children:e.jsx("span",{className:"text-white font-black text-lg sm:text-xl",children:"O"})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-base sm:text-lg font-black text-gray-900 truncate leading-tight text-shadow-modern",children:"Colégio"}),e.jsx("span",{className:"text-xs sm:text-sm text-blue-600 font-bold truncate -mt-1",children:"Objetivo"})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center space-x-4 flex-1",children:[e.jsx("h1",{className:"text-xl lg:text-2xl xl:text-3xl font-black text-gray-900 truncate text-gradient-objetivo",children:C}),o&&e.jsxs("div",{className:"relative max-w-xs lg:max-w-md",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar...",value:$,onChange:d=>{J(d.target.value),k==null||k(d.target.value)},className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm w-full"})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:v,className:"relative p-2 sm:p-3 rounded-xl sm:rounded-2xl hover:bg-blue-50 hover:scale-110 transition-all duration-300 flex-shrink-0 micro-bounce mobile-button",children:[e.jsx(Me,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"}),u>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 sm:w-6 sm:h-6 bg-gradient-to-r from-red-500 to-rose-600 rounded-full flex items-center justify-center text-white text-xs font-black animate-bounce shadow-modern",children:u})]}),_&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 sm:mt-4 w-72 sm:w-80 lg:w-96 glass-card rounded-2xl sm:rounded-3xl z-[999] max-h-80 sm:max-h-96 overflow-y-auto animate-slide-in-up shadow-2xl border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-blue-100 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-2xl sm:rounded-t-3xl",children:[e.jsxs("h3",{className:"text-base sm:text-lg font-black text-gray-900 flex items-center",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg sm:rounded-xl flex items-center justify-center mr-2 sm:mr-3 shadow-lg",children:e.jsx(Me,{className:"h-4 w-4 text-white"})}),"Notificações"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[u>0&&e.jsxs("button",{onClick:L,className:"text-xs text-blue-600 hover:text-blue-800 font-bold whitespace-nowrap px-2 sm:px-3 py-1 rounded-full hover:bg-blue-100 transition-all duration-300",children:[e.jsx("span",{className:"hidden sm:inline",children:"Marcar todas como lidas"}),e.jsx("span",{className:"sm:hidden",children:"Marcar todas"})]}),e.jsx("button",{onClick:()=>A(!1),className:"p-1.5 sm:p-2 hover:bg-white hover:bg-opacity-50 rounded-full transition-all duration-300 hover:scale-110 mobile-button",style:{zIndex:1001},children:e.jsx(Re,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-600"})})]})]}),e.jsx("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto",children:F.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{className:"h-6 w-6 sm:h-8 sm:w-8 text-gray-400"})}),e.jsx("p",{className:"text-sm sm:text-base text-gray-500 font-medium",children:"Nenhuma notificação"})]}):e.jsx("div",{className:"divide-y divide-gray-50",children:F.map(d=>{const y=d.type==="recado"?ve:d.type==="prova_tarefa"?he:d.type==="material"?ue:Me;return e.jsx("div",{className:`p-3 sm:p-5 hover:bg-blue-50 transition-all duration-300 cursor-pointer hover:scale-[1.02] ${d.read?"":"bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500"}`,onClick:()=>s(d.id),children:e.jsxs("div",{className:"flex items-start space-x-3 sm:space-x-4",children:[e.jsx("div",{className:`p-2 sm:p-3 rounded-xl sm:rounded-2xl shadow-lg ${d.type==="recado"?"bg-purple-100":d.type==="prova_tarefa"?"bg-blue-100":"bg-green-100"} flex-shrink-0`,children:e.jsx(y,{className:`h-4 w-4 ${d.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:`text-sm sm:text-base font-bold ${d.read?"text-gray-700":"text-gray-900"} line-clamp-2 sm:truncate pr-2`,children:d.title}),!d.read&&e.jsx("div",{className:"w-2 h-2 sm:w-3 sm:h-3 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex-shrink-0 animate-pulse shadow-lg"})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-1 sm:mt-2 line-clamp-2 font-medium",children:d.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 sm:mt-2 font-semibold",children:new Date(d.timestamp).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]})]})},d.id)})})}),e.jsx("div",{className:"p-4 sm:p-6 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-blue-50 rounded-b-2xl sm:rounded-b-3xl",children:e.jsx("button",{onClick:()=>{A(!1),window.dispatchEvent(new CustomEvent("navigate",{detail:"notificacoes"}))},className:"w-full text-center text-xs sm:text-sm text-blue-600 hover:text-blue-800 font-bold py-2 sm:py-3 hover:bg-blue-100 rounded-xl sm:rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl mobile-button",children:"Ver todas as notificações"})})]})]})})]}),_&&e.jsx("div",{className:"mobile-sidebar-overlay",onClick:()=>A(!1),style:{zIndex:998}})]})}function $s(r={}){const{enabled:C=!0,initialFetch:o=!0}=r,[k,_]=t.useState([]),[A,$]=t.useState(!!o),[J,F]=t.useState(null),u=t.useRef(new Map),L=t.useRef(!1),s=t.useRef([]),v=t.useCallback(m=>{u.current.clear(),m.forEach(g=>u.current.set(g.id,g)),_(Array.from(u.current.values()).sort((g,p)=>p.criado_em.localeCompare(g.criado_em)))},[]),d=t.useCallback(()=>{var g,p;if(s.current.length===0)return;const m=u.current;for(const N of s.current)if(N.action==="INSERT"&&N.newRecord)m.set(N.newRecord.id,N.newRecord);else if(N.action==="UPDATE"&&N.newRecord)m.set(N.newRecord.id,N.newRecord);else if(N.action==="DELETE"){const w=((g=N.oldRecord)==null?void 0:g.id)||((p=N.newRecord)==null?void 0:p.id);w&&m.delete(w)}s.current=[],_(Array.from(m.values()).sort((N,w)=>w.criado_em.localeCompare(N.criado_em)))},[]),y=t.useCallback(async()=>{try{$(!0);const{data:m,error:g}=await Je.from("notas").select("*, aluno:alunos(*), disciplina:disciplinas(*)").order("criado_em",{ascending:!1});if(g)throw g;v(m||[]),L.current=!0,d()}catch(m){F(m.message||"Erro ao carregar notas")}finally{$(!1)}},[v,d]);return We("notas",m=>{var p,N;if(!C)return;if(!L.current){s.current.push(m);return}const g=u.current;if(m.action==="INSERT"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="UPDATE"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="DELETE"){const w=((p=m.oldRecord)==null?void 0:p.id)||((N=m.newRecord)==null?void 0:N.id);w&&g.delete(w)}_(Array.from(g.values()).sort((w,c)=>c.criado_em.localeCompare(w.criado_em)))}),t.useEffect(()=>{C&&o&&y()},[C,o,y]),{notas:k,loading:A,error:J,refetch:y}}function fs(r={}){const{enabled:C=!0,initialFetch:o=!0}=r,[k,_]=t.useState([]),[A,$]=t.useState(!!o),[J,F]=t.useState(null),u=t.useRef(new Map),L=t.useRef(!1),s=t.useRef([]),v=t.useCallback(m=>{u.current.clear(),m.forEach(g=>u.current.set(g.id,g)),_(Array.from(u.current.values()).sort((g,p)=>p.data_envio.localeCompare(g.data_envio)))},[]),d=t.useCallback(()=>{if(s.current.length===0)return;const m=u.current;for(const g of s.current)g.action==="INSERT"&&g.newRecord||g.action==="UPDATE"&&g.newRecord?m.set(g.newRecord.id,g.newRecord):g.action==="DELETE"&&g.oldRecord&&m.delete(g.oldRecord.id);s.current=[],_(Array.from(m.values()).sort((g,p)=>p.data_envio.localeCompare(g.data_envio)))},[]),y=t.useCallback(async()=>{if(C)try{$(!0);const{data:m,error:g}=await Je.from("recados").select("*, autor:usuarios!enviado_por(*)").order("data_envio",{ascending:!1});if(g)throw g;v(m||[]),L.current=!0,d()}catch(m){F(m.message||"Erro ao carregar recados")}finally{$(!1)}},[v,C,d]);return We("recados",m=>{var p,N;if(!C)return;if(!L.current){s.current.push(m);return}const g=u.current;if(m.action==="INSERT"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="UPDATE"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="DELETE"){const w=((p=m.oldRecord)==null?void 0:p.id)||((N=m.newRecord)==null?void 0:N.id);w&&g.delete(w)}_(Array.from(g.values()).sort((w,c)=>c.data_envio.localeCompare(w.data_envio)))}),t.useEffect(()=>{if(!C)return;const m=vs(({id:g})=>{const p=u.current;p.has(g)&&(p.delete(g),_(Array.from(p.values()).sort((N,w)=>w.data_envio.localeCompare(N.data_envio))))});return()=>{m()}},[C]),t.useEffect(()=>{C&&o&&y()},[C,o,y]),{recados:k,loading:A,error:J,refetch:y}}function Ls({isOpen:r,onClose:C,onSave:o}){const{user:k}=be(),{isSupabaseConnected:_}=be(),A=Te(k,_),[$,J]=t.useState([]),[F,u]=t.useState([]),[L,s]=t.useState([]),[v,d]=t.useState(""),[y,m]=t.useState(""),[g,p]=t.useState("1"),[N,w]=t.useState(""),[c,R]=t.useState(""),[z,h]=t.useState([]),[X,D]=t.useState(!1),[j,V]=t.useState(!1),[G,T]=t.useState({}),[B,ee]=t.useState("");t.useEffect(()=>{r&&k&&re()},[r,k]),t.useEffect(()=>{v&&(U(),E())},[v]),t.useEffect(()=>{y&&ie()},[y,L]);const re=async()=>{try{const a=await A.getTurmas();J(a),a.length===1&&d(a[0].id)}catch(a){console.error("Erro ao carregar turmas:",a)}},E=async()=>{try{const b=(await A.getDisciplinas()).filter(n=>n.turma_id===v);u(b),b.length===1&&m(b[0].id)}catch(a){console.error("Erro ao carregar disciplinas:",a)}},U=async()=>{try{const a=await A.getAlunos();s(a)}catch(a){console.error("Erro ao carregar alunos:",a)}},ie=()=>{const b=L.filter(n=>n.turma_id===v).map(n=>({alunoId:n.id,nota:"",comentario:""}));h(b)},Q=()=>{B&&!isNaN(parseFloat(B))&&(h(a=>a.map(b=>({...b,nota:B}))),ee(""))},oe=()=>{const a=z.filter(b=>b.nota&&!isNaN(parseFloat(b.nota)));return a.length===0?0:a.reduce((b,n)=>b+parseFloat(n.nota),0)/a.length},me=(a,b,n)=>{h(M=>M.map(se=>se.alunoId===a?{...se,[b]:n}:se))},f=()=>{const a={};return v||(a.turma="Selecione uma turma"),y||(a.disciplina="Selecione uma disciplina"),N||(a.tipo="Selecione o tipo de avaliação"),c.trim()||(a.descricao="Descrição da avaliação é obrigatória"),z.filter(n=>!!(n.nota&&(isNaN(parseFloat(n.nota))||parseFloat(n.nota)<0||parseFloat(n.nota)>10))).length>0&&(a.notas="Algumas notas são inválidas (devem estar entre 0 e 10)"),T(a),Object.keys(a).length===0},x=async()=>{if(f()){D(!0);try{const a=z.filter(b=>b.nota.trim()!=="");for(const b of a)await A.createNota({aluno_id:b.alunoId,disciplina_id:y,trimestre:parseInt(g),nota:parseFloat(b.nota),comentario:b.comentario||void 0});V(!0),setTimeout(()=>{o(),C(),Y()},1500)}catch(a){console.error("Erro ao salvar notas:",a),T({submit:"Erro ao salvar notas"})}finally{D(!1)}}},Y=()=>{d(""),m(""),p("1"),w(""),R(""),h([]),T({}),V(!1)};if(!r)return null;const i=$.find(a=>a.id===v),P=F.find(a=>a.id===y),q=L.filter(a=>a.turma_id===v);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(pe,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lançamento Rápido de Notas"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sistema otimizado para agilidade"})]})]}),e.jsx("button",{onClick:()=>{C(),Y()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Re,{className:"h-5 w-5 text-gray-500"})})]}),j&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Notas lançadas com sucesso!"})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Turma *"}),e.jsxs("select",{value:v,onChange:a=>{d(a.target.value),m("")},className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${G.turma?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),$.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),G.turma&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),G.turma]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("select",{value:y,onChange:a=>m(a.target.value),disabled:!v,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${G.disciplina?"border-red-300":"border-gray-300"} ${v?"":"bg-gray-50 cursor-not-allowed"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),F.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]}),G.disciplina&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),G.disciplina]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trimestre *"}),e.jsxs("select",{value:g,onChange:a=>p(a.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",children:[e.jsx("option",{value:"1",children:"1º Trimestre"}),e.jsx("option",{value:"2",children:"2º Trimestre"}),e.jsx("option",{value:"3",children:"3º Trimestre"}),e.jsx("option",{value:"4",children:"4º Trimestre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Avaliação *"}),e.jsxs("select",{value:N,onChange:a=>w(a.target.value),className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${G.tipo?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"participacao",children:"Participação"}),e.jsx("option",{value:"recuperacao",children:"Recuperação"})]}),G.tipo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),G.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição *"}),e.jsx("input",{type:"text",value:c,onChange:a=>R(a.target.value),className:`w-full px-3 py-2 border-2 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${G.descricao?"border-red-300":"border-gray-300"}`,placeholder:"Ex: Prova de Frações"}),G.descricao&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),G.descricao]})]})]}),v&&y&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:i==null?void 0:i.nome})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:P==null?void 0:P.nome})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[g,"º Trimestre"]})]})]})}),y&&q.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900",children:["Lançar Notas (",q.length," alunos)"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"0",max:"10",step:"0.1",value:B,onChange:a=>ee(a.target.value),placeholder:"Nota",className:"w-20 px-2 py-1 border border-gray-300 rounded text-center focus:ring-2 focus:ring-blue-500"}),e.jsxs("button",{onClick:Q,disabled:!B,className:"flex items-center space-x-1 px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors disabled:opacity-50",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{children:"Aplicar a Todos"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-gray-100 rounded-lg",children:[e.jsx(Es,{className:"h-4 w-4 text-gray-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Média: ",oe().toFixed(1)]})]})]})]}),G.notas&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),G.notas]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:q.map(a=>{const b=z.find(M=>M.alunoId===a.id),n=parseFloat((b==null?void 0:b.nota)||"0");return e.jsxs("div",{className:`flex items-center space-x-4 p-4 border-2 rounded-lg transition-all ${n>=7?"border-green-200 bg-green-50":n>=5?"border-yellow-200 bg-yellow-50":n>0?"border-red-200 bg-red-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ${n>=7?"bg-green-500":n>=5?"bg-yellow-500":n>0?"bg-red-500":"bg-blue-500"}`,children:a.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 text-lg",children:a.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:n>0?e.jsxs("span",{className:`font-medium ${n>=7?"text-green-600":n>=5?"text-yellow-600":"text-red-600"}`,children:["Nota atual: ",n.toFixed(1)]}):"Aguardando nota"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nota (0-10)"}),e.jsx("input",{type:"number",min:"0",max:"10",step:"0.1",value:(b==null?void 0:b.nota)||"",onChange:M=>me(a.id,"nota",M.target.value),className:"w-24 px-3 py-2 border-2 border-gray-300 rounded-lg text-center text-lg font-bold focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"0.0"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comentário (opcional)"}),e.jsx("input",{type:"text",value:(b==null?void 0:b.comentario)||"",onChange:M=>me(a.id,"comentario",M.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",placeholder:"Observações..."})]})]})]},a.id)})}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:z.filter(a=>a.nota.trim()!=="").length}),e.jsx("div",{className:"text-sm text-blue-800",children:"Notas Lançadas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:z.filter(a=>parseFloat(a.nota)>=7).length}),e.jsx("div",{className:"text-sm text-green-800",children:"Aprovados (≥7)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:z.filter(a=>parseFloat(a.nota)>=5&&parseFloat(a.nota)<7).length}),e.jsx("div",{className:"text-sm text-yellow-800",children:"Recuperação (5-6.9)"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:z.filter(a=>parseFloat(a.nota)>0&&parseFloat(a.nota)<5).length}),e.jsxs("div",{className:"text-sm text-red-800",children:["Reprovados ","(<5)"]})]})]})})]}),$.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma turma atribuída"}),e.jsx("p",{className:"text-gray-500",children:"Você ainda não possui turmas atribuídas. Entre em contato com o administrador."})]}),G.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),G.submit]})})]}),$.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{C(),Y()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:x,disabled:X||j||!y||z.filter(a=>a.nota.trim()!=="").length===0,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:X?"Salvando...":`Salvar ${z.filter(a=>a.nota.trim()!=="").length} Notas`})]})]})]})})}function Hs(){var as,ts,rs,ls,is,os,ns,ds;const{user:r,isSupabaseConnected:C}=be(),o=Te(r,C),[k,_]=t.useState([]),[A,$]=t.useState([]),[J,F]=t.useState([]),[u]=t.useState([]),[L,s]=t.useState([]),[v,d]=t.useState([]),[y,m]=t.useState(null),[g,p]=t.useState(!1),[N,w]=t.useState(!1),[c,R]=t.useState(null),[z,h]=t.useState("prova_tarefa"),[X,D]=t.useState(!1),[j,V]=t.useState(!1),[G,T]=t.useState(""),[B,ee]=t.useState(""),[re,E]=t.useState(!1),[U,ie]=t.useState(null),[Q,oe]=t.useState({aluno:"",disciplina:"",bimestre:"",tipo:""}),[me,f]=t.useState(!0),[x,Y]=t.useState(!1),[i,P]=t.useState(null),[q,a]=t.useState({}),b=((r==null?void 0:r.tipo_usuario)||"").toLowerCase(),n=r&&(b==="admin"||b==="professor"),{notas:M,loading:se}=$s({enabled:!!C&&!!r,initialFetch:!0}),{recados:ae}=fs({enabled:!!C&&!!r,initialFetch:!0}),W=C;t.useEffect(()=>{r&&!W&&K()},[r,W]),t.useEffect(()=>{W&&s(ae)},[W,ae]);const K=async()=>{try{const[l,S,I,O,ne]=await Promise.all([o.getNotas(),o.getAlunos(),o.getDisciplinas(),o.getRecados(),o.getProvasTarefas()]),ce=l.sort((Z,ke)=>{const js=Z.criado_em;return ke.criado_em.localeCompare(js)});_(ce),$(S),F(I),s(O),d(ne)}catch(l){console.error("Erro ao carregar notas:",l)}finally{f(!1)}},H=l=>{if(C)return l;{const S=cs.getDisciplinas(),I=cs.getAlunos(),O=S.find(ce=>ce.id===l.disciplina_id),ne=I.find(ce=>ce.id===l.aluno_id);return{...l,disciplina:O,aluno:ne}}},de=(l,S)=>o.calcularMediaAluno(l,k,S),Se=l=>{m(l),p(!0)},ye=(l,S)=>{R(l),h(S),w(!0)},_e=l=>{ie(l),E(!0)},De=l=>{console.log("[NotasPage] startEditNota clicado",{notaId:l.id,nota:l}),P(l.id),a({nota:(l.nota??l.valor??"").toString(),comentario:l.comentario??l.descricao??"",trimestre:(l.trimestre??l.bimestre??"").toString()}),setTimeout(()=>{console.log("[NotasPage] Estado após startEditNota",{editingNotaId:l.id,editValues:q})},0)},we=()=>{P(null),a({})},xe=async l=>{if(!n)return;console.log("[NotasPage] Salvando nota",{notaId:l.id,editValues:q});const S=q.nota?parseFloat(q.nota):void 0;if(S!==void 0&&(isNaN(S)||S<0||S>10)){alert("Nota inválida. Informe um número entre 0 e 10.");return}const I=q.trimestre?parseInt(q.trimestre):void 0;if(I!==void 0&&(I<1||I>4)){alert("Trimestre inválido (1 a 4).");return}const O=W;let ne=null;if(O){ne=[...W?M:k];const ce=Z=>Z.id===l.id?{...Z,nota:S!==void 0?S:Z.nota,comentario:q.comentario!==void 0?q.comentario:Z.comentario,trimestre:I!==void 0?I:Z.trimestre}:Z;_(W?Z=>Z.map(ce):Z=>Z.map(ce))}try{const ce=await o.updateNota(l.id,{nota:S,comentario:q.comentario,trimestre:I});if(console.log("[NotasPage] Resultado updateNota",ce),!ce){ne&&_(ne),alert("Falha ao atualizar nota (permissão ou erro).");return}O||await K(),we()}catch(ce){console.error("Erro ao salvar edição da nota:",ce),ne&&_(ne),alert("Erro ao salvar. Veja o console.")}},fe=async()=>{if(!n||L.length===0||!confirm(`Tem certeza que deseja excluir TODOS os ${L.length} recados? Esta ação não pode ser desfeita.`))return;Y(!0);const l=L.map(I=>I.id),S=[...L];s([]);try{const I=await o.bulkDeleteRecados(l);I.failedIds.length>0&&(alert(`Alguns recados não puderam ser excluídos: ${I.failedIds.length}`),W?K():s(S.filter(O=>!I.successIds.includes(O.id))))}catch(I){console.error("Erro ao excluir todos recados:",I),alert("Erro ao excluir recados."),s(S)}finally{Y(!1)}},Fe=async l=>{if(!n||!confirm("Tem certeza que deseja excluir esta nota?"))return;const S=W;let I=null;S&&(I=[...W?M:k],_(O=>O.filter(ne=>ne.id!==l.id)));try{if(!await o.deleteNota(l.id)){I&&_(I),alert("Não foi possível excluir a nota (permissão ou erro).");return}S||await K()}catch(O){console.error("Erro ao excluir nota:",O),I&&_(I),alert("Erro ao excluir. Veja o console.")}},Ye=(W?M:k).filter(l=>{var S;return(!Q.aluno||l.aluno_id===Q.aluno)&&(!Q.disciplina||l.disciplina_id===Q.disciplina)&&(!Q.bimestre||((S=l.trimestre||l.bimestre)==null?void 0:S.toString())===Q.bimestre)&&(!Q.tipo||!0)});return me&&!W||W&&se?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(pe,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:r.tipo_usuario==="pai"?"📊 Boletim dos Filhos":r.tipo_usuario==="professor"?"📝 Notas Lançadas":"🎯 Gestão de Notas"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:r.tipo_usuario==="pai"?"Acompanhe o desempenho acadêmico":"Sistema de lançamento de notas"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&L.length>0&&e.jsxs("button",{onClick:fe,disabled:x,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${x?"bg-gray-400 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:x?"Excluindo...":"Excluir Todas Notificações"})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("button",{onClick:()=>D(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"Lançar Notas"})]})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(pe,{className:"h-5 w-5 mr-2 text-blue-600"}),"Lançamento Rápido de Notas"]}),e.jsx("button",{onClick:()=>V(!j),className:`px-4 py-2 rounded-lg transition-colors ${j?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:j?"Cancelar":"Ativar Modo Rápido"})]}),j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("select",{value:G,onChange:l=>T(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:e.jsx("option",{value:"",children:"Selecione uma turma"})}),e.jsx("select",{value:B,onChange:l=>ee(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:e.jsx("option",{value:"",children:"Selecione uma disciplina"})})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["💡 ",e.jsx("strong",{children:"Modo Rápido:"})," Selecione turma e disciplina para lançar notas de forma ágil"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900 text-sm sm:text-base",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Aluno"}),e.jsxs("select",{value:Q.aluno,onChange:l=>oe({...Q,aluno:l.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os alunos"}),A.map(l=>e.jsx("option",{value:l.id,children:l.nome},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Disciplina"}),e.jsxs("select",{value:Q.disciplina,onChange:l=>oe({...Q,disciplina:l.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todas as disciplinas"}),J.map(l=>e.jsx("option",{value:l.id,children:l.nome},l.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Trimestre"}),e.jsxs("select",{value:Q.bimestre,onChange:l=>oe({...Q,bimestre:l.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os trimestres"}),e.jsx("option",{value:"1",children:"1º Trimestre"}),e.jsx("option",{value:"2",children:"2º Trimestre"}),e.jsx("option",{value:"3",children:"3º Trimestre"}),e.jsx("option",{value:"4",children:"4º Trimestre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:Q.tipo,onChange:l=>oe({...Q,tipo:l.target.value}),className:"w-full px-2 sm:px-3 py-1.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),!C&&e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"participacao",children:"Participação"}),e.jsx("option",{value:"recuperacao",children:"Recuperação"})]})]})]})]}),r.tipo_usuario==="pai"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-black bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent flex items-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg mr-3",children:e.jsx(je,{className:"h-6 w-6 text-white"})}),"🌟 Boletim dos Filhos"]}),A.map(l=>{var S,I;return e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-2xl shadow-xl border-2 border-blue-200 mb-6",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b-2 border-blue-200 bg-gradient-to-r from-blue-100 via-purple-100 to-indigo-100 cursor-pointer hover:from-blue-200 hover:to-indigo-200 transition-all group rounded-t-2xl",onClick:()=>Se(l),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-blue-500 via-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-xl sm:text-2xl shadow-2xl",children:l.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-black text-gray-900 group-hover:text-blue-700 transition-colors",children:l.nome}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-700 font-bold",children:["🏫 ",(S=l.turma)==null?void 0:S.nome," • 📅 ",(I=l.turma)==null?void 0:I.ano_letivo]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mt-2 space-y-1 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(pe,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-xs sm:text-sm text-blue-600 font-bold",children:["📝 ",k.filter(O=>O.aluno_id===l.id).length," notas"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ze,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:`text-xs sm:text-sm font-black ${de(l.id)>=7?"text-green-700":de(l.id)>=5?"text-yellow-700":"text-red-700"}`,children:["📊 Média: ",de(l.id).toFixed(1)]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`inline-flex items-center px-4 sm:px-6 py-2 sm:py-3 rounded-2xl text-lg sm:text-xl font-black shadow-xl ${de(l.id)>=7?"bg-gradient-to-r from-green-400 to-green-600 text-white":de(l.id)>=5?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white":"bg-gradient-to-r from-red-400 to-red-600 text-white"}`,children:de(l.id).toFixed(1)}),e.jsx("p",{className:"text-xs text-blue-700 mt-2 opacity-0 group-hover:opacity-100 transition-opacity hidden sm:block font-black bg-white px-3 py-1 rounded-xl",children:"✨ Clique para ver detalhes completos"})]})]})}),e.jsxs("div",{className:"p-4 sm:p-6 bg-gradient-to-br from-gray-50 to-blue-50 rounded-b-2xl",children:[e.jsxs("h4",{className:"text-lg sm:text-xl font-black text-gray-900 mb-4 sm:mb-6 flex items-center",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg mr-3",children:e.jsx(pe,{className:"h-5 w-5 text-white"})}),"📚 Notas por Disciplina"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:J.map(O=>{const ne=k.filter(Z=>Z.aluno_id===l.id&&Z.disciplina_id===O.id);if(ne.length===0)return null;const ce=ne.reduce((Z,ke)=>Z+(ke.nota||0),0)/ne.length;return e.jsxs("div",{className:"border-2 border-gray-300 rounded-2xl p-4 sm:p-5 hover:border-blue-400 hover:shadow-xl transition-all duration-300 hover:scale-105 bg-gradient-to-br from-white to-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-2xl flex items-center justify-center text-white font-black text-base sm:text-lg shadow-lg",style:{backgroundColor:O.cor||"#3B82F6"},children:O.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-black text-gray-900 text-sm sm:text-base",children:O.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600 font-bold",children:["📝 ",ne.length," nota(s)"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`px-3 sm:px-4 py-2 rounded-2xl text-sm sm:text-base font-black shadow-lg ${ce>=7?"bg-gradient-to-r from-green-400 to-green-600 text-white":ce>=5?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white":"bg-gradient-to-r from-red-400 to-red-600 text-white"}`,children:ce.toFixed(1)})})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:ne.sort((Z,ke)=>(ke.trimestre||0)-(Z.trimestre||0)).map(Z=>e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 bg-gradient-to-r from-white to-gray-50 rounded-xl border border-gray-200 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-3 space-y-1 sm:space-y-0",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-black text-gray-800",children:["📅 ",Z.trimestre,"º Trimestre"]}),e.jsx("span",{className:"text-xs text-gray-600 font-semibold",children:new Date(Z.criado_em).toLocaleDateString("pt-BR")})]}),Z.comentario&&e.jsxs("p",{className:"text-xs sm:text-sm text-gray-700 mt-1 italic line-clamp-2 font-medium",children:['💬 "',Z.comentario,'"']})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-shrink-0 ml-2",children:[e.jsx("span",{className:`text-lg sm:text-xl font-black ${(Z.nota||0)>=7?"text-green-700":(Z.nota||0)>=5?"text-yellow-700":"text-red-700"}`,children:(Z.nota||0).toFixed(1)}),e.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 rounded-full shadow-sm ${(Z.nota||0)>=7?"bg-green-500":(Z.nota||0)>=5?"bg-yellow-500":"bg-red-500"}`})]})]},Z.id))})]},O.id)})})]})]},l.id)})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:e.jsxs("h2",{className:"text-base sm:text-lg font-semibold text-gray-900",children:["Notas Detalhadas (",Ye.length,") ",W&&e.jsx("span",{className:"text-xs text-blue-500 ml-2",children:"Realtime"})]})}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aluno"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disciplina"}),!C&&e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Tipo"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nota"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Trimestre"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Comentário"}),e.jsx("th",{className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ye.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:C?6:7,className:"px-3 sm:px-6 py-6 sm:py-8 text-center text-gray-500 text-sm",children:"Nenhuma nota encontrada com os filtros aplicados"})}):Ye.map(l=>{var S,I,O,ne,ce;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs sm:text-sm font-semibold mr-2 sm:mr-3 flex-shrink-0",children:(I=(S=H(l).aluno)==null?void 0:S.nome)==null?void 0:I.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 truncate",children:((O=H(l).aluno)==null?void 0:O.nome)||"Aluno não encontrado"})]})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 rounded-full mr-1 sm:mr-2 flex-shrink-0",style:{backgroundColor:((ne=H(l).disciplina)==null?void 0:ne.cor)||"#3B82F6"}}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-900 truncate",children:((ce=H(l).disciplina)==null?void 0:ce.nome)||"Disciplina não encontrada"})]})}),!C&&e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap hidden sm:table-cell",children:e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full ${l.tipo==="prova"?"bg-red-100 text-red-800":l.tipo==="trabalho"?"bg-blue-100 text-blue-800":l.tipo==="participacao"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:l.tipo})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:i===l.id?e.jsx("input",{value:q.nota||"",onChange:Z=>a(ke=>({...ke,nota:Z.target.value})),className:"w-16 border rounded px-1 py-0.5 text-sm focus:ring-2 focus:ring-blue-500",type:"number",step:"0.1",min:0,max:10}):e.jsx("span",{className:`text-base sm:text-lg font-bold ${(l.nota||l.valor||0)>=7?"text-green-600":(l.nota||l.valor||0)>=5?"text-yellow-600":"text-red-600"}`,children:(l.nota||l.valor||0).toFixed(1)})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900 hidden sm:table-cell",children:i===l.id?e.jsx("input",{value:q.trimestre||"",onChange:Z=>a(ke=>({...ke,trimestre:Z.target.value})),className:"w-14 border rounded px-1 py-0.5 text-sm focus:ring-2 focus:ring-blue-500",type:"number",min:1,max:4}):e.jsxs(e.Fragment,{children:[l.trimestre||l.bimestre,"º"]})}),e.jsx("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 hidden lg:table-cell",children:i===l.id?e.jsx("input",{value:q.comentario||"",onChange:Z=>a(ke=>({...ke,comentario:Z.target.value})),className:"w-full border rounded px-2 py-1 text-xs focus:ring-2 focus:ring-blue-500",placeholder:"Comentário"}):l.comentario||"-"}),e.jsxs("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-sm font-medium flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>_e(l),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50 transition-colors",title:"Ver detalhes da nota",children:e.jsx(qe,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),n&&(i===l.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>xe(l),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-50",title:"Salvar",children:e.jsx(le,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx("button",{onClick:we,className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-50",title:"Cancelar",children:e.jsx(Ps,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>De(l),className:"text-indigo-600 hover:text-indigo-900 p-1 rounded hover:bg-indigo-50",title:"Editar nota",children:e.jsx(Ve,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx("button",{type:"button",onClick:()=>Fe(l),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Excluir nota",children:e.jsx(Ae,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]}))]})]},l.id)})})]})})]}),g&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm sm:max-w-2xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg sm:text-xl",children:y.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:y.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-600",children:[(as=y.turma)==null?void 0:as.nome," • ",(ts=y.turma)==null?void 0:ts.ano_letivo]})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"p-1.5 sm:p-2 hover:bg-white hover:bg-opacity-50 rounded-full transition-colors",children:e.jsx(Re,{className:"h-4 w-4 sm:h-5 sm:w-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Desempenho Acadêmico"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-blue-600",children:"Média Geral"}),e.jsx("p",{className:`text-xl sm:text-2xl font-bold ${de(y.id)>=7?"text-green-600":de(y.id)>=5?"text-yellow-600":"text-red-600"}`,children:de(y.id).toFixed(1)})]}),e.jsx(Ze,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-green-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-green-600",children:"Total Notas"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-green-900",children:k.filter(l=>l.aluno_id===y.id).length})]}),e.jsx(pe,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-purple-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-purple-600",children:"Recados"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-purple-900",children:L.filter(l=>l.destinatario_tipo==="geral"||l.destinatario_tipo==="turma"&&l.destinatario_id===y.turma_id||l.destinatario_tipo==="aluno"&&l.destinatario_id===y.id).length})]}),e.jsx(ve,{className:"h-6 w-6 sm:h-8 sm:w-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-yellow-50 p-3 sm:p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-yellow-600",children:"Próximas Provas"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-yellow-900",children:v.filter(l=>{var I;const S=new Date().toISOString().split("T")[0];return((I=l.disciplina)==null?void 0:I.turma_id)===y.turma_id&&l.data>=S}).length})]}),e.jsx(he,{className:"h-6 w-6 sm:h-8 sm:w-8 text-yellow-600"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Notas por Disciplina"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:J.map(l=>{const S=k.filter(O=>O.aluno_id===y.id&&O.disciplina_id===l.id);if(S.length===0)return null;const I=S.reduce((O,ne)=>O+(ne.nota||0),0)/S.length;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 mb-2 sm:mb-3",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full flex-shrink-0",style:{backgroundColor:l.cor||"#3B82F6"}}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base",children:l.nome}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:[S.length," nota(s)"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("span",{className:`text-base sm:text-lg font-bold ${I>=7?"text-green-600":I>=5?"text-yellow-600":"text-red-600"}`,children:I.toFixed(1)})})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:S.map(O=>e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsxs("span",{className:"text-gray-600 truncate flex-1 mr-2",children:[O.trimestre,"º Trimestre",O.comentario&&` • ${O.comentario}`]}),e.jsx("span",{className:`font-medium flex-shrink-0 ${(O.nota||0)>=7?"text-green-600":(O.nota||0)>=5?"text-yellow-600":"text-red-600"}`,children:(O.nota||0).toFixed(1)})]},O.id))})]},l.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Próximas Avaliações"}),(()=>{const l=v.filter(S=>{var O;const I=new Date().toISOString().split("T")[0];return((O=S.disciplina)==null?void 0:O.turma_id)===y.turma_id&&S.data>=I}).sort((S,I)=>S.data.localeCompare(I.data));return l.length===0?e.jsx("p",{className:"text-gray-500 text-center py-3 sm:py-4 text-sm",children:"Nenhuma avaliação próxima"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:l.slice(0,5).map(S=>{var I;return e.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4 p-2 sm:p-3 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all cursor-pointer",onClick:()=>ye(S,"prova_tarefa"),children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-yellow-50 rounded-full flex-shrink-0",children:e.jsx(he,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:S.titulo}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:(I=S.disciplina)==null?void 0:I.nome})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-900",children:new Date(S.data).toLocaleDateString("pt-BR")}),e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full ${S.tipo==="prova"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:S.tipo})]})]},S.id)})})})()]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4",children:"Recados Recentes"}),(()=>{const l=L.filter(S=>S.destinatario_tipo==="geral"||S.destinatario_tipo==="turma"&&S.destinatario_id===y.turma_id||S.destinatario_tipo==="aluno"&&S.destinatario_id===y.id).slice(0,5);return l.length===0?e.jsx("p",{className:"text-gray-500 text-center py-3 sm:py-4 text-sm",children:"Nenhum recado recente"}):e.jsx("div",{className:"space-y-2 sm:space-y-3",children:l.map(S=>{var I;return e.jsxs("div",{className:"flex items-start space-x-3 sm:space-x-4 p-2 sm:p-3 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-purple-50 transition-all cursor-pointer",onClick:()=>ye(S,"recado"),children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-purple-50 rounded-full flex-shrink-0",children:e.jsx(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900 text-sm sm:text-base truncate",children:S.titulo}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 line-clamp-2",children:S.conteudo}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Por: ",(I=S.autor)==null?void 0:I.nome," • ",new Date(S.data_envio).toLocaleDateString("pt-BR")]})]}),e.jsx("span",{className:`px-1.5 sm:px-2 py-0.5 sm:py-1 text-xs rounded-full flex-shrink-0 ${S.destinatario_tipo==="geral"?"bg-blue-100 text-blue-800":S.destinatario_tipo==="turma"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:S.destinatario_tipo})]},S.id)})})})()]})]}),e.jsx("div",{className:"flex justify-end p-4 sm:p-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>p(!1),className:"px-4 sm:px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors text-sm sm:text-base",children:"Fechar"})})]})}),e.jsx(ze,{isOpen:N,onClose:()=>w(!1),item:c,type:z,turmaName:(rs=y==null?void 0:y.turma)==null?void 0:rs.nome,disciplinaName:z==="prova_tarefa"&&c?(ls=c.disciplina)==null?void 0:ls.nome:void 0,autorName:z==="recado"&&c?(is=c.autor)==null?void 0:is.nome:void 0}),e.jsx(Ls,{isOpen:X,onClose:()=>D(!1),onSave:()=>{D(!1),K()}}),e.jsx(ze,{isOpen:re,onClose:()=>{E(!1),ie(null)},item:U,type:"nota",turmaName:U?(os=u.find(l=>{var S;return l.id===((S=U.aluno)==null?void 0:S.turma_id)}))==null?void 0:os.nome:"",disciplinaName:(ns=U==null?void 0:U.disciplina)==null?void 0:ns.nome,autorName:(ds=U==null?void 0:U.aluno)==null?void 0:ds.nome})]})}function zs({isOpen:r,onClose:C,provaTarefa:o,onSave:k}){const{user:_}=be(),{isSupabaseConnected:A}=be(),$=Te(_,A),[J,F]=t.useState([]),[u,L]=t.useState([]),[s,v]=t.useState({disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),[d,y]=t.useState({}),[m,g]=t.useState(!1),[p,N]=t.useState(!1);t.useEffect(()=>{r&&_&&w()},[r,_]),t.useEffect(()=>{v(o?{disciplina_id:o.disciplina_id,titulo:o.titulo,tipo:o.tipo,data:o.data,descricao:o.descricao||""}:{disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),y({}),N(!1)},[o,r]);const w=async()=>{try{const[D,j]=await Promise.all([$.getTurmas(),$.getDisciplinas()]);F(D),L(j),j.length===1&&v(V=>({...V,disciplina_id:j[0].id}))}catch(D){console.error("Erro ao carregar dados:",D)}},c=()=>{const D={};if(s.disciplina_id||(D.disciplina_id="Disciplina é obrigatória"),(!s.titulo.trim()||s.titulo.length<3)&&(D.titulo="Título deve ter pelo menos 3 caracteres"),!s.data)D.data="Data é obrigatória";else{const j=new Date(s.data),V=new Date;V.setHours(0,0,0,0),j<V&&(D.data="Data não pode ser no passado")}return s.tipo||(D.tipo="Tipo é obrigatório"),y(D),Object.keys(D).length===0},R=async D=>{if(D.preventDefault(),!!c()){g(!0);try{o?(await $.updateProvaTarefa(o.id,s),console.log("✅ Prova/Tarefa atualizada")):(await $.createProvaTarefa(s),console.log("✅ Prova/Tarefa criada")),N(!0),setTimeout(()=>{k(),C(),z()},1500)}catch(j){console.error("Erro ao salvar prova/tarefa:",j),y({submit:"Erro ao salvar prova/tarefa"})}finally{g(!1)}}},z=()=>{v({disciplina_id:"",titulo:"",tipo:"prova",data:"",descricao:""}),y({}),N(!1)};if(!r)return null;const h=u.find(D=>D.id===s.disciplina_id),X=J.find(D=>D.id===(h==null?void 0:h.turma_id));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(he,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o?"Editar Prova/Tarefa":"Nova Prova/Tarefa"})]}),e.jsx("button",{onClick:()=>{C(),z()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Re,{className:"h-5 w-5 text-gray-500"})})]}),p&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:o?"Prova/Tarefa atualizada com sucesso!":"Prova/Tarefa criada com sucesso!"})]})}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tipo de Atividade *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>v({...s,tipo:"prova"}),className:`p-4 border rounded-lg text-center transition-colors ${s.tipo==="prova"?"border-red-500 bg-red-50 text-red-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(ue,{className:"h-5 w-5 text-red-600"})}),e.jsx("span",{className:"text-sm font-medium",children:"Prova"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Avaliação formal"})]}),e.jsxs("button",{type:"button",onClick:()=>v({...s,tipo:"tarefa"}),className:`p-4 border rounded-lg text-center transition-colors ${s.tipo==="tarefa"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full w-fit mx-auto mb-2",children:e.jsx(pe,{className:"h-5 w-5 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium",children:"Tarefa"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Trabalho/Exercício"})]})]}),d.tipo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.tipo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s.disciplina_id,onChange:D=>v({...s,disciplina_id:D.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.disciplina_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),u.map(D=>e.jsx("option",{value:D.id,children:D.nome},D.id))]})]}),d.disciplina_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.disciplina_id]})]}),s.disciplina_id&&h&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:h.cor||"#3B82F6"}}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:h.nome})]}),X&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:X.nome})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título *"}),e.jsx("input",{type:"text",value:s.titulo,onChange:D=>v({...s,titulo:D.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.titulo?"border-red-300":"border-gray-300"}`,placeholder:`Ex: ${s.tipo==="prova"?"Prova de Matemática - Frações":"Exercícios sobre Sistema Solar"}`}),d.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Entrega/Aplicação *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:s.data,onChange:D=>v({...s,data:D.target.value}),min:new Date().toISOString().split("T")[0],className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.data?"border-red-300":"border-gray-300"}`})]}),d.data&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.data]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Data mínima: ",new Date().toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição/Instruções"}),e.jsx("textarea",{value:s.descricao,onChange:D=>v({...s,descricao:D.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:`Descreva ${s.tipo==="prova"?"o conteúdo da prova, materiais permitidos...":"as instruções da tarefa, critérios de avaliação..."}`}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.descricao.length,"/500 caracteres"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:s.tipo==="prova"?"📝 Dicas para Provas:":"📚 Dicas para Tarefas:"}),e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:s.tipo==="prova"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Defina claramente o conteúdo que será cobrado"}),e.jsx("li",{children:"• Informe materiais permitidos (calculadora, consulta, etc.)"}),e.jsx("li",{children:"• Especifique duração e formato da prova"}),e.jsx("li",{children:"• Comunique critérios de avaliação"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Explique claramente o que deve ser entregue"}),e.jsx("li",{children:"• Defina formato de entrega (físico, digital, etc.)"}),e.jsx("li",{children:"• Especifique critérios de avaliação"}),e.jsx("li",{children:"• Informe se é individual ou em grupo"})]})})]}),u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma disciplina atribuída"}),e.jsx("p",{className:"text-gray-500",children:"Você ainda não possui disciplinas atribuídas. Entre em contato com o administrador."})]}),d.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),d.submit]})})]}),u.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{C(),z()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:R,disabled:m||p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:m?"Salvando...":o?"Salvar Alterações":"Criar Atividade"})]})]})]})})}function Gs(){var P,q;const{user:r,isSupabaseConnected:C}=be(),o=Te(r,C),[k,_]=t.useState([]),[A,$]=t.useState([]),[J,F]=t.useState([]),[u,L]=t.useState([]),[s,v]=t.useState("agenda"),[d,y]=t.useState({}),[m,g]=t.useState({}),[p,N]=t.useState({turma:"",disciplina:"",tipo:"",periodo:"proximas"}),[w,c]=t.useState(!1),[R,z]=t.useState(null),[h,X]=t.useState(!0),[D,j]=t.useState(!1),[V,G]=t.useState(null);t.useEffect(()=>{r&&T()},[r]),t.useEffect(()=>{(r==null?void 0:r.tipo_usuario)==="pai"&&A.length>0&&B()},[r,A]);const T=async()=>{try{const[a,b,n]=await Promise.all([o.getProvasTarefas(),o.getTurmas(),o.getDisciplinas()]);_(a),$(b),F(n),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&await ie()}catch(a){console.error("Erro ao carregar agenda:",a)}finally{X(!1)}},B=async()=>{try{const a=[];for(const b of A){const n=await ws(b.id);a.push(...n.map(M=>({...M,turma:b})))}L(a)}catch(a){console.error("Erro ao carregar horários:",a)}},ee=k.filter(a=>{var se;const b=new Date().toISOString().split("T")[0],n=a.data;let M=!0;if(p.periodo==="proximas")M=n>=b;else if(p.periodo==="passadas")M=n<b;else if(p.periodo==="hoje")M=n===b;else if(p.periodo==="semana"){const ae=new Date;ae.setDate(ae.getDate()+7),M=n>=b&&n<=ae.toISOString().split("T")[0]}return M&&(!p.turma||((se=a.disciplina)==null?void 0:se.turma_id)===p.turma)&&(!p.disciplina||a.disciplina_id===p.disciplina)&&(!p.tipo||a.tipo===p.tipo)}),re=a=>{const b={};return a.forEach(n=>{const M=n.data;b[M]||(b[M]=[]),b[M].push(n)}),b},E=()=>["Segunda","Terça","Quarta","Quinta","Sexta","Sábado","Domingo"],U=()=>u.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum horário encontrado"}),e.jsx("p",{className:"text-gray-500",children:"Os horários das aulas dos seus filhos aparecerão aqui quando forem configurados."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(a=>{const b=u.filter(M=>M.turma_id===a.id),n=new Set(b.map(M=>M.disciplina_id)).size;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-sm",children:a.nome.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:a.nome}),e.jsx("p",{className:"text-xs text-gray-500",children:a.ano_letivo})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Aulas/semana:"}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:b.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Disciplinas:"}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:n})]})]})]},a.id)})}),A.map(a=>{const b=u.filter(n=>n.turma_id===a.id);return b.length===0?null:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(bs,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:a.nome}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:a.ano_letivo})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5,6,7].map(n=>{const M=b.filter(K=>K.dia_semana===n);if(M.length===0)return null;const se=["Segunda","Terça","Quarta","Quinta","Sexta","Sábado","Domingo"],ae=["📚","📖","✏️","📝","🎯","🌟","🎨"],W=["blue","green","purple","amber","red","indigo","pink"];return e.jsxs("div",{className:`bg-gradient-to-r from-${W[n-1]}-50 to-${W[n-1]}-100 rounded-2xl p-4 border-2 border-${W[n-1]}-200 shadow-lg`,children:[e.jsxs("h4",{className:`font-black text-${W[n-1]}-800 mb-4 text-center text-lg flex items-center justify-center space-x-2`,children:[e.jsx("span",{className:"text-2xl",children:ae[n-1]}),e.jsx("span",{children:se[n-1]})]}),e.jsx("div",{className:"space-y-3",children:M.sort((K,H)=>K.hora_inicio.localeCompare(H.hora_inicio)).map(K=>{var H,de,Se,ye,_e,De,we,xe;return e.jsxs("div",{className:"p-4 rounded-xl text-sm shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105 bg-white border-l-4",style:{borderLeftColor:(H=K.disciplina)==null?void 0:H.cor,background:`linear-gradient(135deg, ${(de=K.disciplina)==null?void 0:de.cor}10, ${(Se=K.disciplina)==null?void 0:Se.cor}20)`},onClick:()=>{var fe,Fe;alert(`📚 ${(fe=K.disciplina)==null?void 0:fe.nome}

👨‍🏫 Professor: ${((Fe=K.professor)==null?void 0:Fe.nome)||"Não atribuído"}

🕐 Horário: ${K.hora_inicio} - ${K.hora_fim}

🏫 Local: ${K.sala||"Não informada"}

📝 Observações: ${K.observacoes||"Sem observações especiais"}`)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:(ye=K.disciplina)==null?void 0:ye.cor}}),e.jsx("div",{className:"font-black text-gray-900 text-base",title:(_e=K.disciplina)==null?void 0:_e.nome,children:(De=K.disciplina)==null?void 0:De.nome})]}),e.jsxs("div",{className:`px-3 py-1 bg-${W[n-1]}-100 text-${W[n-1]}-800 rounded-full text-xs font-bold`,children:[K.hora_inicio," - ",K.hora_fim]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-gray-700 text-sm font-semibold flex items-center space-x-1",title:(we=K.professor)==null?void 0:we.nome,children:[e.jsx("span",{children:"👨‍🏫"}),e.jsx("span",{children:((xe=K.professor)==null?void 0:xe.nome)||"Professor TBD"})]}),K.sala&&e.jsxs("div",{className:"text-gray-600 text-xs font-medium flex items-center space-x-1 bg-white px-2 py-1 rounded-full",title:`Sala: ${K.sala}`,children:[e.jsx("span",{children:"📍"}),e.jsx("span",{children:K.sala})]})]})]},K.id)})})]},n)})})}),e.jsxs("div",{className:"hidden md:block overflow-x-auto",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-8 gap-0 min-w-[700px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-100 to-gray-200 p-3 border border-gray-300 font-black text-gray-800 text-center text-sm",children:"⏰ Horário"}),E().map((n,M)=>{const se=["📚","📖","✏️","📝","🎯","🌟","🎨"],ae=["blue","green","purple","amber","red","indigo","pink"];return e.jsx("div",{className:`bg-gradient-to-b from-${ae[M]}-100 to-${ae[M]}-200 p-3 border border-gray-300 font-black text-${ae[M]}-800 text-center text-sm`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"text-lg",children:se[M]}),e.jsx("span",{children:n})]})},M)}),Array.from({length:8},(n,M)=>{const se=7+M,ae=`${se.toString().padStart(2,"0")}:00`;return e.jsxs(Ne.Fragment,{children:[e.jsx("div",{className:"p-3 border border-gray-300 text-center text-sm text-gray-700 bg-gradient-to-r from-gray-50 to-gray-100 font-bold",children:ae}),[1,2,3,4,5,6,7].map(W=>{const K=b.filter(H=>{const de=parseInt(H.hora_inicio.split(":")[0]);return H.dia_semana===W&&de===se});return e.jsx("div",{className:"p-2 border border-gray-300 min-h-[70px] bg-white hover:bg-gray-50 transition-colors",children:K.map(H=>{var de,Se,ye,_e,De,we,xe,fe;return e.jsxs("div",{className:"p-2 rounded-lg text-xs mb-1 shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer transform hover:scale-105 border-l-4",style:{backgroundColor:((de=H.disciplina)==null?void 0:de.cor)+"25",borderLeftColor:(Se=H.disciplina)==null?void 0:Se.cor,background:`linear-gradient(135deg, ${(ye=H.disciplina)==null?void 0:ye.cor}20, ${(_e=H.disciplina)==null?void 0:_e.cor}35)`},onClick:()=>{var Fe,Qe;alert(`📚 ${(Fe=H.disciplina)==null?void 0:Fe.nome}

👨‍🏫 Professor: ${((Qe=H.professor)==null?void 0:Qe.nome)||"Não atribuído"}

🕐 Horário: ${H.hora_inicio} - ${H.hora_fim}

🏫 Local: ${H.sala||"Não informada"}

📝 Observações: ${H.observacoes||"Sem observações especiais"}`)},children:[e.jsx("div",{className:"font-black text-gray-900 truncate text-sm mb-1",title:(De=H.disciplina)==null?void 0:De.nome,children:(we=H.disciplina)==null?void 0:we.nome}),e.jsxs("div",{className:"text-gray-700 truncate text-xs font-semibold",title:(xe=H.professor)==null?void 0:xe.nome,children:["👨‍🏫 ",((fe=H.professor)==null?void 0:fe.nome)||"Professor TBD"]}),H.sala&&e.jsxs("div",{className:"text-gray-600 truncate text-xs font-medium",title:`Sala: ${H.sala}`,children:["📍 ",H.sala]}),e.jsxs("div",{className:"text-gray-500 text-xs font-bold mt-1",children:["🕐 ",H.hora_inicio," - ",H.hora_fim]})]},H.id)})},W)})]},M)})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl border-2 border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-black text-gray-900 mb-3 flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:"🎨"}),"Disciplinas da Turma:"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:[...new Set(b.map(n=>n.disciplina_id))].map(n=>{var se;const M=(se=b.find(ae=>ae.disciplina_id===n))==null?void 0:se.disciplina;return M?e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:M.cor}}),e.jsx("span",{className:"text-sm font-semibold text-gray-800 truncate",children:M.nome})]},n):null})})]})]})]})]},a.id)})]}),ie=async()=>{try{const a={};for(const b of k){const n=await Ke("prova_tarefa",b.id);a[b.id]={stats:n}}y(a)}catch(a){console.error("Erro ao buscar visualizações:",a)}},Q=async a=>{if(!m[a])try{const b=await es("prova_tarefa",a);y(n=>({...n,[a]:{...n[a],detalhes:b}}))}catch(b){console.error("Erro ao buscar detalhes de visualização:",b)}g(b=>({...b,[a]:!b[a]}))},oe=async a=>{if(r.tipo_usuario==="pai")try{await ss("prova_tarefa",a.id)}catch(b){console.error("Erro ao registrar visualização:",b)}G(a),j(!0)},me=a=>{z(a),c(!0)},f=async a=>{if(confirm(`Tem certeza que deseja excluir "${a.titulo}"?`))try{await o.deleteProvaTarefa(a.id),T()}catch(b){console.error("Erro ao excluir prova/tarefa:",b),alert("Erro ao excluir prova/tarefa")}},x=()=>{c(!1),z(null)},Y=()=>{T()},i=re(ee);return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(he,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:r.tipo_usuario==="pai"?"📅 Agenda dos Filhos":r.tipo_usuario==="professor"?"Minhas Provas & Tarefas":"Agenda Escolar"}),r.tipo_usuario==="pai"&&e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"Acompanhe todas as atividades escolares"})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"Nova Prova/Tarefa"})]})]}),r.tipo_usuario==="pai"&&e.jsx("div",{className:"bg-gradient-to-r from-white to-blue-50 rounded-2xl shadow-lg border-2 border-blue-200",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-2 sm:space-x-8 px-4 sm:px-6",children:[e.jsx("button",{onClick:()=>v("agenda"),className:`py-4 px-3 sm:px-1 border-b-4 font-bold text-sm sm:text-base transition-all duration-300 ${s==="agenda"?"border-blue-500 text-blue-600 bg-blue-50 rounded-t-lg":"border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300 hover:bg-blue-50 rounded-t-lg"}`,children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s==="agenda"?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(he,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("span",{className:"hidden sm:inline",children:"Provas & Tarefas"}),e.jsx("span",{className:"sm:hidden",children:"Agenda"})]})}),e.jsx("button",{onClick:()=>v("cronograma"),className:`py-4 px-3 sm:px-1 border-b-4 font-bold text-sm sm:text-base transition-all duration-300 ${s==="cronograma"?"border-purple-500 text-purple-600 bg-purple-50 rounded-t-lg":"border-transparent text-gray-500 hover:text-purple-600 hover:border-purple-300 hover:bg-purple-50 rounded-t-lg"}`,children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s==="cronograma"?"bg-purple-100":"bg-gray-100"}`,children:e.jsx(hs,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("span",{className:"hidden sm:inline",children:"Cronograma de Aulas"}),e.jsx("span",{className:"sm:hidden",children:"Horários"})]})})]})})}),r.tipo_usuario==="pai"&&s==="cronograma"?U():e.jsxs(e.Fragment,{children:[(r.tipo_usuario!=="pai"||s==="agenda")&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-lg border-2 border-blue-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-blue-600 uppercase tracking-wide",children:"Hoje"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-blue-700",children:k.filter(a=>a.data===new Date().toISOString().split("T")[0]).length}),e.jsx("p",{className:"text-xs text-blue-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(Pe,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-yellow-50 rounded-2xl shadow-lg border-2 border-yellow-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-yellow-600 uppercase tracking-wide",children:"Esta Semana"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-yellow-700",children:(()=>{const a=new Date().toISOString().split("T")[0],b=new Date;return b.setDate(b.getDate()+7),k.filter(n=>{const M=n.data;return M>=a&&M<=b.toISOString().split("T")[0]}).length})()}),e.jsx("p",{className:"text-xs text-yellow-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-xl",children:e.jsx(he,{className:"h-6 w-6 sm:h-8 sm:w-8 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-red-50 rounded-2xl shadow-lg border-2 border-red-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-red-600 uppercase tracking-wide",children:"Provas"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-red-700",children:k.filter(a=>a.tipo==="prova").length}),e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"avaliações"})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-xl",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-red-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs sm:text-sm",children:"P"})})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-lg border-2 border-green-200 p-4 sm:p-6 hover:shadow-xl hover:scale-105 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-green-600 uppercase tracking-wide",children:"Trabalhos"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-black text-green-700",children:k.filter(a=>["tarefa","trabalho","projeto"].includes(a.tipo)).length}),e.jsx("p",{className:"text-xs text-green-500 font-medium",children:"atividades"})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-xl",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-green-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs sm:text-sm",children:"T"})})})]})})]}),(r.tipo_usuario!=="pai"||s==="agenda")&&e.jsxs("div",{className:"bg-gradient-to-r from-white to-gray-50 rounded-2xl shadow-lg border-2 border-gray-200 p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Ie,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-600"})}),e.jsx("h3",{className:"font-black text-gray-900 text-base sm:text-lg",children:"🔍 Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"📅 Período"}),e.jsxs("select",{value:p.periodo,onChange:a=>N({...p,periodo:a.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"proximas",children:"Próximas"}),e.jsx("option",{value:"hoje",children:"Hoje"}),e.jsx("option",{value:"semana",children:"Esta semana"}),e.jsx("option",{value:"passadas",children:"Passadas"}),e.jsx("option",{value:"todas",children:"Todas"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"🏫 Turma"}),e.jsxs("select",{value:p.turma,onChange:a=>N({...p,turma:a.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todas as turmas"}),A.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"📚 Disciplina"}),e.jsxs("select",{value:p.disciplina,onChange:a=>N({...p,disciplina:a.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todas as disciplinas"}),J.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs sm:text-sm font-bold text-gray-700 mb-2",children:"📝 Tipo"}),e.jsxs("select",{value:p.tipo,onChange:a=>N({...p,tipo:a.target.value}),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm font-semibold bg-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"prova",children:"Prova"}),e.jsx("option",{value:"tarefa",children:"Tarefa"}),e.jsx("option",{value:"trabalho",children:"Trabalho"}),e.jsx("option",{value:"projeto",children:"Projeto"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(i).length===0?e.jsxs("div",{className:"bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-lg border-2 border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"p-6 bg-gray-100 rounded-full w-fit mx-auto mb-6",children:e.jsx(he,{className:"h-16 w-16 text-gray-400"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"📅 Nenhuma atividade encontrada"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Ajuste os filtros ou aguarde novas atividades."})]}):Object.entries(i).map(([a,b])=>e.jsxs("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-black",children:["📅 ",new Date(a+"T00:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"})]}),e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:new Date(a+"T00:00:00").getFullYear()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm rounded-xl",children:[e.jsx("div",{className:"text-2xl font-black",children:b.length}),e.jsx("div",{className:"text-xs font-bold",children:b.length===1?"atividade":"atividades"})]})})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"space-y-4 sm:space-y-6",children:b.map(n=>{var de,Se,ye,_e,De,we;const M=new Date().toISOString().split("T")[0],se=n.data,ae=se<M,W=se===M,K=new Date(se).getTime()-new Date(M).getTime(),H=Math.ceil(K/(1e3*60*60*24));return e.jsxs("div",{className:`p-4 sm:p-6 rounded-2xl transition-all cursor-pointer hover:shadow-2xl hover:scale-105 group border-2 ${ae?"border-red-300 bg-gradient-to-br from-red-50 to-red-100":W?"border-yellow-300 bg-gradient-to-br from-yellow-50 to-yellow-100 animate-pulse":H<=3?"border-orange-300 bg-gradient-to-br from-orange-50 to-orange-100":"border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100"}`,onClick:()=>oe(n),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("span",{className:`px-3 py-2 text-sm font-black rounded-xl shadow-md ${n.tipo==="prova"?"bg-red-500 text-white":"bg-blue-500 text-white"}`,children:n.tipo==="prova"?"📝 PROVA":"📚 TAREFA"}),e.jsxs("div",{className:"flex items-center space-x-2 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("div",{className:"w-4 h-4 rounded-full shadow-sm",style:{backgroundColor:((de=n.disciplina)==null?void 0:de.cor)||"#3B82F6"}}),e.jsx("span",{className:"text-sm font-bold text-gray-800",children:(Se=n.disciplina)==null?void 0:Se.nome})]})]}),e.jsx("h3",{className:"text-xl sm:text-2xl font-black text-gray-900 group-hover:text-blue-700 transition-colors mb-2 leading-tight",children:n.titulo}),n.descricao&&e.jsx("p",{className:"text-sm sm:text-base text-gray-700 mb-3 font-medium leading-relaxed",children:n.descricao}),e.jsxs("div",{className:"flex items-center space-x-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("span",{children:"🏫"}),e.jsx("span",{className:"font-bold text-gray-700",children:(ye=A.find(xe=>{var fe;return xe.id===((fe=n.disciplina)==null?void 0:fe.turma_id)}))==null?void 0:ye.nome})]}),e.jsxs("div",{className:"flex items-center space-x-1 bg-white px-3 py-1 rounded-xl shadow-sm",children:[e.jsx("span",{children:"📅"}),e.jsx("span",{className:"font-bold text-gray-700",children:new Date(se).toLocaleDateString("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit"})})]})]}),e.jsx("p",{className:"text-sm font-bold text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity bg-blue-100 px-3 py-2 rounded-xl",children:"👆 Toque para ver detalhes completos e dicas de preparação"})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-3",children:[e.jsx("div",{className:`px-4 py-3 rounded-2xl font-black text-sm shadow-lg ${ae?"bg-red-500 text-white":W?"bg-yellow-500 text-white animate-bounce":H<=3?"bg-orange-500 text-white":"bg-green-500 text-white"}`,children:ae?"❌ VENCIDA":W?"🔔 HOJE!":H<=3?`⚠️ ${H} DIAS`:`✅ ${H} DIAS`}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:xe=>{xe.stopPropagation(),Q(n.id)},className:"p-2 text-gray-400 hover:text-green-600 transition-colors",title:"Ver quem visualizou",children:((De=(_e=d[n.id])==null?void 0:_e.stats)==null?void 0:De.usuariosUnicos)>0?e.jsx(Le,{className:"h-4 w-4 text-green-600"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:xe=>{xe.stopPropagation(),me(n)},className:"p-2 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:xe=>{xe.stopPropagation(),f(n)},className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&d[n.id]&&e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsx("span",{className:"font-bold",children:"📊 Visualizações:"}),e.jsxs("span",{className:"font-black text-green-600",children:[d[n.id].stats.usuariosUnicos," usuários únicos"]})]}),d[n.id].stats.ultimaVisualizacao&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Última: ",new Date(d[n.id].stats.ultimaVisualizacao).toLocaleString("pt-BR")]})]}),m[n.id]&&((we=d[n.id])==null?void 0:we.detalhes)&&e.jsxs("div",{className:"mt-4 pt-4 border-t-2 border-gray-200",children:[e.jsx("h5",{className:"text-sm font-black text-gray-900 mb-3",children:"📈 Histórico de Visualizações:"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[d[n.id].detalhes.slice(0,5).map(xe=>{var fe;return e.jsxs("div",{className:"flex items-center justify-between text-xs bg-white p-2 rounded-lg shadow-sm",children:[e.jsx("span",{className:"font-bold text-gray-700",children:(fe=xe.usuario)==null?void 0:fe.nome}),e.jsx("span",{className:"font-medium text-gray-600",children:new Date(xe.visualizado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},xe.id)}),d[n.id].detalhes.length>5&&e.jsxs("div",{className:"text-xs font-bold text-blue-600 text-center pt-2 bg-blue-50 rounded-lg p-2",children:["+",d[n.id].detalhes.length-5," mais..."]})]})]})]},n.id)})})})]},a))})]}),e.jsx(zs,{isOpen:w,onClose:x,provaTarefa:R,onSave:Y}),e.jsx(ze,{isOpen:D,onClose:()=>j(!1),item:V,type:"prova_tarefa",turmaName:V?(P=A.find(a=>{var b;return a.id===((b=V.disciplina)==null?void 0:b.turma_id)}))==null?void 0:P.nome:"",disciplinaName:(q=V==null?void 0:V.disciplina)==null?void 0:q.nome})]})}function qs({isOpen:r,onClose:C,material:o,onSave:k}){const{user:_}=be(),{isSupabaseConnected:A}=be(),$=Te(_,A),[J,F]=t.useState([]),[u,L]=t.useState([]),[s,v]=t.useState({disciplina_id:"",titulo:"",tipo:"pdf",arquivo_url:"",descricao:""}),[d,y]=t.useState({}),[m,g]=t.useState(!1),[p,N]=t.useState(!1),[w,c]=t.useState(0);t.useEffect(()=>{r&&_&&R()},[r,_]),t.useEffect(()=>{v(o?{disciplina_id:o.disciplina_id,titulo:o.titulo,tipo:o.tipo,arquivo_url:o.arquivo_url||"",descricao:o.descricao||""}:{disciplina_id:"",titulo:"",tipo:"pdf",arquivo_url:"",descricao:""}),y({}),N(!1),c(0)},[o,r]);const R=async()=>{try{const[T,B]=await Promise.all([$.getTurmas(),$.getDisciplinas()]);F(T),L(B),B.length===1&&v(ee=>({...ee,disciplina_id:B[0].id}))}catch(T){console.error("Erro ao carregar dados:",T)}},z=()=>{const T={};if(s.disciplina_id||(T.disciplina_id="Disciplina é obrigatória"),(!s.titulo.trim()||s.titulo.length<3)&&(T.titulo="Título deve ter pelo menos 3 caracteres"),s.tipo||(T.tipo="Tipo de material é obrigatório"),s.tipo==="link"&&!s.arquivo_url.trim())T.arquivo_url="URL é obrigatória para links";else if(s.tipo==="link"&&s.arquivo_url.trim())try{new URL(s.arquivo_url)}catch{T.arquivo_url="URL inválida"}if(s.tipo==="video"&&s.arquivo_url.trim()){const B=s.arquivo_url.includes("youtube.com")||s.arquivo_url.includes("youtu.be"),ee=s.arquivo_url.includes("vimeo.com");!B&&!ee&&(T.arquivo_url="URL deve ser do YouTube ou Vimeo")}return y(T),Object.keys(T).length===0},h=T=>{var ee;const B=(ee=T.target.files)==null?void 0:ee[0];if(B){if(B.size>10*1024*1024){y({...d,arquivo_url:"Arquivo deve ter no máximo 10MB"});return}const re={pdf:["application/pdf"],imagem:["image/jpeg","image/png","image/gif","image/webp"]};if(s.tipo==="pdf"&&!re.pdf.includes(B.type)){y({...d,arquivo_url:"Apenas arquivos PDF são permitidos"});return}if(s.tipo==="imagem"&&!re.imagem.includes(B.type)){y({...d,arquivo_url:"Apenas imagens JPG, PNG, GIF ou WebP são permitidas"});return}c(0);const E=new FileReader;E.onprogress=U=>{if(U.lengthComputable){const ie=U.loaded/U.total*100;c(ie)}},E.onload=U=>{var Q;const ie=(Q=U.target)==null?void 0:Q.result;v({...s,arquivo_url:ie}),y({...d,arquivo_url:""}),c(100)},E.readAsDataURL(B)}},X=async T=>{if(T.preventDefault(),!!z()){g(!0);try{o?(await $.updateMaterial(o.id,s),console.log("✅ Material atualizado")):(await $.createMaterial(s),console.log("✅ Material criado")),N(!0),setTimeout(()=>{k(),C(),D()},1500)}catch(B){console.error("Erro ao salvar material:",B),y({submit:"Erro ao salvar material"})}finally{g(!1)}}},D=()=>{v({disciplina_id:"",titulo:"",tipo:"pdf",arquivo_url:"",descricao:""}),y({}),N(!1),c(0)},j=T=>{switch(T){case"pdf":return e.jsx(ue,{className:"h-5 w-5"});case"video":return e.jsx($e,{className:"h-5 w-5"});case"link":return e.jsx(Ee,{className:"h-5 w-5"});default:return e.jsx(ue,{className:"h-5 w-5"})}};if(!r)return null;const V=u.find(T=>T.id===s.disciplina_id),G=J.find(T=>T.id===(V==null?void 0:V.turma_id));return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(ue,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o?"Editar Material":"Novo Material Didático"})]}),e.jsx("button",{onClick:()=>{C(),D()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Re,{className:"h-5 w-5 text-gray-500"})})]}),p&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:o?"Material atualizado com sucesso!":"Material criado com sucesso!"})]})}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tipo de Material *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{value:"pdf",label:"PDF",icon:ue,color:"red"},{value:"video",label:"Vídeo",icon:$e,color:"purple"},{value:"link",label:"Link",icon:Ee,color:"blue"}].map(({value:T,label:B,icon:ee,color:re})=>e.jsxs("button",{type:"button",onClick:()=>v({...s,tipo:T,arquivo_url:""}),className:`p-4 border rounded-lg text-center transition-colors ${s.tipo===T?`border-${re}-500 bg-${re}-50 text-${re}-700`:"border-gray-300 hover:border-gray-400"}`,children:[e.jsx("div",{className:`p-2 bg-${re}-100 rounded-full w-fit mx-auto mb-2`,children:e.jsx(ee,{className:`h-5 w-5 text-${re}-600`})}),e.jsx("span",{className:"text-sm font-medium",children:B})]},T))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disciplina *"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsxs("select",{value:s.disciplina_id,onChange:T=>v({...s,disciplina_id:T.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.disciplina_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma disciplina"}),u.map(T=>e.jsx("option",{value:T.id,children:T.nome},T.id))]})]}),d.disciplina_id&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.disciplina_id]})]}),s.disciplina_id&&V&&e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:V.cor||"#3B82F6"}}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:V.nome})]}),G&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-800",children:G.nome})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Título do Material *"}),e.jsx("input",{type:"text",value:s.titulo,onChange:T=>v({...s,titulo:T.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.titulo?"border-red-300":"border-gray-300"}`,placeholder:`Ex: ${s.tipo==="pdf"?"Apostila de Matemática - Frações":s.tipo==="video"?"Vídeo Aula - Sistema Solar":s.tipo==="link"?"Site Educativo - Português":"Diagrama - Ciclo da Água"}`}),d.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:s.tipo==="link"?"URL do Link *":s.tipo==="video"?"URL do Vídeo":"Arquivo"}),s.tipo==="link"||s.tipo==="video"?e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"url",value:s.arquivo_url,onChange:T=>v({...s,arquivo_url:T.target.value}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.arquivo_url?"border-red-300":"border-gray-300"}`,placeholder:s.tipo==="link"?"https://exemplo.com":"https://youtube.com/watch?v=... ou https://vimeo.com/..."})]}):e.jsxs("div",{className:"space-y-3",children:[s.arquivo_url&&e.jsxs("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[j(s.tipo),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Arquivo selecionado"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.tipo==="pdf"?"Documento PDF":"Imagem"})]}),e.jsx("button",{type:"button",onClick:()=>v({...s,arquivo_url:""}),className:"text-red-600 hover:text-red-800",children:e.jsx(Re,{className:"h-4 w-4"})})]}),w>0&&w<100&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${w}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(w),"% carregado"]})]})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".pdf",onChange:h,className:"hidden",id:"arquivo-upload"}),e.jsxs("label",{htmlFor:"arquivo-upload",className:"flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors",children:[e.jsx(Ms,{className:"h-5 w-5 mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Clique para selecionar PDF"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Arquivos PDF até 10MB"})]})]}),d.arquivo_url&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.arquivo_url]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição/Instruções"}),e.jsx("textarea",{value:s.descricao,onChange:T=>v({...s,descricao:T.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Descreva o material, como usar, objetivos de aprendizagem..."}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.descricao.length,"/500 caracteres"]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-800 mb-2",children:s.tipo==="pdf"?"📄 Dicas para PDFs:":s.tipo==="video"?"🎥 Dicas para Vídeos:":"🔗 Dicas para Links:"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1",children:[s.tipo==="pdf"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Use PDFs com texto pesquisável"}),e.jsx("li",{children:"• Organize o conteúdo em capítulos"}),e.jsx("li",{children:"• Inclua exercícios e exemplos"}),e.jsx("li",{children:"• Mantenha boa qualidade de imagem"})]}),s.tipo==="video"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Use YouTube ou Vimeo para melhor compatibilidade"}),e.jsx("li",{children:"• Vídeos de 5-15 minutos são ideais"}),e.jsx("li",{children:"• Inclua legendas quando possível"}),e.jsx("li",{children:"• Teste o áudio e qualidade da imagem"})]}),s.tipo==="link"&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"• Verifique se o site é educativo e seguro"}),e.jsx("li",{children:"• Teste o link antes de compartilhar"}),e.jsx("li",{children:"• Prefira sites com conteúdo interativo"}),e.jsx("li",{children:"• Evite sites com muita publicidade"})]})]})]}),u.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma disciplina atribuída"}),e.jsx("p",{className:"text-gray-500",children:"Você ainda não possui disciplinas atribuídas. Entre em contato com o administrador."})]}),d.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),d.submit]})})]}),u.length>0&&e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{C(),D()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:X,disabled:m||p,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:m?"Salvando...":o?"Salvar Alterações":"Criar Material"})]})]})]})})}function Is(r={}){const{enabled:C=!0,initialFetch:o=!0}=r,[k,_]=t.useState([]),[A,$]=t.useState(!!o),[J,F]=t.useState(null),u=t.useRef(new Map),L=t.useRef(!1),s=t.useRef([]),v=t.useCallback(m=>{u.current.clear(),m.forEach(g=>u.current.set(g.id,g)),_(Array.from(u.current.values()).sort((g,p)=>p.criado_em.localeCompare(g.criado_em)))},[]),d=t.useCallback(()=>{var g,p;if(s.current.length===0)return;const m=u.current;for(const N of s.current)if(N.action==="INSERT"&&N.newRecord)m.set(N.newRecord.id,N.newRecord);else if(N.action==="UPDATE"&&N.newRecord)m.set(N.newRecord.id,N.newRecord);else if(N.action==="DELETE"){const w=((g=N.oldRecord)==null?void 0:g.id)||((p=N.newRecord)==null?void 0:p.id);w&&m.delete(w)}s.current=[],_(Array.from(m.values()).sort((N,w)=>w.criado_em.localeCompare(N.criado_em)))},[]),y=t.useCallback(async()=>{if(C)try{$(!0);const{data:m,error:g}=await Je.from("materiais").select("*, disciplina:disciplinas(*)").order("criado_em",{ascending:!1});if(g)throw g;v(m||[]),L.current=!0,d()}catch(m){F(m.message||"Erro ao carregar materiais")}finally{$(!1)}},[v,C,d]);return We("materiais",m=>{var p,N;if(!C)return;if(!L.current){s.current.push(m);return}const g=u.current;if(m.action==="INSERT"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="UPDATE"&&m.newRecord)g.set(m.newRecord.id,m.newRecord);else if(m.action==="DELETE"){const w=((p=m.oldRecord)==null?void 0:p.id)||((N=m.newRecord)==null?void 0:N.id);w&&g.delete(w)}_(Array.from(g.values()).sort((w,c)=>c.criado_em.localeCompare(w.criado_em)))}),t.useEffect(()=>{C&&o&&y()},[C,o,y]),{materiais:k,loading:A,error:J,refetch:y}}function Qs(){var x,Y;const{user:r,isSupabaseConnected:C}=be(),o=Te(r,C),[k,_]=t.useState([]),[A,$]=t.useState([]),[J,F]=t.useState([]),[u,L]=t.useState({busca:"",turma:"",disciplina:"",tipo:""}),[s,v]=t.useState(!1),[d,y]=t.useState(null),[m,g]=t.useState(!0),[p,N]=t.useState({}),[w,c]=t.useState({}),[R,z]=t.useState(!1),[h,X]=t.useState(null),D=C,{materiais:j,loading:V}=Is({enabled:!!r&&D,initialFetch:!0});t.useEffect(()=>{r&&!D&&G()},[r,D]),t.useEffect(()=>{D&&_(j)},[j,D]);const G=async()=>{try{const[i,P,q]=await Promise.all([o.getMateriais(),o.getTurmas(),o.getDisciplinas()]);_(i),$(P),F(q)}catch(i){console.error("Erro ao carregar materiais:",i)}finally{g(!1),k.length>0&&T()}},T=async()=>{if(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")try{const i={};for(const P of k){const q=await Ke("material",P.id);i[P.id]={stats:q}}N(i)}catch(i){console.error("Erro ao buscar visualizações:",i)}},B=async i=>{if(w[i])c(P=>({...P,[i]:!1}));else try{const P=await es("material",i);N(q=>({...q,[i]:{...q[i],detalhes:P}})),c(q=>({...q,[i]:!0}))}catch(P){console.error("Erro ao buscar detalhes de visualização:",P)}},ee=k.filter(i=>{var n;const P=!u.busca||i.titulo.toLowerCase().includes(u.busca.toLowerCase()),q=!u.turma||((n=i.disciplina)==null?void 0:n.turma_id)===u.turma,a=!u.disciplina||i.disciplina_id===u.disciplina,b=!u.tipo||i.tipo===u.tipo;return P&&q&&a&&b}),re=i=>{y(i),v(!0)},E=async i=>{if(!confirm(`Tem certeza que deseja excluir "${i.titulo}"?`))return;const P=D;let q=null;P&&(q=[...k],_(a=>a.filter(b=>b.id!==i.id)));try{await o.deleteMaterial(i.id),P||G()}catch(a){console.error("Erro ao excluir material:",a),q&&_(q),alert("Erro ao excluir material")}},U=i=>{r.tipo_usuario==="pai"&&ss("material",i.id).catch(P=>{console.error("Erro ao registrar visualização:",P)}),X(i),z(!0)},ie=()=>{v(!1),y(null)},Q=()=>{D||G()},oe=i=>{switch(i){case"pdf":return e.jsx(ue,{className:"h-5 w-5"});case"video":return e.jsx($e,{className:"h-5 w-5"});case"link":return e.jsx(Ee,{className:"h-5 w-5"});default:return e.jsx(ue,{className:"h-5 w-5"})}},me=i=>{switch(i){case"pdf":return"PDF";case"video":return"Vídeo";case"link":return"Link";default:return"Material"}},f=i=>{switch(i){case"pdf":return"bg-red-100 text-red-700";case"video":return"bg-purple-100 text-purple-700";case"link":return"bg-blue-100 text-blue-700";default:return"bg-gray-100 text-gray-700"}};return m&&!D||D&&V?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(ue,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:r.tipo_usuario==="pai"?"📚 Materiais dos Filhos":r.tipo_usuario==="professor"?"🎯 Meus Materiais Didáticos":"📖 Gestão de Materiais"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:r.tipo_usuario==="pai"?"Recursos educacionais disponíveis":"Compartilhe conhecimento com seus alunos"})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Material"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por título...",value:u.busca,onChange:i=>L({...u,busca:i.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:u.turma,onChange:i=>L({...u,turma:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as turmas"}),A.map(i=>e.jsx("option",{value:i.id,children:i.nome},i.id))]}),e.jsxs("select",{value:u.disciplina,onChange:i=>L({...u,disciplina:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as disciplinas"}),J.map(i=>e.jsx("option",{value:i.id,children:i.nome},i.id))]}),e.jsxs("select",{value:u.tipo,onChange:i=>L({...u,tipo:i.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"video",children:"Vídeo"}),e.jsx("option",{value:"link",children:"Link"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-blue-600 uppercase tracking-wide",children:"📚 Total"}),e.jsx("p",{className:"text-3xl font-black text-blue-700",children:k.length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(ue,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-red-50 rounded-2xl shadow-xl border-2 border-red-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-red-600 uppercase tracking-wide",children:"📄 PDFs"}),e.jsx("p",{className:"text-3xl font-black text-red-700",children:k.filter(i=>i.tipo==="pdf").length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-red-400 to-red-600 rounded-2xl shadow-lg",children:e.jsx(ue,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-purple-50 rounded-2xl shadow-xl border-2 border-purple-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-purple-600 uppercase tracking-wide",children:"🎥 Vídeos"}),e.jsx("p",{className:"text-3xl font-black text-purple-700",children:k.filter(i=>i.tipo==="video").length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl shadow-lg",children:e.jsx($e,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-blue-600 uppercase tracking-wide",children:"🔗 Links"}),e.jsx("p",{className:"text-3xl font-black text-blue-700",children:k.filter(i=>i.tipo==="link").length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(Ee,{className:"h-8 w-8 text-white"})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ee.length===0?e.jsxs("div",{className:"col-span-full bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum material encontrado"}),e.jsx("p",{className:"text-gray-500",children:r.tipo_usuario==="professor"?'Crie seu primeiro material didático clicando em "Novo Material".':"Ajuste os filtros ou aguarde novos materiais serem adicionados."})]}):ee.map(i=>{var P,q,a,b,n,M,se;return e.jsx("div",{className:"bg-gradient-to-br from-white via-gray-50 to-blue-50 rounded-2xl shadow-xl border-2 border-gray-200 hover:shadow-2xl hover:border-blue-400 hover:scale-110 hover:rotate-1 transition-all duration-300 cursor-pointer group",onClick:()=>U(i),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl shadow-lg",children:oe(i.tipo)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-gray-900 group-hover:text-blue-700 transition-colors line-clamp-2 text-lg",children:i.titulo}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("span",{className:`px-3 py-1 text-xs rounded-xl font-bold shadow-sm ${f(i.tipo)}`,children:me(i.tipo)}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full shadow-sm",style:{backgroundColor:((P=i.disciplina)==null?void 0:P.cor)||"#3B82F6"}}),e.jsx("span",{className:"text-xs text-gray-600 font-semibold",children:(q=i.disciplina)==null?void 0:q.nome})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(i.id),className:"text-gray-600 hover:text-green-600 p-1 rounded hover:bg-green-50",title:"Ver quem visualizou",children:((b=(a=p[i.id])==null?void 0:a.stats)==null?void 0:b.usuariosUnicos)>0?e.jsx(Le,{className:"h-4 w-4 text-green-600"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>re(i),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",children:e.jsx(Ve,{className:"h-4 w-4"})})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsx("button",{onClick:()=>E(i),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]}),i.descricao&&e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-3",children:i.descricao}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 font-bold",children:"🏫 Turma:"}),e.jsx("span",{className:"font-black text-gray-900",children:((n=A.find(ae=>{var W;return ae.id===((W=i.disciplina)==null?void 0:W.turma_id)}))==null?void 0:n.nome)||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 font-bold",children:"📚 Disciplina:"}),e.jsx("span",{className:"font-black text-gray-900",children:(M=i.disciplina)==null?void 0:M.nome})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 font-bold",children:"📅 Criado em:"}),e.jsxs("span",{className:"text-gray-700 font-semibold",children:["📅 ",new Date(i.criado_em).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",weekday:"short"})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&p[i.id]&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 font-bold",children:"👁️ Visualizações:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-black text-green-700",children:p[i.id].stats.usuariosUnicos})]})]})]}),w[i.id]&&((se=p[i.id])==null?void 0:se.detalhes)&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Quem visualizou:"}),e.jsxs("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:[p[i.id].detalhes.slice(0,3).map(ae=>{var W;return e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:(W=ae.usuario)==null?void 0:W.nome}),e.jsx("span",{className:"text-gray-500",children:new Date(ae.visualizado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},ae.id)}),p[i.id].detalhes.length>3&&e.jsxs("div",{className:"text-xs text-gray-400 text-center pt-1",children:["+",p[i.id].detalhes.length-3," mais..."]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-blue-700 text-center font-black opacity-0 group-hover:opacity-100 transition-opacity bg-blue-100 px-3 py-2 rounded-xl",children:["✨ Clique para ",i.tipo==="link"?"abrir link":i.tipo==="video"?"assistir vídeo":"visualizar/baixar"]})})]})},i.id)})}),e.jsx(qs,{isOpen:s,onClose:ie,material:d,onSave:Q}),e.jsx(ze,{isOpen:R,onClose:()=>z(!1),item:h,type:"material",turmaName:h?(x=A.find(i=>{var P;return i.id===((P=h.disciplina)==null?void 0:P.turma_id)}))==null?void 0:x.nome:"",disciplinaName:(Y=h==null?void 0:h.disciplina)==null?void 0:Y.nome})]})}function Vs({isOpen:r,onClose:C,recado:o,onSave:k}){var X,D;const{user:_}=be(),{isSupabaseConnected:A}=be(),$=Te(_,A),[J,F]=t.useState([]),[u,L]=t.useState([]),[s,v]=t.useState({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),[d,y]=t.useState({}),[m,g]=t.useState(!1),[p,N]=t.useState(!1);t.useEffect(()=>{r&&_&&w()},[r,_]),t.useEffect(()=>{v(o?{destinatario_tipo:o.destinatario_tipo,destinatario_id:o.destinatario_tipo==="aluno"?"":o.destinatario_id||"",aluno_id:o.destinatario_tipo==="aluno"&&o.destinatario_id||"",titulo:o.titulo,conteudo:o.conteudo}:{destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),y({}),N(!1)},[o,r]),t.useEffect(()=>{s.destinatario_tipo==="aluno"&&s.destinatario_id?c():s.destinatario_tipo!=="aluno"&&(L([]),v(j=>({...j,aluno_id:""})))},[s.destinatario_tipo,s.destinatario_id]);const w=async()=>{try{const j=await $.getTurmas();F(j)}catch(j){console.error("Erro ao carregar turmas:",j)}},c=async()=>{try{const V=(await $.getAlunos()).filter(G=>G.turma_id===s.destinatario_id);L(V)}catch(j){console.error("Erro ao carregar alunos:",j)}},R=()=>{const j={};return s.titulo.trim()||(j.titulo="Título é obrigatório"),s.conteudo.trim()||(j.conteudo="Mensagem é obrigatória"),s.destinatario_tipo!=="geral"&&!s.destinatario_id&&(j.destinatario="Selecione o destinatário"),s.destinatario_tipo==="aluno"&&!s.aluno_id&&(j.destinatario="Selecione o aluno"),y(j),Object.keys(j).length===0},z=async j=>{if(j.preventDefault(),!!R()){g(!0);try{const V={titulo:s.titulo,conteudo:s.conteudo,destinatario_tipo:s.destinatario_tipo,destinatario_id:s.destinatario_tipo==="geral"?void 0:s.destinatario_tipo==="aluno"?s.aluno_id:s.destinatario_id,enviado_por:_.id};o?(await $.updateRecado(o.id,V),console.log("✅ Recado atualizado")):(await $.createRecado(V),console.log("✅ Recado criado")),N(!0),setTimeout(()=>{k(),C(),h()},1500)}catch(V){console.error("Erro ao salvar recado:",V),y({submit:"Erro ao salvar recado"})}finally{g(!1)}}},h=()=>{v({destinatario_tipo:"turma",destinatario_id:"",aluno_id:"",titulo:"",conteudo:""}),y({}),N(!1)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(ve,{className:"h-5 w-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:o?"Editar Recado":"Novo Recado"})]}),e.jsx("button",{onClick:()=>{C(),h()},className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Re,{className:"h-5 w-5 text-gray-500"})})]}),p&&e.jsx("div",{className:"p-4 bg-green-50 border-b border-green-200",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:o?"Recado atualizado com sucesso!":"Recado enviado com sucesso!"})]})}),e.jsxs("form",{onSubmit:z,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Destinatário *"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>v({...s,destinatario_tipo:"geral",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${s.destinatario_tipo==="geral"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(us,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Geral"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Todos os pais"})]}),e.jsxs("button",{type:"button",onClick:()=>v({...s,destinatario_tipo:"turma",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${s.destinatario_tipo==="turma"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(je,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Turma"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pais da turma"})]}),e.jsxs("button",{type:"button",onClick:()=>v({...s,destinatario_tipo:"aluno",destinatario_id:""}),className:`p-3 border rounded-lg text-center transition-colors ${s.destinatario_tipo==="aluno"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(Ce,{className:"h-5 w-5 mx-auto mb-1"}),e.jsx("span",{className:"text-sm font-medium",children:"Aluno"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pai específico"})]})]})]}),s.destinatario_tipo==="turma"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:s.destinatario_id,onChange:j=>v({...s,destinatario_id:j.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione uma turma"}),J.map(j=>e.jsx("option",{value:j.id,children:j.nome},j.id))]}),d.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.destinatario]})]}),s.destinatario_tipo==="aluno"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Turma *"}),e.jsxs("select",{value:s.destinatario_id,onChange:j=>v({...s,destinatario_id:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione uma turma primeiro"}),J.map(j=>e.jsx("option",{value:j.id,children:j.nome},j.id))]})]}),s.destinatario_id&&u.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selecionar Aluno *"}),e.jsxs("select",{value:s.aluno_id,onChange:j=>v({...s,aluno_id:j.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.destinatario?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Selecione um aluno"}),u.map(j=>e.jsx("option",{value:j.id,children:j.nome},j.id))]}),d.destinatario&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.destinatario]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assunto *"}),e.jsx("input",{type:"text",value:s.titulo,onChange:j=>v({...s,titulo:j.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.titulo?"border-red-300":"border-gray-300"}`,placeholder:"Digite o assunto do recado"}),d.titulo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.titulo]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensagem *"}),e.jsx("textarea",{value:s.conteudo,onChange:j=>v({...s,conteudo:j.target.value}),rows:6,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${d.conteudo?"border-red-300":"border-gray-300"}`,placeholder:"Digite a mensagem do recado..."}),d.conteudo&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),d.conteudo]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.conteudo.length,"/1000 caracteres"]})]}),s.destinatario_tipo!=="geral"&&s.destinatario_id&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Destinatário:"}),e.jsx("div",{className:"flex items-center space-x-2",children:s.destinatario_tipo==="turma"?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Turma: ",(X=J.find(j=>j.id===s.destinatario_id))==null?void 0:X.nome]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm text-blue-700",children:["Aluno: ",(D=u.find(j=>j.id===s.aluno_id))==null?void 0:D.nome]})]})})]}),s.destinatario_tipo==="geral"&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(us,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Recado será enviado para todos os pais e responsáveis"})]})}),d.submit&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),d.submit]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{C(),h()},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:z,disabled:m||p,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{children:m?"Enviando...":o?"Salvar Alterações":"Enviar Recado"})]})]})]})}):null}function Ys(){var me;const{user:r}=be(),{isSupabaseConnected:C}=be(),o=Te(r,C),[k,_]=t.useState([]),[A,$]=t.useState({busca:"",tipo:"",periodo:"todos"}),[J,F]=t.useState(!1),[u,L]=t.useState(null),[s,v]=t.useState(!0),[d,y]=t.useState({}),[m,g]=t.useState({}),[p,N]=t.useState(!1),[w,c]=t.useState(null),[R,z]=t.useState(!1),h=C,{recados:X,loading:D}=fs({enabled:!!r&&h,initialFetch:!0});t.useEffect(()=>{r&&!h&&j()},[r,h]),t.useEffect(()=>{h&&_(X)},[X,h]);const j=async()=>{try{const f=await o.getRecados();_(f)}catch(f){console.error("Erro ao carregar recados:",f)}finally{v(!1)}},V=async f=>{try{const x=await Ke("recado",f),Y=await es("recado",f);y(i=>({...i,[f]:{stats:x,detalhes:Y}}))}catch(x){console.error("Erro ao buscar visualizações:",x)}},G=async f=>{d[f]||await V(f),g(x=>({...x,[f]:!x[f]}))},T=async f=>{if((r==null?void 0:r.tipo_usuario)==="pai")try{await ss("recado",f.id)}catch(x){console.error("Erro ao registrar visualização:",x)}c(f),N(!0)},B=k.filter(f=>{const x=!A.busca||f.titulo.toLowerCase().includes(A.busca.toLowerCase())||f.conteudo.toLowerCase().includes(A.busca.toLowerCase()),Y=!A.tipo||f.destinatario_tipo===A.tipo;let i=!0;if(A.periodo!=="todos"){const P=new Date(f.data_envio),q=new Date;if(A.periodo==="hoje")i=P.toDateString()===q.toDateString();else if(A.periodo==="semana"){const a=new Date;a.setDate(q.getDate()-7),i=P>=a}else if(A.periodo==="mes"){const a=new Date;a.setMonth(q.getMonth()-1),i=P>=a}}return x&&Y&&i}),ee=f=>{L(f),F(!0)},re=async f=>{if(!confirm(`Tem certeza que deseja excluir o recado "${f.titulo}"?`))return;const x=h;let Y=null;x&&(Y=[...k],_(i=>i.filter(P=>P.id!==f.id)));try{!await o.deleteRecado(f.id)&&Y&&_(Y),x||j(),h&&setTimeout(()=>{o.getRecados().then(P=>{_(P)}).catch(()=>{})},800)}catch(i){console.error("Erro ao excluir recado:",i),Y&&_(Y),alert("Erro ao excluir recado")}},E=async()=>{if(!(r&&(r.tipo_usuario==="professor"||r.tipo_usuario==="admin"))||k.length===0||!confirm(`Excluir TODOS os ${k.length} recados? Esta ação é permanente.`))return;z(!0);const f=[...k];_([]);try{const x=f.map(i=>i.id),Y=await o.bulkDeleteRecados(x);Y.failedIds.length>0&&(alert(`Falha ao excluir ${Y.failedIds.length} recados.`),h?setTimeout(()=>{o.getRecados().then(i=>_(i)).catch(()=>{})},500):_(f.filter(i=>Y.failedIds.includes(i.id))))}catch(x){console.error("Erro ao excluir todos recados:",x),alert("Erro ao excluir recados."),_(f)}finally{z(!1)}},U=()=>{F(!1),L(null)},ie=()=>{h||j()},Q=f=>{switch(f.destinatario_tipo){case"geral":return"Todos";case"turma":return"Turma específica";case"aluno":return"Aluno específico";default:return f.destinatario_tipo}},oe=f=>{switch(f){case"geral":return"bg-blue-100 text-blue-800";case"turma":return"bg-green-100 text-green-800";case"aluno":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return s&&!h||h&&D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl shadow-lg",children:e.jsx(ve,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:r.tipo_usuario==="pai"?"💌 Recados Recebidos":r.tipo_usuario==="professor"?"📢 Meus Recados":"📬 Central de Recados"}),h&&e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:"Realtime"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:r.tipo_usuario==="pai"?"Comunicações importantes da escola":"Gerencie a comunicação com as famílias"})]})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>F(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Recado"})]}),k.length>0&&e.jsxs("button",{onClick:E,disabled:R,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${R?"bg-gray-400 cursor-not-allowed text-white":"bg-red-600 text-white hover:bg-red-700"}`,children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:R?"Excluindo...":"Excluir Todos"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por título ou conteúdo...",value:A.busca,onChange:f=>$({...A,busca:f.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:A.tipo,onChange:f=>$({...A,tipo:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"geral",children:"Geral"}),e.jsx("option",{value:"turma",children:"Turma"}),e.jsx("option",{value:"aluno",children:"Aluno"})]}),e.jsxs("select",{value:A.periodo,onChange:f=>$({...A,periodo:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"todos",children:"Todos os períodos"}),e.jsx("option",{value:"hoje",children:"Hoje"}),e.jsx("option",{value:"semana",children:"Esta semana"}),e.jsx("option",{value:"mes",children:"Este mês"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-purple-50 rounded-2xl shadow-xl border-2 border-purple-200 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-110",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-purple-600 uppercase tracking-wide",children:"💌 Total"}),e.jsx("p",{className:"text-3xl font-black text-purple-700",children:k.length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl shadow-lg",children:e.jsx(ve,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gerais"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:k.filter(f=>f.destinatario_tipo==="geral").length})]}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-full",children:e.jsx(je,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Para Turmas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:k.filter(f=>f.destinatario_tipo==="turma").length})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-full",children:e.jsx(bs,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Individuais"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:k.filter(f=>f.destinatario_tipo==="aluno").length})]}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-full",children:e.jsx(Ce,{className:"h-6 w-6 text-purple-600"})})]})})]}),e.jsx("div",{className:"space-y-4",children:B.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(ve,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum recado encontrado"}),e.jsx("p",{className:"text-gray-500",children:r.tipo_usuario==="professor"?'Crie seu primeiro recado clicando em "Novo Recado".':"Ajuste os filtros ou aguarde novos recados."})]}):B.map(f=>{var x,Y,i,P;return e.jsx("div",{className:"bg-gradient-to-br from-white via-purple-50 to-pink-50 rounded-2xl shadow-xl border-2 border-purple-200 hover:shadow-2xl hover:border-purple-400 hover:scale-105 hover:rotate-1 transition-all duration-300 cursor-pointer group",onClick:()=>T(f),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-black text-gray-900 group-hover:text-purple-700 transition-colors",children:f.titulo}),e.jsx("span",{className:`px-3 py-1 text-xs rounded-xl font-bold shadow-sm ${oe(f.destinatario_tipo)}`,children:Q(f)})]}),e.jsx("p",{className:"text-gray-700 mb-3 font-medium leading-relaxed",children:f.conteudo}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ce,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:"font-bold text-gray-700",children:["👨‍🏫 Por: ",(x=f.autor)==null?void 0:x.nome]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(he,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"font-bold text-gray-700",children:["📅 ",new Date(f.data_envio).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",weekday:"short",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsx("p",{className:"text-xs text-purple-700 mt-3 opacity-0 group-hover:opacity-100 transition-opacity font-black bg-white px-3 py-2 rounded-xl",children:"✨ Clique para ler o recado completo"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>G(f.id),className:"p-2 text-gray-400 hover:text-green-600 transition-colors",title:"Ver quem visualizou",children:((i=(Y=d[f.id])==null?void 0:Y.stats)==null?void 0:i.usuariosUnicos)>0?e.jsx(Le,{className:"h-4 w-4 text-green-600"}):e.jsx(te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>ee(f),className:"p-2 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>re(f),className:"p-2 text-gray-400 hover:text-red-600 transition-colors",children:e.jsx(Ae,{className:"h-4 w-4"})})]})})]}),(r.tipo_usuario==="professor"||r.tipo_usuario==="admin")&&d[f.id]&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsx("span",{children:"📊 Visualizações:"}),e.jsxs("span",{className:"font-medium",children:[d[f.id].stats.usuariosUnicos," usuários únicos"]})]}),d[f.id].stats.ultimaVisualizacao&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Última: ",new Date(d[f.id].stats.ultimaVisualizacao).toLocaleString("pt-BR")]})]}),m[f.id]&&((P=d[f.id])==null?void 0:P.detalhes)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Quem leu este recado:"}),e.jsxs("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:[d[f.id].detalhes.slice(0,5).map(q=>{var a;return e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:(a=q.usuario)==null?void 0:a.nome}),e.jsx("span",{className:"text-gray-500",children:new Date(q.visualizado_em).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]},q.id)}),d[f.id].detalhes.length>5&&e.jsxs("div",{className:"text-xs text-gray-400 text-center pt-1",children:["+",d[f.id].detalhes.length-5," mais..."]})]})]})]})},f.id)})}),e.jsx(Vs,{isOpen:J,onClose:U,recado:u,onSave:ie}),e.jsx(ze,{isOpen:p,onClose:()=>N(!1),item:w,type:"recado",autorName:(me=w==null?void 0:w.autor)==null?void 0:me.nome})]})}function Xs(){const{user:r}=be(),{isSupabaseConnected:C}=be(),o=Te(r,C),[k,_]=t.useState([]),[A,$]=t.useState([]),[J,F]=t.useState(!0),[u,L]=t.useState(!1),[s,v]=t.useState(!1),[d,y]=t.useState(!1),[m,g]=t.useState(!1),[p,N]=t.useState({nome:"",email:"",telefone:"",avatar_url:""}),[w,c]=t.useState({senhaAtual:"",novaSenha:"",confirmarSenha:""}),[R,z]=t.useState({atual:!1,nova:!1,confirmar:!1}),[h,X]=t.useState({});t.useEffect(()=>{r&&(N({nome:r.nome,email:r.email,telefone:r.telefone||"",avatar_url:r.avatar_url||""}),r.tipo_usuario==="pai"&&D())},[r]);const D=async()=>{try{F(!0);const E=await o.getAlunos();_(E);const U=E.map(oe=>o.getNotas()),Q=(await Promise.all(U)).flat().filter(oe=>E.some(me=>me.id===oe.aluno_id));$(Q)}catch(E){console.error("Erro ao carregar filhos:",E)}finally{F(!1)}},j=E=>{var ie;const U=(ie=E.target.files)==null?void 0:ie[0];if(U){if(U.size>2*1024*1024){X({...h,avatar:"Imagem deve ter no máximo 2MB"});return}const Q=new FileReader;Q.onload=oe=>{var f;const me=(f=oe.target)==null?void 0:f.result;N({...p,avatar_url:me}),X({...h,avatar:""})},Q.readAsDataURL(U)}},V=()=>{const E={};return(!p.nome.trim()||p.nome.length<3)&&(E.nome="Nome deve ter pelo menos 3 caracteres"),p.telefone&&!/^\(\d{2}\)\s\d{4,5}-\d{4}$/.test(p.telefone)&&(E.telefone="Formato: (11) 99999-9999"),s&&(w.senhaAtual||(E.senhaAtual="Senha atual é obrigatória"),(!w.novaSenha||w.novaSenha.length<6)&&(E.novaSenha="Nova senha deve ter pelo menos 6 caracteres"),w.novaSenha!==w.confirmarSenha&&(E.confirmarSenha="Senhas não coincidem")),X(E),Object.keys(E).length===0},G=async()=>{if(V()){y(!0);try{const E={nome:p.nome,telefone:p.telefone,avatar_url:p.avatar_url};s&&w.novaSenha&&(E.senha=w.novaSenha),await o.updateUsuario(r.id,E),g(!0),L(!1),v(!1),c({senhaAtual:"",novaSenha:"",confirmarSenha:""}),setTimeout(()=>g(!1),3e3)}catch(E){console.error("Erro ao atualizar perfil:",E),X({submit:"Erro ao atualizar perfil"})}finally{y(!1)}}},T=E=>{const U=E.replace(/\D/g,"");return U.length<=11?U.replace(/(\d{2})(\d{4,5})(\d{4})/,"($1) $2-$3"):E},B=E=>{switch(E){case"admin":return"Administrador";case"professor":return"Professor";case"pai":return"Pai/Responsável";default:return E}},ee=E=>{switch(E){case"admin":return"bg-purple-100 text-purple-800";case"professor":return"bg-green-100 text-green-800";case"pai":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},re=()=>J?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Carregando filhos..."})]})}):k.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ds,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Nenhum filho cadastrado"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Entre em contato com a escola para vincular seus filhos"})]}):e.jsx("div",{className:"space-y-4",children:k.map(E=>{const U=A.filter(Q=>Q.aluno_id===E.id),ie=U.length>0?U.reduce((Q,oe)=>Q+oe.valor,0)/U.length:0;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:E.nome.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:E.nome}),e.jsx("p",{className:"text-sm text-gray-500",children:E.turma_id?"Turma cadastrada":"Sem turma"}),E.data_nascimento&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Nascimento: ",new Date(E.data_nascimento).toLocaleDateString("pt-BR")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:ie>0?ie.toFixed(1):"--"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Média Geral"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(pe,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{className:"text-gray-600",children:[U.length," notas lançadas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(Ze,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"Ativo"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:"text-gray-600",children:["Desde ",new Date(E.criado_em||Date.now()).getFullYear()]})]})]})]},E.id)})});return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ce,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Meu Perfil"})]}),e.jsx("div",{className:"flex space-x-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{L(!1),v(!1),N({nome:r.nome,email:r.email,telefone:r.telefone||"",avatar_url:r.avatar_url||""}),c({senhaAtual:"",novaSenha:"",confirmarSenha:""}),X({})},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:G,disabled:d,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:d?"Salvando...":"Salvar"})]})]}):e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Editar Perfil"})]})})]}),m&&e.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2 text-green-700",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Perfil atualizado com sucesso!"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Informações Pessoais"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-6",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-2xl overflow-hidden",children:p.avatar_url?e.jsx("img",{src:p.avatar_url,alt:"Avatar",className:"w-full h-full object-cover"}):r.nome.charAt(0).toUpperCase()}),u&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden",id:"avatar-upload"}),e.jsx("label",{htmlFor:"avatar-upload",className:"cursor-pointer text-white",children:e.jsx(Rs,{className:"h-6 w-6"})})]})]}),h.avatar&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h.avatar})]}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo"}),u?e.jsx("input",{type:"text",value:p.nome,onChange:E=>N({...p,nome:E.target.value}),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h.nome?"border-red-300":"border-gray-300"}`}):e.jsx("p",{className:"text-gray-900 font-medium",children:r.nome}),h.nome&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),h.nome]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ss,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-gray-900",children:r.email})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"O email não pode ser alterado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),u?e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"tel",value:p.telefone,onChange:E=>N({...p,telefone:T(E.target.value)}),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h.telefone?"border-red-300":"border-gray-300"}`,placeholder:"(11) 99999-9999"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xs,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-gray-900",children:r.telefone||"Não informado"})]}),h.telefone&&e.jsxs("p",{className:"text-red-600 text-xs mt-1 flex items-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),h.telefone]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Usuário"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_s,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${ee(r.tipo_usuario)}`,children:B(r.tipo_usuario)})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Membro desde"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-gray-900",children:new Date(r.criado_em).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})]})]})})]}),u&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Segurança"}),e.jsxs("button",{onClick:()=>v(!s),className:"flex items-center space-x-2 px-3 py-2 text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{children:s?"Cancelar":"Alterar Senha"})]})]})}),s&&e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senha Atual *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:R.atual?"text":"password",value:w.senhaAtual,onChange:E=>c({...w,senhaAtual:E.target.value}),className:`w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h.senhaAtual?"border-red-300":"border-gray-300"}`,placeholder:"Senha atual"}),e.jsx("button",{type:"button",onClick:()=>z({...R,atual:!R.atual}),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:R.atual?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"})})]}),h.senhaAtual&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h.senhaAtual})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova Senha *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:R.nova?"text":"password",value:w.novaSenha,onChange:E=>c({...w,novaSenha:E.target.value}),className:`w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h.novaSenha?"border-red-300":"border-gray-300"}`,placeholder:"Nova senha"}),e.jsx("button",{type:"button",onClick:()=>z({...R,nova:!R.nova}),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:R.nova?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"})})]}),h.novaSenha&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h.novaSenha})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmar Nova Senha *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:R.confirmar?"text":"password",value:w.confirmarSenha,onChange:E=>c({...w,confirmarSenha:E.target.value}),className:`w-full pl-10 pr-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h.confirmarSenha?"border-red-300":"border-gray-300"}`,placeholder:"Confirmar senha"}),e.jsx("button",{type:"button",onClick:()=>z({...R,confirmar:!R.confirmar}),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:R.confirmar?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"})})]}),h.confirmarSenha&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:h.confirmarSenha})]})]}),e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Dicas de Segurança:"}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• Use pelo menos 6 caracteres"}),e.jsx("li",{children:"• Combine letras, números e símbolos"}),e.jsx("li",{children:"• Não use informações pessoais"}),e.jsx("li",{children:"• Mantenha sua senha segura"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Informações do Sistema"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ID do Usuário"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm bg-gray-50 p-2 rounded border",children:r.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status da Conta"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm ${r.ativo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.ativo?"✅ Ativa":"❌ Inativa"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Último Login"}),e.jsx("p",{className:"text-gray-900",children:new Date().toLocaleDateString("pt-BR",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conexão"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${C?"bg-green-500":"bg-yellow-500"}`}),e.jsx("span",{className:"text-sm text-gray-900",children:C?"Supabase (Nuvem)":"Local (Navegador)"})]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Permissões e Acesso"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[r.tipo_usuario==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Gerenciar usuários"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Gerenciar alunos"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Gerenciar turmas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Gerenciar disciplinas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Ver relatórios"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Configurações"})]})]}),r.tipo_usuario==="professor"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Gerenciar turmas atribuídas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Lançar notas"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Controlar presença"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Criar materiais"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Enviar recados"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Criar provas/tarefas"})]})]}),r.tipo_usuario==="pai"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Ver notas dos filhos"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Ver agenda escolar"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Receber recados"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Acessar materiais"})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-800",children:"Ver presença"})]})]})]})})]}),r.tipo_usuario==="professor"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Minhas Estatísticas"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"0"}),e.jsx("div",{className:"text-sm text-blue-800",children:"Turmas"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"0"}),e.jsx("div",{className:"text-sm text-green-800",children:"Alunos"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"0"}),e.jsx("div",{className:"text-sm text-purple-800",children:"Notas Lançadas"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:"0"}),e.jsx("div",{className:"text-sm text-yellow-800",children:"Materiais"})]})]})})]}),r.tipo_usuario==="pai"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"👨‍👩‍👧‍👦 Meus Filhos"})}),e.jsx("div",{className:"p-6",children:e.jsx(re,{})})]}),h.submit&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-700 text-sm flex items-center",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),h.submit]})})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Usuário não encontrado"})]})})}function Zs(){var E,U,ie,Q,oe,me,f;const{notifications:r,unreadCount:C,markAsRead:o,markAsUnread:k,markAllAsRead:_,deleteById:A,deleteRead:$,bulkDelete:J,refresh:F}=gs(),[u,L]=Ne.useState({busca:"",tipo:"",status:"",prioridade:"",periodo:"todos"}),[s,v]=Ne.useState(null),[d,y]=Ne.useState(!1),[m,g]=Ne.useState(!1),[p,N]=Ne.useState([]),[w,c]=Ne.useState(!1),R=Ne.useMemo(()=>r.filter(x=>{const Y=!u.busca||x.title.toLowerCase().includes(u.busca.toLowerCase())||x.message.toLowerCase().includes(u.busca.toLowerCase()),i=!u.tipo||x.type===u.tipo,P=!u.status||u.status==="lida"&&x.read||u.status==="nao_lida"&&!x.read,q=!u.prioridade||x.priority===u.prioridade;let a=!0;if(u.periodo!=="todos"){const b=new Date(x.timestamp),n=new Date;if(u.periodo==="hoje")a=b.toDateString()===n.toDateString();else if(u.periodo==="semana"){const M=new Date;M.setDate(n.getDate()-7),a=b>=M}else if(u.periodo==="mes"){const M=new Date;M.setMonth(n.getMonth()-1),a=b>=M}}return Y&&i&&P&&q&&a}),[r,u]),z=async x=>{if(confirm("Tem certeza que deseja excluir esta notificação?")){g(!0);try{await A(x)||alert("Não foi possível excluir a notificação. Verifique suas permissões ou tente novamente.")}finally{g(!1)}}},h=async()=>{if(confirm("Tem certeza que deseja excluir todas as notificações lidas?")){g(!0);try{await $()}finally{g(!1)}}},X=x=>{o(x.id),x.type!=="sistema"&&(v(x),y(!0))},D=x=>{N(Y=>Y.includes(x)?Y.filter(i=>i!==x):[...Y,x])},j=()=>{N(R.map(x=>x.id))},V=()=>{N([])},G=()=>{p.forEach(x=>o(x)),N([])},T=async()=>{if(confirm(`Tem certeza que deseja excluir ${p.length} notificação(ões)?`)){g(!0);try{const x=await J(p);x.failedIds.length>0&&alert(`Algumas notificações não puderam ser excluídas: ${x.failedIds.length}`),N([])}finally{g(!1)}}},B=x=>{switch(x){case"urgente":return"bg-red-100 text-red-800 border-red-200";case"alta":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"baixa":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ee=x=>{switch(x){case"urgente":return e.jsx(Ue,{className:"h-3 w-3"});case"alta":return e.jsx(ms,{className:"h-3 w-3"});case"normal":return e.jsx(ps,{className:"h-3 w-3"});case"baixa":return e.jsx(Pe,{className:"h-3 w-3"});default:return e.jsx(ps,{className:"h-3 w-3"})}},re=r.length;return m?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx(Me,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"🔔 Central de Notificações"}),e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:"Todas as suas notificações em um só lugar"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>c(!w),className:`px-4 py-2 rounded-lg transition-colors ${w?"bg-blue-100 text-blue-700 hover:bg-blue-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:w?"Cancelar Seleção":"Seleção em Massa"}),e.jsxs("button",{onClick:async()=>{g(!0),await F(),g(!1)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Fs,{className:"h-4 w-4"}),e.jsx("span",{children:"Atualizar"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-2xl shadow-xl border-2 border-blue-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-blue-600 uppercase tracking-wide",children:"📬 Total"}),e.jsx("p",{className:"text-3xl font-black text-blue-700",children:re})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg",children:e.jsx(Me,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-red-50 rounded-2xl shadow-xl border-2 border-red-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-red-600 uppercase tracking-wide",children:"🔴 Não Lidas"}),e.jsx("p",{className:"text-3xl font-black text-red-700",children:C})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-red-400 to-red-600 rounded-2xl shadow-lg",children:e.jsx(Ue,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-green-50 rounded-2xl shadow-xl border-2 border-green-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-green-600 uppercase tracking-wide",children:"✅ Lidas"}),e.jsx("p",{className:"text-3xl font-black text-green-700",children:re-C})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-lg",children:e.jsx(Le,{className:"h-8 w-8 text-white"})})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white to-orange-50 rounded-2xl shadow-xl border-2 border-orange-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-orange-600 uppercase tracking-wide",children:"⚠️ Urgentes"}),e.jsx("p",{className:"text-3xl font-black text-orange-700",children:r.filter(x=>x.priority==="urgente").length})]}),e.jsx("div",{className:"p-3 bg-gradient-to-br from-orange-400 to-orange-600 rounded-2xl shadow-lg",children:e.jsx(ms,{className:"h-8 w-8 text-white"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Filtros"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar notificações...",value:u.busca,onChange:x=>L({...u,busca:x.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:u.tipo,onChange:x=>L({...u,tipo:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),e.jsx("option",{value:"recado",children:"Recados"}),e.jsx("option",{value:"prova_tarefa",children:"Provas/Tarefas"}),e.jsx("option",{value:"material",children:"Materiais"}),e.jsx("option",{value:"sistema",children:"Sistema"})]}),e.jsxs("select",{value:u.status,onChange:x=>L({...u,status:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os status"}),e.jsx("option",{value:"nao_lida",children:"Não lidas"}),e.jsx("option",{value:"lida",children:"Lidas"})]}),e.jsxs("select",{value:u.prioridade,onChange:x=>L({...u,prioridade:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas as prioridades"}),e.jsx("option",{value:"urgente",children:"Urgente"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"baixa",children:"Baixa"})]}),e.jsxs("select",{value:u.periodo,onChange:x=>L({...u,periodo:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"todos",children:"Todos os períodos"}),e.jsx("option",{value:"hoje",children:"Hoje"}),e.jsx("option",{value:"semana",children:"Esta semana"}),e.jsx("option",{value:"mes",children:"Este mês"})]})]})]}),w&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:p.length===R.length&&R.length>0,onChange:x=>x.target.checked?j():V(),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:p.length>0?`${p.length} selecionada(s)`:"Selecionar todas"})]})}),p.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:G,className:"flex items-center space-x-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Marcar como Lidas"})]}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Excluir"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[C," não lidas de ",re," total"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:_,disabled:C===0,className:"flex items-center space-x-2 px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Marcar Todas como Lidas"})]}),e.jsxs("button",{onClick:h,disabled:re-C===0,className:"flex items-center space-x-2 px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ts,{className:"h-4 w-4"}),e.jsx("span",{children:"Excluir Lidas"})]})]})]}),e.jsx("div",{className:"space-y-4",children:R.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(Me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhuma notificação encontrada"}),e.jsx("p",{className:"text-gray-500",children:"Ajuste os filtros ou aguarde novas notificações chegarem."})]}):R.map(x=>{const Y=x.type==="recado"?ve:x.type==="prova_tarefa"?he:x.type==="material"?ue:Cs,i=p.includes(x.id);return e.jsx("div",{className:`bg-white rounded-xl shadow-sm border-2 transition-all duration-300 cursor-pointer hover:shadow-lg hover:scale-[1.02] ${x.read?"border-gray-200 hover:border-gray-300":"border-blue-300 bg-gradient-to-r from-blue-50 to-purple-50"} ${i?"ring-2 ring-blue-500 border-blue-500":""}`,onClick:()=>!w&&X(x),children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[w&&e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx("input",{type:"checkbox",checked:i,onChange:P=>{P.stopPropagation(),D(x.id)},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("div",{className:`flex-shrink-0 p-3 rounded-xl ${x.type==="recado"?"bg-purple-100":x.type==="prova_tarefa"?"bg-blue-100":x.type==="material"?"bg-green-100":"bg-gray-100"}`,children:e.jsx(Y,{className:`h-6 w-6 ${x.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`text-lg font-bold ${x.read?"text-gray-700":"text-gray-900"}`,children:x.title}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:x.message})]}),e.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 ml-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full border ${B(x.priority)}`,children:e.jsxs("div",{className:"flex items-center space-x-1",children:[ee(x.priority),e.jsx("span",{className:"font-medium capitalize",children:x.priority})]})}),!x.read&&e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Pe,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:new Date(x.timestamp).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${x.type==="recado"?"bg-purple-100 text-purple-800":x.type==="prova_tarefa"?"bg-blue-100 text-blue-800":x.type==="material"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:x.category})]}),!w&&e.jsxs("div",{className:"flex items-center space-x-2",children:[x.read?e.jsx("button",{onClick:P=>{P.stopPropagation(),k(x.id)},className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors",title:"Marcar como não lida",children:e.jsx(qe,{className:"h-4 w-4"})}):e.jsx("button",{onClick:P=>{P.stopPropagation(),o(x.id)},className:"p-1 text-green-600 hover:text-green-800 hover:bg-green-50 rounded transition-colors",title:"Marcar como lida",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:P=>{P.stopPropagation(),z(x.id)},className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",title:"Excluir notificação",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]}),!w&&x.type!=="sistema"&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",children:"👆 Clique para ver detalhes completos"})})]})]})})},x.id)})}),e.jsx(ze,{isOpen:d,onClose:()=>{y(!1),v(null)},item:s==null?void 0:s.data,type:s==null?void 0:s.type,turmaName:(s==null?void 0:s.type)==="prova_tarefa"?(ie=(U=(E=s.data)==null?void 0:E.disciplina)==null?void 0:U.turma)==null?void 0:ie.nome:void 0,disciplinaName:(s==null?void 0:s.type)==="prova_tarefa"||(s==null?void 0:s.type)==="material"?(oe=(Q=s.data)==null?void 0:Q.disciplina)==null?void 0:oe.nome:void 0,autorName:(s==null?void 0:s.type)==="recado"?(f=(me=s.data)==null?void 0:me.autor)==null?void 0:f.nome:void 0})]})}export{Gs as A,Rs as C,As as D,Ie as F,hs as G,Os as H,ze as I,Ls as L,Qs as M,Hs as N,Xs as P,Ys as R,Ve as S,Ae as T,Ms as U,Ps as X,Zs as a,Ue as b,Fs as c,Ge as d,us as e,Ts as f,ps as g};
